(window.webpackJsonp=window.webpackJsonp||[]).push([[22,36],{"68w7":function(t,e,n){"use strict";n.r(e),n.d(e,"CategoryModule",(function(){return Pt}));var o=n("ofXK"),c=n("PCNd"),i=n("tyNb"),a=n("+QJK"),s=n("mrSG"),r=n("iTQr"),l=n("F48D"),u=n("/tkw"),d=n("mV3u"),m=n("fXoL"),b=n("jhN1"),h=n("sYmb"),g=n("dNgK"),f=n("mksl"),p=n("Wp6s");const v=["osSortedTree"];function C(t,e){1&t&&m.Tc(0),2&t&&m.Vc(" ",e.item.getTitle()," ")}let M=(()=>{class t extends d.a{constructor(t,e,n,o,c){super(t,e,n),this.categoryRepo=o,this.promptService=c,this.hasChanged=!1,this.categoriesObservable=this.categoryRepo.getViewModelListObservable()}onSave(){return Object(s.a)(this,void 0,void 0,(function*(){yield this.categoryRepo.sortCategories(this.osSortTree.getTreeData()).then(()=>this.osSortTree.setSubscription(),this.raiseError)}))}onCancel(){return Object(s.a)(this,void 0,void 0,(function*(){(yield this.canDeactivate())&&this.osSortTree.setSubscription()}))}receiveChanges(t){this.hasChanged=t}canDeactivate(){return Object(s.a)(this,void 0,void 0,(function*(){if(this.hasChanged){const t=this.translate.instant("Do you really want to exit this page?"),e=this.translate.instant("You made changes.");return yield this.promptService.open(t,e)}return!0}))}}return t.\u0275fac=function(e){return new(e||t)(m.Ub(b.d),m.Ub(h.k),m.Ub(g.a),m.Ub(r.a),m.Ub(l.a))},t.\u0275cmp=m.Ob({type:t,selectors:[["os-categories-sort"]],viewQuery:function(t,e){var n;1&t&&m.Pc(v,!0),2&t&&m.Ec(n=m.jc())&&(e.osSortTree=n.first)},features:[m.Eb],decls:10,vars:6,consts:[[3,"editMode","nav","saveEvent","mainEvent"],[1,"title-slot"],["parentKey","parent_id","weightKey","weight",3,"model","hasChanged"],["osSortedTree",""],["innerNode",""]],template:function(t,e){1&t&&(m.ac(0,"os-head-bar",0),m.ic("saveEvent",(function(){return e.onSave()}))("mainEvent",(function(){return e.onCancel()})),m.ac(1,"div",1),m.ac(2,"h2"),m.Tc(3),m.nc(4,"translate"),m.Zb(),m.Zb(),m.Zb(),m.ac(5,"mat-card"),m.ac(6,"os-sorting-tree",2,3),m.ic("hasChanged",(function(t){return e.receiveChanges(t)})),m.Rc(8,C,1,1,"ng-template",null,4,m.Sc),m.Zb(),m.Zb()),2&t&&(m.uc("editMode",e.hasChanged)("nav",!1),m.Hb(3),m.Uc(m.oc(4,4,"Sort categories")),m.Hb(3),m.uc("model",e.categoriesObservable))},directives:[f.a,p.a,u.a],pipes:[h.j],styles:[".line[_ngcontent-%COMP%]{display:table;width:100%;font-size:14px;min-height:50px;margin-bottom:5px}.line[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{max-width:100%}.line[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .line[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:table-cell;vertical-align:middle}.line[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{padding-right:10px;width:auto;white-space:nowrap}"]}),t})();var O=n("3Pt+"),y=n("+0xr"),P=n("OwvW"),Z=n("dOok"),_=n("Izkr"),w=n("0IaG"),S=n("3Xi6"),x=n("STbY"),H=n("NFeN"),T=n("f0Cb"),U=n("bTqV"),R=n("A5z7"),k=n("kmnG"),D=n("qFsG"),I=n("IZUe");const E=["editForm"],L=["editDialog"];function j(t,e){if(1&t&&(m.ac(0,"h2"),m.Tc(1),m.Zb()),2&t){const t=m.mc();m.Hb(1),m.Vc(" ",t.selectedCategory.prefixedName," ")}}function F(t,e){if(1&t&&(m.ac(0,"div"),m.ac(1,"button",11),m.ac(2,"mat-icon"),m.Tc(3,"more_vert"),m.Zb(),m.Zb(),m.Zb()),2&t){m.mc();const t=m.Fc(8);m.Hb(1),m.uc("matMenuTriggerFor",t)}}function V(t,e){1&t&&(m.ac(0,"mat-header-cell"),m.ac(1,"span"),m.Tc(2),m.nc(3,"translate"),m.Zb(),m.Zb()),2&t&&(m.Hb(2),m.Uc(m.oc(3,1,"Motion")))}function N(t,e){if(1&t&&(m.ac(0,"mat-cell"),m.Tc(1),m.Zb()),2&t){const t=e.$implicit;m.Hb(1),m.Vc(" ",t.getTitle()," ")}}function B(t,e){1&t&&(m.ac(0,"mat-header-cell"),m.ac(1,"span"),m.Tc(2),m.nc(3,"translate"),m.Zb(),m.Zb()),2&t&&(m.Hb(2),m.Uc(m.oc(3,1,"State")))}function z(t,e){if(1&t&&(m.ac(0,"mat-cell",22),m.ac(1,"mat-basic-chip",23),m.Tc(2),m.Zb(),m.Zb()),2&t){const t=e.$implicit,n=m.mc(2);m.Hb(1),m.uc("ngClass",t.stateCssColor),m.Hb(1),m.Vc(" ",n.getStateLabel(t)," ")}}function G(t,e){1&t&&(m.ac(0,"mat-header-cell"),m.ac(1,"span"),m.Tc(2),m.nc(3,"translate"),m.Zb(),m.Zb()),2&t&&(m.Hb(2),m.Uc(m.oc(3,1,"Recommendation")))}function J(t,e){if(1&t&&(m.ac(0,"mat-basic-chip",25),m.Tc(1),m.Zb()),2&t){const t=m.mc().$implicit,e=m.mc(2);m.Hb(1),m.Vc(" ",e.getRecommendationLabel(t)," ")}}function K(t,e){if(1&t&&(m.ac(0,"mat-cell",22),m.Rc(1,J,2,1,"mat-basic-chip",24),m.Zb()),2&t){const t=e.$implicit;m.Hb(1),m.uc("ngIf",t.recommendation)}}function q(t,e){1&t&&m.Vb(0,"mat-header-cell")}const X=function(){return{back:"true"}};function Y(t,e){if(1&t&&(m.ac(0,"mat-cell"),m.Vb(1,"a",26),m.Zb()),2&t){const t=e.$implicit;m.Hb(1),m.uc("routerLink",t.getDetailStateURL())("state",m.zc(2,X))}}function A(t,e){1&t&&m.Vb(0,"mat-header-row")}function Q(t,e){1&t&&m.Vb(0,"mat-row")}function $(t,e){if(1&t&&(m.ac(0,"div"),m.ac(1,"h2"),m.ac(2,"span"),m.Tc(3),m.Zb(),m.Tc(4),m.Zb(),m.ac(5,"table",12),m.Yb(6,13),m.Rc(7,V,4,3,"mat-header-cell",14),m.Rc(8,N,2,1,"mat-cell",15),m.Xb(),m.Yb(9,16),m.Rc(10,B,4,3,"mat-header-cell",14),m.Rc(11,z,3,2,"mat-cell",17),m.Xb(),m.Yb(12,18),m.Rc(13,G,4,3,"mat-header-cell",14),m.Rc(14,K,2,1,"mat-cell",17),m.Xb(),m.Yb(15,19),m.Rc(16,q,1,0,"mat-header-cell",14),m.Rc(17,Y,2,3,"mat-cell",15),m.Xb(),m.Rc(18,A,1,0,"mat-header-row",20),m.Rc(19,Q,1,0,"mat-row",21),m.Zb(),m.Zb()),2&t){const t=e.$implicit,n=m.mc();m.Hb(3),m.Uc(n.getLevelDashes(t)),m.Hb(1),m.Vc(" ",t.prefixedName," "),m.Hb(1),m.uc("dataSource",n.dataSources[t.id]),m.Hb(13),m.uc("matHeaderRowDef",n.getColumnDefinition()),m.Hb(1),m.uc("matRowDefColumns",n.getColumnDefinition())}}function W(t,e){if(1&t){const t=m.bc();m.ac(0,"h1",27),m.ac(1,"span"),m.Tc(2),m.nc(3,"translate"),m.Zb(),m.Zb(),m.ac(4,"div",28),m.ac(5,"form",29),m.ic("ngSubmit",(function(){return m.Jc(t),m.mc().save()}))("keydown",(function(e){return m.Jc(t),m.mc().onKeyDown(e)})),m.ac(6,"mat-form-field"),m.Vb(7,"input",30),m.nc(8,"translate"),m.Zb(),m.ac(9,"mat-form-field"),m.Vb(10,"input",31),m.nc(11,"translate"),m.Zb(),m.Zb(),m.Zb(),m.ac(12,"div",32),m.ac(13,"button",33),m.ic("click",(function(){return m.Jc(t),m.mc().save()})),m.ac(14,"span"),m.Tc(15),m.nc(16,"translate"),m.Zb(),m.Zb(),m.ac(17,"button",34),m.ac(18,"span"),m.Tc(19),m.nc(20,"translate"),m.Zb(),m.Zb(),m.Zb()}if(2&t){const t=m.mc();m.Hb(2),m.Wc("",m.oc(3,9,"Edit details for")," ",t.selectedCategory.prefixedName,""),m.Hb(3),m.uc("formGroup",t.editForm),m.Hb(2),m.vc("placeholder",m.oc(8,11,"Prefix")),m.Hb(3),m.vc("placeholder",m.oc(11,13,"Name")),m.Hb(3),m.uc("disabled",!t.editForm.valid),m.Hb(2),m.Uc(m.oc(16,15,"Save")),m.Hb(2),m.uc("mat-dialog-close",null),m.Hb(2),m.Uc(m.oc(20,17,"Cancel"))}}let tt=(()=>{class t extends d.a{constructor(t,e,n,o,c,i,a,s,r,l,u){super(t,e,n),this.translate=e,this.route=o,this.operator=c,this.router=i,this.repo=a,this.motionRepo=s,this.promptService=r,this.fb=l,this.dialog=u,this.dataSources={}}get canEdit(){return this.operator.hasPerms(P.b.motionsCanManage)}ngOnInit(){const t=parseInt(this.route.snapshot.params.id,10);this.subscriptions.push(this.repo.getViewModelListObservable().subscribe(e=>{const n=e.findIndex(e=>e.id===t);if(n<0)return;let o;for(this.selectedCategory=e[n],super.setTitle(this.selectedCategory.prefixedName),o=n+1;o<e.length&&e[o].level>this.selectedCategory.level;o++);this.categories=e.slice(n,o),this.categories.forEach(t=>{const e=new y.o;e.data=t.motions,this.dataSources[t.id]=e})}))}getColumnDefinition(){return["title","state","recommendation","anchor"]}onDeleteButton(){return Object(s.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Are you sure you want to delete this category and all subcategories?"),e=this.selectedCategory.prefixedName;(yield this.promptService.open(t,e))&&(yield this.repo.delete(this.selectedCategory),this.router.navigate(["../"],{relativeTo:this.route}))}))}onKeyDown(t){"Escape"===t.key&&this.dialogRef.close(),"Enter"===t.key&&this.save()}save(){this.repo.update(this.editForm.value,this.selectedCategory).then(()=>this.dialogRef.close()).catch(this.raiseError)}toggleEditMode(){this.editForm=this.fb.group({prefix:[this.selectedCategory.prefix],name:[this.selectedCategory.name,O.G.required]}),this.dialogRef=this.dialog.open(this.editDialog,_.a)}getRecommendationLabel(t){return this.motionRepo.getExtendedRecommendationLabel(t)}getStateLabel(t){return this.motionRepo.getExtendedStateLabel(t)}getLevelDashes(t){return"\u2013".repeat(t.level-this.selectedCategory.level)}numberMotions(){return Object(s.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Are you sure you want to renumber all motions of this category?"),e=this.selectedCategory.getTitle();(yield this.promptService.open(t,e))&&(yield this.repo.numberMotionsInCategory(this.selectedCategory).catch(this.raiseError))}))}}return t.\u0275fac=function(e){return new(e||t)(m.Ub(b.d),m.Ub(h.k),m.Ub(g.a),m.Ub(i.a),m.Ub(P.a),m.Ub(i.f),m.Ub(r.a),m.Ub(Z.a),m.Ub(l.a),m.Ub(O.f),m.Ub(w.b))},t.\u0275cmp=m.Ob({type:t,selectors:[["os-category-detail"]],viewQuery:function(t,e){var n;1&t&&(m.Pc(E,!0),m.Pc(L,!0)),2&t&&(m.Ec(n=m.jc())&&(e.editForm=n.first),m.Ec(n=m.jc())&&(e.editDialog=n.first))},features:[m.Eb],decls:36,vars:17,consts:[[3,"nav"],[1,"title-slot"],[4,"ngIf"],[1,"menu-slot"],[4,"osPerms"],[4,"ngFor","ngForOf"],["categoryMenu","matMenu"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"routerLink"],["mat-menu-item","",1,"red-warning-text",3,"click"],["editDialog",""],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],["mat-table","",1,"os-headed-listview-table",3,"dataSource"],["matColumnDef","title"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","state"],["class","chip-container",4,"matCellDef"],["matColumnDef","recommendation"],["matColumnDef","anchor"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[1,"chip-container"],["disableRipple","",3,"ngClass"],["disableRipple","","class","bluegrey",4,"ngIf"],["disableRipple","",1,"bluegrey"],[3,"routerLink","state"],["mat-dialog-title",""],["mat-dialog-content","",1,"os-form-card-mobile"],[1,"edit-form",3,"formGroup","ngSubmit","keydown"],["matInput","","osAutofocus","","formControlName","prefix",3,"placeholder"],["matInput","","osAutofocus","","formControlName","name","required","",3,"placeholder"],["mat-dialog-actions",""],["type","submit","mat-button","","color","accent",3,"disabled","click"],["type","button","mat-button","",3,"mat-dialog-close"]],template:function(t,e){1&t&&(m.ac(0,"os-head-bar",0),m.ac(1,"div",1),m.Rc(2,j,2,1,"h2",2),m.Zb(),m.ac(3,"div",3),m.Rc(4,F,4,1,"div",4),m.Zb(),m.Zb(),m.ac(5,"mat-card"),m.Rc(6,$,20,5,"div",5),m.Zb(),m.ac(7,"mat-menu",null,6),m.ac(9,"button",7),m.ic("click",(function(){return e.toggleEditMode()})),m.ac(10,"mat-icon"),m.Tc(11,"edit"),m.Zb(),m.ac(12,"span"),m.Tc(13),m.nc(14,"translate"),m.Zb(),m.Zb(),m.ac(15,"button",8),m.ac(16,"mat-icon"),m.Tc(17,"sort"),m.Zb(),m.ac(18,"span"),m.Tc(19),m.nc(20,"translate"),m.Zb(),m.Zb(),m.ac(21,"button",7),m.ic("click",(function(){return e.numberMotions()})),m.ac(22,"mat-icon"),m.Tc(23,"format_list_numbered"),m.Zb(),m.ac(24,"span"),m.Tc(25),m.nc(26,"translate"),m.Zb(),m.Zb(),m.Vb(27,"mat-divider"),m.ac(28,"button",9),m.ic("click",(function(){return e.onDeleteButton()})),m.ac(29,"mat-icon"),m.Tc(30,"delete"),m.Zb(),m.ac(31,"span"),m.Tc(32),m.nc(33,"translate"),m.Zb(),m.Zb(),m.Zb(),m.Rc(34,W,21,19,"ng-template",null,10,m.Sc)),2&t&&(m.uc("nav",!1),m.Hb(2),m.uc("ngIf",e.selectedCategory),m.Hb(2),m.uc("osPerms","motions.can_manage"),m.Hb(2),m.uc("ngForOf",e.categories),m.Hb(7),m.Uc(m.oc(14,9,"Edit")),m.Hb(2),m.uc("routerLink","./sort"),m.Hb(4),m.Uc(m.oc(20,11,"Sort motions")),m.Hb(6),m.Uc(m.oc(26,13,"Number motions")),m.Hb(7),m.Uc(m.oc(33,15,"Delete")))},directives:[f.a,o.t,S.a,p.a,o.s,x.f,x.c,H.a,i.g,T.a,U.b,x.e,y.n,y.c,y.i,y.b,y.k,y.m,y.h,y.a,R.a,o.q,i.i,y.j,y.l,w.i,w.f,O.I,O.t,O.k,k.c,D.b,O.c,I.a,O.s,O.i,O.D,w.c,w.d],pipes:[h.j],styles:[".title-line[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.title-line[_ngcontent-%COMP%]   .icon-prefix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;font-size:16px;height:16px;width:16px}.title-line[_ngcontent-%COMP%]   .favorite-star[_ngcontent-%COMP%]{padding-right:3px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{position:absolute!important;top:0;right:0;bottom:0;left:0;opacity:.1;z-index:1}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{position:absolute;display:inherit;height:100%;width:100%;line-height:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2}.mat-table[_ngcontent-%COMP%]   .mat-table-sticky[_ngcontent-%COMP%]{z-index:3!important}.block-title[_ngcontent-%COMP%]{padding:40px 40px 40px 25px;line-height:180%;font-size:120%;color:#317796}.block-title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-weight:400}.block-card[_ngcontent-%COMP%]{margin:0 20px;padding:25px}.block-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:5px}.chip-container[_ngcontent-%COMP%]{display:block;min-height:0}.os-headed-listview-table[_ngcontent-%COMP%]   .mat-column-title[_ngcontent-%COMP%]{-ms-flex:4 0 0px;flex:4 0 0}.os-headed-listview-table[_ngcontent-%COMP%]   .mat-column-recommendation[_ngcontent-%COMP%], .os-headed-listview-table[_ngcontent-%COMP%]   .mat-column-state[_ngcontent-%COMP%]{-ms-flex:2 0 0px;flex:2 0 0}.os-headed-listview-table[_ngcontent-%COMP%]   .mat-column-remove[_ngcontent-%COMP%]{-ms-flex:1 0 0px;flex:1 0 0;-ms-flex-pack:end!important;justify-content:flex-end!important}.edit-form[_ngcontent-%COMP%]{overflow:hidden}"]}),t})();var et=n("AqIO"),nt=n("wL0i"),ot=n("0Obk"),ct=n("dRZP"),it=n("Qu3c");const at=["newCategoryDialog"];function st(t,e){if(1&t&&(m.ac(0,"div",8),m.ac(1,"button",9),m.ac(2,"mat-icon"),m.Tc(3,"more_vert"),m.Zb(),m.Zb(),m.Zb()),2&t){m.mc();const t=m.Fc(10);m.Hb(1),m.uc("matMenuTriggerFor",t)}}function rt(t,e){if(1&t&&(m.ac(0,"div",10),m.Vb(1,"a",11),m.ac(2,"div"),m.Tc(3),m.Zb(),m.Zb()),2&t){const t=e.row,n=m.mc();m.Hb(1),m.uc("routerLink",t.id),m.Hb(1),m.Qc("margin-left",n.getMargin(t)),m.Hb(1),m.Uc(t.prefixedName)}}function lt(t,e){if(1&t&&(m.ac(0,"div",10),m.ac(1,"span",12),m.nc(2,"translate"),m.Tc(3),m.Zb(),m.Zb()),2&t){const t=e.row;m.Hb(1),m.vc("matTooltip",m.oc(2,2,"Motions")),m.Hb(2),m.Uc(t.motions.length)}}function ut(t,e){1&t&&(m.ac(0,"mat-error"),m.Tc(1),m.nc(2,"translate"),m.Zb()),2&t&&(m.Hb(1),m.Vc(" ",m.oc(2,1,"A name is required")," "))}function dt(t,e){if(1&t){const t=m.bc();m.ac(0,"h1",13),m.ac(1,"span"),m.Tc(2),m.nc(3,"translate"),m.Zb(),m.Zb(),m.ac(4,"div",14),m.ac(5,"form",15),m.ic("keydown",(function(e){return m.Jc(t),m.mc().onKeyDown(e)})),m.ac(6,"p"),m.ac(7,"mat-form-field"),m.Vb(8,"input",16),m.nc(9,"translate"),m.Zb(),m.Zb(),m.ac(10,"p"),m.ac(11,"mat-form-field"),m.Vb(12,"input",17),m.nc(13,"translate"),m.Rc(14,ut,3,3,"mat-error",18),m.Zb(),m.Zb(),m.Zb(),m.Zb(),m.ac(15,"div",19),m.ac(16,"button",20),m.ac(17,"span"),m.Tc(18),m.nc(19,"translate"),m.Zb(),m.Zb(),m.ac(20,"button",21),m.ac(21,"span"),m.Tc(22),m.nc(23,"translate"),m.Zb(),m.Zb(),m.Zb()}if(2&t){const t=m.mc();m.Hb(2),m.Uc(m.oc(3,10,"New category")),m.Hb(3),m.uc("formGroup",t.createForm),m.Hb(3),m.vc("placeholder",m.oc(9,12,"Prefix")),m.Hb(4),m.vc("placeholder",m.oc(13,14,"Name")),m.Hb(2),m.uc("ngIf",!t.createForm.controls.name.valid),m.Hb(2),m.uc("disabled",!t.createForm.valid)("mat-dialog-close",!0),m.Hb(2),m.Uc(m.oc(19,16,"Save")),m.Hb(2),m.uc("mat-dialog-close",!1),m.Hb(2),m.Uc(m.oc(23,18,"Cancel"))}}const mt=function(){return["menu"]};let bt=(()=>{class t extends nt.a{constructor(t,e,n,o,c,i,a,s){super(t,e,n,o),this.repo=c,this.formBuilder=i,this.dialog=a,this.operator=s,this.tableColumnDefinition=[{prop:"title",width:"auto"},{prop:"amount",width:this.singleButtonWidth}],this.filterProps=["prefixedName"],this.createForm=this.formBuilder.group({prefix:[""],name:["",O.G.required],parent_id:[""]})}get canEdit(){return this.operator.hasPerms(P.b.motionsCanManage)}ngOnInit(){super.setTitle("Categories")}onPlusButton(){this.createForm.reset(),this.dialogRef=this.dialog.open(this.newCategoryDialog,_.a),this.dialogRef.afterClosed().subscribe(t=>{t&&this.save()})}save(){this.createForm.valid&&this.repo.create(this.createForm.value).catch(this.raiseError)}onKeyDown(t){"Enter"===t.key&&(this.save(),this.dialogRef.close()),"Escape"===t.key&&this.dialogRef.close()}getMargin(t){return 20*t.level+"px"}}return t.\u0275fac=function(e){return new(e||t)(m.Ub(b.d),m.Ub(h.k),m.Ub(g.a),m.Ub(et.a),m.Ub(r.a),m.Ub(O.f),m.Ub(w.b),m.Ub(P.a))},t.\u0275cmp=m.Ob({type:t,selectors:[["os-category-list"]],viewQuery:function(t,e){var n;1&t&&m.Pc(at,!0),2&t&&m.Ec(n=m.jc())&&(e.newCategoryDialog=n.first)},features:[m.Eb],decls:19,vars:20,consts:[["prevUrl","../..",3,"nav","hasMainButton","mainEvent"],[1,"title-slot"],["class","menu-slot",4,"osPerms"],["listStorageKey","category",3,"vScrollFixed","listObservableProvider","allowProjector","showListOfSpeakers","columns","filterProps","hiddenInMobile","dataSourceChange"],["class","cell-slot fill",4,"pblNgridCellDef"],["categoryMenu","matMenu"],["mat-menu-item","",3,"routerLink"],["newCategoryDialog",""],[1,"menu-slot"],["type","button","mat-icon-button","",3,"matMenuTriggerFor"],[1,"cell-slot","fill"],[1,"detail-link",3,"routerLink"],[1,"os-amount-chip",3,"matTooltip"],["mat-dialog-title",""],["mat-dialog-content","",1,"os-form-card-mobile"],[3,"formGroup","keydown"],["formControlName","prefix","matInput","",3,"placeholder"],["formControlName","name","matInput","","required","",3,"placeholder"],[4,"ngIf"],["mat-dialog-actions",""],["mat-button","",3,"disabled","mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,e){1&t&&(m.ac(0,"os-head-bar",0),m.ic("mainEvent",(function(){return e.onPlusButton()})),m.ac(1,"div",1),m.ac(2,"h2"),m.Tc(3),m.nc(4,"translate"),m.Zb(),m.Zb(),m.Rc(5,st,4,1,"div",2),m.Zb(),m.ac(6,"os-list-view-table",3),m.ic("dataSourceChange",(function(t){return e.onDataSourceChange(t)})),m.Rc(7,rt,4,4,"div",4),m.Rc(8,lt,4,4,"div",4),m.Zb(),m.ac(9,"mat-menu",null,5),m.ac(11,"button",6),m.ac(12,"mat-icon"),m.Tc(13,"sort"),m.Zb(),m.ac(14,"span"),m.Tc(15),m.nc(16,"translate"),m.Zb(),m.Zb(),m.Zb(),m.Rc(17,dt,24,20,"ng-template",null,7,m.Sc)),2&t&&(m.uc("nav",!1)("hasMainButton",e.canEdit),m.Hb(3),m.Uc(m.oc(4,15,"Categories")),m.Hb(2),m.uc("osPerms","motions.can_manage"),m.Hb(1),m.uc("vScrollFixed",64)("listObservableProvider",e.repo)("allowProjector",!1)("showListOfSpeakers",!1)("columns",e.tableColumnDefinition)("filterProps",e.filterProps)("hiddenInMobile",m.zc(19,mt)),m.Hb(1),m.uc("pblNgridCellDef","title"),m.Hb(1),m.uc("pblNgridCellDef","amount"),m.Hb(3),m.uc("routerLink","./sort"),m.Hb(4),m.Uc(m.oc(16,17,"Sort categories")))},directives:[f.a,S.a,ot.a,ct.c,x.f,x.c,i.g,H.a,U.b,x.e,i.i,it.c,w.i,w.f,O.I,O.t,O.k,k.c,O.c,D.b,O.s,O.i,O.D,o.t,w.c,w.d,k.b],pipes:[h.j],styles:[".title-line[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.title-line[_ngcontent-%COMP%]   .icon-prefix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;font-size:16px;height:16px;width:16px}.title-line[_ngcontent-%COMP%]   .favorite-star[_ngcontent-%COMP%]{padding-right:3px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{position:absolute!important;top:0;right:0;bottom:0;left:0;opacity:.1;z-index:1}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{position:absolute;display:inherit;height:100%;width:100%;line-height:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2}.mat-table[_ngcontent-%COMP%]   .mat-table-sticky[_ngcontent-%COMP%]{z-index:3!important}"]}),t})();var ht=n("2Vo4"),gt=n("Jc+d"),ft=n("IBZR");const pt=["sorter"];function vt(t,e){if(1&t&&(m.ac(0,"h2"),m.Tc(1),m.nc(2,"translate"),m.Zb()),2&t){const t=m.mc();m.Hb(1),m.Wc("",m.oc(2,2,"Sort motions")," (",t.category.prefixedName,")")}}function Ct(t,e){if(1&t){const t=m.bc();m.ac(0,"div"),m.ac(1,"span"),m.Tc(2),m.Zb(),m.ac(3,"span"),m.Tc(4),m.nc(5,"translate"),m.Zb(),m.ac(6,"button",6),m.ic("click",(function(){return m.Jc(t),m.mc().moveToPosition()})),m.ac(7,"span"),m.Tc(8),m.nc(9,"translate"),m.Zb(),m.Zb(),m.Zb()}if(2&t){const t=m.mc();m.Hb(2),m.Vc("",t.sortSelector.multiSelectedIndex.length,"\xa0"),m.Hb(2),m.Uc(m.oc(5,3,"selected")),m.Hb(4),m.Uc(m.oc(9,5,"move ..."))}}function Mt(t,e){if(1&t&&(m.ac(0,"mat-basic-chip",7),m.nc(1,"translate"),m.Tc(2),m.Zb()),2&t){const t=e.$implicit;m.vc("matTooltip",m.oc(1,2,"Sequential number")),m.Hb(2),m.Vc(" ",t.id," ")}}const Ot=[{path:"",component:bt,pathMatch:"full"},{path:":id/sort",component:(()=>{class t extends d.a{constructor(t,e,n,o,c,i,a,s){super(t,e,n),this.translate=e,this.promptService=o,this.repo=c,this.route=i,this.motionRepo=a,this.choiceService=s,this.motionsSubject=new ht.a([]),this.motionsCount=0,this.hasChanged=!1,this.motionsCopy=[],this.motionsBackup=[]}get isMultiSelect(){return this.sortSelector.multiSelectedIndex.length>0}get motionObservable(){return this.motionsSubject.asObservable()}ngOnInit(){const t=+this.route.snapshot.params.id;this.repo.getViewModelObservable(t).subscribe(t=>{this.category=t}),this.motionRepo.getViewModelListObservable().subscribe(e=>{const n=e.filter(e=>e.category_id===t);this.motionsBackup=[...n],this.motionsCount=n.length,0===this.motionsCopy.length?this.initializeList(n):this.motionsSubject.next(this.handleMotionUpdates(n))})}initializeList(t){t.sort((t,e)=>t.category_weight-e.category_weight),this.motionsSubject.next(t),this.motionsCopy=t}onListUpdate(t){this.hasChanged=!0,this.motionsCopy=t}onCancel(){return Object(s.a)(this,void 0,void 0,(function*(){(yield this.canDeactivate())&&(this.motionsSubject.next([]),this.initializeList(this.motionsBackup),this.hasChanged=!1)}))}sendUpdate(){return Object(s.a)(this,void 0,void 0,(function*(){const t=this.translate.instant("Do you really want to save your changes?");if(yield this.promptService.open(t)){const t=this.motionsCopy.map(t=>t.id);this.repo.sortMotionsInCategory(this.category.category,t),this.hasChanged=!1}}))}handleMotionUpdates(t){const e=this.motionsCopy;if(t.length>e.length)for(const n of t)this.motionsCopy.includes(n)||e.push(n);else if(t.length<e.length)for(const n of e)t.includes(n)||e.splice(e.indexOf(n),1);else for(const n of e)if(!t.includes(n)){const o=t.find(t=>t.id===n.id);e.splice(e.indexOf(n),1,o)}return e}canDeactivate(){return Object(s.a)(this,void 0,void 0,(function*(){if(this.hasChanged){const t=this.translate.instant("Do you really want to exit this page?"),e=this.translate.instant("You made changes.");return yield this.promptService.open(t,e)}return!0}))}moveToPosition(){return Object(s.a)(this,void 0,void 0,(function*(){if(this.sortSelector.multiSelectedIndex.length){const t=this.translate.instant("Move selected items ..."),e=this.sortSelector.sortedItems.filter(t=>!this.sortSelector.multiSelectedIndex.includes(t.id)),n=[this.translate.instant("Insert before"),this.translate.instant("Insert behind")],o=yield this.choiceService.open(t,e,!1,n);o&&this.sortSelector.drop({currentIndex:o.items,previousIndex:null},o.action===n[1])}}))}}return t.\u0275fac=function(e){return new(e||t)(m.Ub(b.d),m.Ub(h.k),m.Ub(g.a),m.Ub(l.a),m.Ub(r.a),m.Ub(i.a),m.Ub(Z.a),m.Ub(gt.a))},t.\u0275cmp=m.Ob({type:t,selectors:[["os-category-motions-sort"]],viewQuery:function(t,e){var n;1&t&&m.Pc(pt,!0),2&t&&m.Ec(n=m.jc())&&(e.sortSelector=n.first)},features:[m.Eb],decls:8,vars:5,consts:[[3,"editMode","nav","saveEvent","mainEvent"],[1,"title-slot"],[4,"ngIf"],[1,"os-form-card"],[3,"input","sortEvent"],["sorter",""],["mat-button","",3,"click"],["disableRipple","",1,"bluegrey",3,"matTooltip"]],template:function(t,e){1&t&&(m.ac(0,"os-head-bar",0),m.ic("saveEvent",(function(){return e.sendUpdate()}))("mainEvent",(function(){return e.onCancel()})),m.ac(1,"div",1),m.Rc(2,vt,3,4,"h2",2),m.Zb(),m.Zb(),m.ac(3,"mat-card",3),m.Rc(4,Ct,10,7,"div",2),m.ac(5,"os-sorting-list",4,5),m.ic("sortEvent",(function(t){return e.onListUpdate(t)})),m.Rc(7,Mt,3,4,"ng-template"),m.Zb(),m.Zb()),2&t&&(m.uc("editMode",e.hasChanged)("nav",!1),m.Hb(2),m.uc("ngIf",e.category),m.Hb(2),m.uc("ngIf",e.isMultiSelect),m.Hb(1),m.uc("input",e.motionObservable))},directives:[f.a,o.t,p.a,ft.a,U.b,R.a,it.c],pipes:[h.j],styles:[""]}),t})(),canDeactivate:[a.a]},{path:"sort",component:M,canDeactivate:[a.a]},{path:":id",component:tt}];let yt=(()=>{class t{}return t.\u0275mod=m.Sb({type:t}),t.\u0275inj=m.Rb({factory:function(e){return new(e||t)},imports:[[i.j.forChild(Ot)],i.j]}),t})(),Pt=(()=>{class t{}return t.\u0275mod=m.Sb({type:t}),t.\u0275inj=m.Rb({factory:function(e){return new(e||t)},imports:[[o.c,yt,c.a]]}),t})()},F48D:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var o=n("mrSG"),c=n("LBBb"),i=n("fXoL"),a=n("0IaG");let s=(()=>{class t{constructor(t){this.dialog=t}open(t,e=""){return Object(o.a)(this,void 0,void 0,(function*(){return this.dialog.open(c.a,{width:"250px",data:{title:t,content:e}}).afterClosed().toPromise()}))}}return t.\u0275fac=function(e){return new(e||t)(i.ec(a.b))},t.\u0275prov=i.Qb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"Jc+d":function(t,e,n){"use strict";n.d(e,"a",(function(){return O}));var o=n("mrSG"),c=n("Izkr"),i=n("0IaG"),a=n("fXoL"),s=n("3Pt+"),r=n("ofXK"),l=n("bTqV"),u=n("oqD5"),d=n("sYmb");function m(t,e){if(1&t&&(a.ac(0,"h2",2),a.Tc(1),a.nc(2,"translate"),a.Zb()),2&t){const t=a.mc();a.Hb(1),a.Uc(a.oc(2,1,t.data.title))}}function b(t,e){if(1&t&&(a.ac(0,"div",9),a.Vb(1,"os-search-value-selector",10),a.Zb()),2&t){const t=a.mc(2);a.Hb(1),a.uc("multiple",t.data.multiSelect)("formControl",t.selectForm.get("select"))("inputListValues",t.data.choices)}}function h(t,e){if(1&t){const t=a.bc();a.ac(0,"button",12),a.ic("click",(function(){a.Jc(t);const n=e.$implicit;return a.mc(3).closeDialog(!0,n)})),a.ac(1,"span"),a.Tc(2),a.nc(3,"translate"),a.Zb(),a.Zb()}if(2&t){const t=e.$implicit,n=a.mc(3);a.uc("disabled",!n.hasSelection),a.Hb(2),a.Uc(a.oc(3,2,t))}}function g(t,e){if(1&t&&(a.ac(0,"div"),a.Rc(1,h,4,4,"button",11),a.Zb()),2&t){const t=a.mc(2);a.Hb(1),a.uc("ngForOf",t.data.actionButtons)}}function f(t,e){if(1&t){const t=a.bc();a.ac(0,"button",12),a.ic("click",(function(){return a.Jc(t),a.mc(3).closeDialog(!0)})),a.ac(1,"span"),a.Tc(2,"OK"),a.Zb(),a.Zb()}if(2&t){const t=a.mc(3);a.uc("disabled",!t.hasSelection)}}function p(t,e){if(1&t&&(a.ac(0,"div"),a.Rc(1,f,3,1,"button",13),a.Zb()),2&t){const t=a.mc(2);a.Hb(1),a.uc("ngIf",!t.data.multiSelect||t.data.choices)}}function v(t,e){if(1&t){const t=a.bc();a.ac(0,"button",8),a.ic("click",(function(){a.Jc(t);const e=a.mc(2);return e.closeDialog(!0,e.data.clearChoice)})),a.ac(1,"span"),a.Tc(2),a.Zb(),a.Zb()}if(2&t){const t=a.mc(2);a.Hb(2),a.Uc(t.data.clearChoice)}}function C(t,e){if(1&t){const t=a.bc();a.ac(0,"form",3),a.Rc(1,b,2,3,"div",4),a.ac(2,"div",5),a.Rc(3,g,2,1,"div",6),a.Rc(4,p,2,1,"div",6),a.Rc(5,v,3,1,"button",7),a.ac(6,"button",8),a.ic("click",(function(){return a.Jc(t),a.mc().closeDialog(!1)})),a.ac(7,"span"),a.Tc(8),a.nc(9,"translate"),a.Zb(),a.Zb(),a.Zb(),a.Zb()}if(2&t){const t=a.mc();a.uc("formGroup",t.selectForm),a.Hb(1),a.uc("ngIf",t.data.choices),a.Hb(2),a.uc("ngIf",t.data.actionButtons),a.Hb(1),a.uc("ngIf",!t.data.actionButtons),a.Hb(1),a.uc("ngIf",t.data.clearChoice),a.Hb(3),a.Uc(a.oc(9,6,"Cancel"))}}let M=(()=>{class t{constructor(t,e,n){this.dialogRef=t,this.formBuilder=e,this.data=n,this.selectedMultiChoices=[],this.selectForm=this.formBuilder.group({select:[]})}get hasSelection(){return!(this.data&&this.data.choices&&(!this.selectForm.get("select").value||!this.selectForm.get("select").value&&!this.selectForm.get("select").value.length))}closeDialog(t,e){this.data.multiSelect||null!==this.selectedChoice||(e=this.data.clearChoice),t?this.dialogRef.close({action:e||null,items:this.selectForm.get("select").value}):this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(a.Ub(i.h),a.Ub(s.f),a.Ub(i.a))},t.\u0275cmp=a.Ob({type:t,selectors:[["os-choice-dialog"]],decls:2,vars:2,consts:[["mat-dialog-title","",4,"ngIf"],[3,"formGroup",4,"ngIf"],["mat-dialog-title",""],[3,"formGroup"],["mat-dialog-content","",4,"ngIf"],["mat-dialog-actions",""],[4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"click"],["mat-dialog-content",""],["ngDefaultControl","",3,"multiple","formControl","inputListValues"],["mat-button","",3,"disabled","click",4,"ngFor","ngForOf"],["mat-button","",3,"disabled","click"],["mat-button","",3,"disabled","click",4,"ngIf"]],template:function(t,e){1&t&&(a.Rc(0,m,3,3,"h2",0),a.Rc(1,C,10,8,"form",1)),2&t&&(a.uc("ngIf",e.data),a.Hb(1),a.uc("ngIf",e.data))},directives:[r.t,i.i,s.I,s.t,s.k,i.c,l.b,i.f,u.a,s.c,s.s,s.h,r.s],pipes:[d.j],styles:[".mat-form-field{width:100%}"],encapsulation:2}),t})(),O=(()=>{class t{constructor(t){this.dialog=t}open(t,e,n=!1,i,a){return Object(o.a)(this,void 0,void 0,(function*(){return this.dialog.open(M,Object.assign(Object.assign({},c.a),{data:{title:t,choices:e,multiSelect:n,actionButtons:i,clearChoice:a}})).afterClosed().toPromise()}))}}return t.\u0275fac=function(e){return new(e||t)(a.ec(i.b))},t.\u0275prov=a.Qb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},LBBb:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var o=n("0IaG"),c=n("fXoL"),i=n("ofXK"),a=n("bTqV"),s=n("sYmb");function r(t,e){if(1&t&&(c.ac(0,"div"),c.ac(1,"h2",1),c.Tc(2),c.Zb(),c.Vb(3,"mat-dialog-content",2),c.ac(4,"mat-dialog-actions"),c.ac(5,"button",3),c.Tc(6),c.nc(7,"translate"),c.Zb(),c.ac(8,"button",4),c.Tc(9),c.nc(10,"translate"),c.Zb(),c.Zb(),c.Zb()),2&t){const t=c.mc();c.Hb(2),c.Uc(t.data.title),c.Hb(1),c.uc("innerHTML",t.data.content,c.Kc),c.Hb(2),c.uc("mat-dialog-close",!0),c.Hb(1),c.Uc(c.oc(7,6,"Yes")),c.Hb(2),c.uc("mat-dialog-close",!1),c.Hb(1),c.Uc(c.oc(10,8,"Cancel"))}}let l=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(o.h),c.Ub(o.a))},t.\u0275cmp=c.Ob({type:t,selectors:[["os-prompt-dialog"]],decls:1,vars:1,consts:[[4,"ngIf"],["mat-dialog-title",""],[3,"innerHTML"],["mat-button","","color","warn",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,e){1&t&&c.Rc(0,r,11,10,"div",0),2&t&&c.uc("ngIf",e.data)},directives:[i.t,o.i,o.f,o.c,a.b,o.d],pipes:[s.j],encapsulation:2}),t})()},wL0i:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var o=n("mV3u");class c extends o.a{constructor(t,e,n,o){super(t,e,n),this.storage=o,this.canMultiSelect=!1,this._multiSelectMode=!1,this.singleButtonWidth="40px",this.badgeButtonWidth="45px",this.selectedRows=[]}onDataSourceChange(t){this.dataSource=t}toggleMultiSelect(){!this.canMultiSelect||this.isMultiSelect?(this._multiSelectMode=!1,this.deselectAll()):this._multiSelectMode=!0}selectAll(){this.dataSource.selection.select(...this.dataSource.filteredData)}deselectAll(){this.dataSource&&this.dataSource.selection.clear()}get isMultiSelect(){return this._multiSelectMode}}}}]);