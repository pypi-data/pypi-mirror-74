function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"30jZ":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("4X/P");function a(e){switch(e.type){case i.b.TYPE_REPLACEMENT:return"Replacement";case i.b.TYPE_INSERTION:return"Insertion";case i.b.TYPE_DELETION:return"Deletion";default:return e.other_description}}},BBYV:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("3Y4h"),a=n("fXoL"),r=function(){var e=function(){function e(){_classCallCheck(this,e),this.LI_MARGIN_BOTTOM=8,this.LINE_HEIGHT=1.25,this.P_MARGIN_BOTTOM=4,this.H_MARGIN_TOP=10,this.elementStyles={b:["font-weight:bold"],strong:["font-weight:bold"],u:["text-decoration:underline"],em:["font-style:italic"],i:["font-style:italic"],h1:["font-size:14","font-weight:bold"],h2:["font-size:12","font-weight:bold"],h3:["font-size:10","font-weight:bold"],h4:["font-size:10","font-style:italic"],h5:["font-size:10"],h6:["font-size:10"],a:["color:blue","text-decoration:underline"],strike:["text-decoration:line-through"],del:["color:red","text-decoration:line-through"],ins:["color:green","text-decoration:underline"]},this.classStyles={delete:["color:red","text-decoration:line-through"],insert:["color:green","text-decoration:underline"],paragraphcontext:["color:grey"]}}return _createClass(e,[{key:"getMarginTop",value:function(e){switch(e){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return this.H_MARGIN_TOP;default:return 0}}},{key:"getMarginBottom",value:function(e){switch(e){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":default:return this.P_MARGIN_BOTTOM}}},{key:"addPlainText",value:function(e){return{columns:[{stack:this.convertHtml(e,i.d.None)}]}}},{key:"convertHtml",value:function(e,t){var n=[];this.lineNumberingMode=t||i.d.None;for(var a=(new DOMParser).parseFromString(e,"text/html"),r=0,o=Array.from(a.body.childNodes);r<o.length;r++){var s=o[r],c=this.parseElement(s);n.push(c)}return n}},{key:"parseElement",value:function(e,t){var n,a=e.nodeName.toLowerCase(),r=[];if(t=t||[],e.getAttribute){var o=e.getAttribute("style"),s=e.getAttribute("class");if(o&&(t=o.split(";").map((function(e){return e.replace(/\s/g,"")})).concat(t)),s){var c,l=_createForOfIteratorHelper(r=s.toLowerCase().split(" "));try{for(l.s();!(c=l.n()).done;){var u=c.value;this.classStyles[u]&&this.classStyles[u].forEach((function(e){t.push(e)}))}}catch(k){l.e(k)}finally{l.f()}}}switch(a){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":case"p":case"div":var h=this.parseChildren(e,t);this.lineNumberingMode!==i.d.Outside||r.includes("insert")?(n=this.create("text")).text=h:(n=this.create("stack")).stack=h,n.margin=[0,0,0,0],n.margin[1]=this.getMarginTop(a),n.margin[3]=this.getMarginBottom(a),this.lineNumberingMode===i.d.Outside&&r.includes("insert")&&(n.margin[0]=20,n.margin[3]=this.P_MARGIN_BOTTOM),r.includes("os-split-before")&&(n.listType="none"),(r.includes("os-split-after")||this.withSublist(e))&&(n.margin[3]=0),n.lineHeight=this.LINE_HEIGHT,n=Object.assign(Object.assign(Object.assign({},n),this.computeStyle(t)),this.computeStyle(this.elementStyles[a]));break;case"a":case"b":case"strong":case"u":case"em":case"i":case"ins":case"del":case"strike":var d=this.parseChildren(e,t.concat(this.elementStyles[a]));(n=this.create("text")).text=d;break;case"span":if(e.getAttribute("data-line-number")&&!this.isInsideAList(e)){if(this.lineNumberingMode===i.d.Inside);else if(this.lineNumberingMode===i.d.Outside){var f=e.getAttribute("data-line-number");n={columns:[this.getLineNumberObject({lineNumber:+f}),{text:[]}]}}}else{var m=this.parseChildren(e,t);(n=Object.assign(Object.assign({},this.create("text")),this.computeStyle(t))).text=m}break;case"br":if(this.lineNumberingMode===i.d.None&&r.includes("os-line-break")||this.lineNumberingMode===i.d.Outside&&this.isInsideAList(e))break;(n=this.create("text")).text="\n",n.lineHeight=this.LINE_HEIGHT;break;case"ul":case"ol":var g=this.create(a);if("ol"===a){var p=e.getAttribute("start");p&&(g.start=parseInt(p,10))}if(this.lineNumberingMode===i.d.Outside){var v=this.extractLineNumbers(e),b=this.cleanLineNumbers(e),y=this.parseChildren(b,t);if(v.length>0){var T={columns:[{width:20,stack:[]}],margin:[0,0,0,0]};this.isFakeList(e)&&(T.margin[3]=-this.LI_MARGIN_BOTTOM);var x,S=_createForOfIteratorHelper(v);try{for(S.s();!(x=S.n()).done;){var _=x.value;T.columns[0].stack.push(this.getLineNumberObject(_))}}catch(k){S.e(k)}finally{S.f()}g[a]=y,T.columns.push(g),n=T}else g.margin=[20,0,0,0],(n=g)[a]=y}else{var L=this.parseChildren(e,t);(n=g)[a]=L}break;default:n=Object.assign(Object.assign({},this.create("text",e.textContent.replace(/\n/g,""))),this.computeStyle(t))}return n}},{key:"parseChildren",value:function(e,t){var n=Array.from(e.childNodes),a=[];if(n.length>0){var r,o=_createForOfIteratorHelper(n);try{for(o.s();!(r=o.n()).done;){var s=r.value;if("#text"!==s.nodeName||""!==s.textContent.trim()){var c=this.parseElement(s,t),l=e.firstChild;if(this.lineNumberingMode===i.d.Outside&&s&&s.classList&&s.classList.contains("os-line-number"))a.push(c);else if(this.lineNumberingMode===i.d.Outside&&l&&l.classList&&l.classList.contains("os-line-number")){var u=a.pop();u.columns[1].text.push(c),a.push(u)}else a.push(c)}}}catch(h){o.e(h)}finally{o.f()}}return a}},{key:"getLineNumberObject",value:function(e){return{width:20,text:[{text:" ",fontSize:10,decoration:""},{text:e.lineNumber,color:"gray",fontSize:8}],marginBottom:e.marginBottom,lineHeight:this.LINE_HEIGHT}}},{key:"withSublist",value:function(e){return"li"===e.nodeName.toLowerCase()&&Array.from(e.children).some((function(e){return"ul"===e.nodeName.toLowerCase()}))}},{key:"cleanLineNumbers",value:function(e){for(var t=e.cloneNode(!0),n=t.childNodes,i=0;i<n.length;i++)if(this.getLineNumber(n[i])&&n[i].remove(),n[i].childNodes.length>0){var a=this.cleanLineNumbers(n[i]);t.replaceChild(a,n[i])}return t}},{key:"extractLineNumbers",value:function(e){var t=[],n=this.getLineNumber(e);if(n)t.push({lineNumber:n});else if("BR"===e.nodeName)this.getLineNumber(e.nextSibling)||t.push({lineNumber:""});else{for(var i=Array.from(e.childNodes),a=i.length,r=[],o=0;o<i.length;o++)r=r.concat(this.extractLineNumbers(i[o])),i.length<a&&(o-=a-i.length,a=i.length);r.length&&"LI"===e.nodeName?r[r.length-1].marginBottom=this.LI_MARGIN_BOTTOM:r.length&&"LI"===e.parentNode.nodeName&&(r[r.length-1].marginBottom=this.P_MARGIN_BOTTOM),t=t.concat(r)}return t}},{key:"isInsideAList",value:function(e){for(var t=e.parentNode;null!==t;){if("UL"===t.nodeName||"OL"===t.nodeName)return!0;t=t.parentNode}return!1}},{key:"isFakeList",value:function(e){if(e.firstElementChild&&e.classList.contains("os-split-after")){var t=e.firstElementChild,n=e.childNodes[e.childNodes.length-1],i="LI"===t.nodeName&&t.classList.contains("os-split-before"),a="LI"===n.nodeName&&n.classList.contains("os-split-after");return i||a}return!1}},{key:"getLineNumber",value:function(e){if(e&&"SPAN"===e.nodeName&&e.getAttribute("class")&&e.getAttribute("class").indexOf("os-line-number")>-1)return parseInt(e.getAttribute("data-line-number"),10)}},{key:"computeStyle",value:function(e){var t={};if(e&&e.length>0){var n,i=_createForOfIteratorHelper(e);try{for(i.s();!(n=i.n()).done;){var a=n.value.trim().toLowerCase().split(":"),r=a[0],o=a[1];if(2===a.length)switch(r){case"padding-left":t.margin=[parseInt(o,10),0,0,0];break;case"font-size":t.fontSize=parseInt(o,10);break;case"text-align":switch(o){case"right":case"center":case"justify":t.alignment=o}break;case"font-weight":switch(o){case"bold":t.bold=!0}break;case"text-decoration":switch(o){case"underline":t.decoration="underline";break;case"line-through":t.decoration="lineThrough"}break;case"font-style":switch(o){case"italic":t.italics=!0}break;case"color":t.color=this.parseColor(o);break;case"background-color":t.background=this.parseColor(o)}}}catch(s){i.e(s)}finally{i.f()}}return t}},{key:"parseColor",value:function(e){var t=new RegExp("^#([0-9a-f]{3}|[0-9a-f]{6})$"),n=new RegExp("^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$"),i=new RegExp("^[a-z]+$");if(t.test(e))return e;if(n.test(e)){for(var a=n.exec(e).slice(1),r=0;r<3;r++){var o=parseInt(a[r],10);o>255&&(o=255);var s="0"+o.toString(16);s=s.slice(-2),a[r]=s}return"#"+a.join("")}return i.test(e)||console.error('Could not parse color "'+e+'"'),e}},{key:"create",value:function(e,t){var n={};return n[e]=t||[],n}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=a.Qb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},y50V:function(e,t,n){"use strict";n.d(t,"a",(function(){return N}));var i,a,r,o,s=n("BBYV"),c=n("dOok"),l=n("fXoL"),u=n("sYmb"),h=((i=function(){function e(t,n,i){_classCallCheck(this,e),this.motionRepo=t,this.translate=n,this.htmlToPdfService=i}return _createClass(e,[{key:"renderDiffLines",value:function(e){if(e.diffLines&&e.diffLines.length){var t=e.diffLines.map((function(e){return e.text})).join("<br />[...]<br />");return this.htmlToPdfService.convertHtml(t)}}},{key:"amendmentToTableRow",value:function(e){var t="";return e.recommendation&&(t+=e.recommendation.show_recommendation_extension_field&&e.recommendationExtension?" "+this.motionRepo.getExtendedRecommendationLabel(e):this.translate.instant(e.recommendation.recommendation_label)),[{text:e.identifierOrTitle},{text:e.getChangeLines()},{text:e.submittersAsUsers.toString()},{stack:this.renderDiffLines(e)},{text:t}]}},{key:"overviewToDocDef",value:function(e,t){var n,i={text:e,style:"title"},a=[[{text:this.translate.instant("Motion"),style:"tableHeader"},{text:this.translate.instant("Line"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Changes"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"}]],r=[],o=_createForOfIteratorHelper(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push(this.amendmentToTableRow(s))}}catch(c){o.e(c)}finally{o.f()}return[i,{table:{widths:["auto","auto","auto","*","auto"],headerRows:1,dontBreakRows:!0,body:a.concat(r)},layout:"switchColorTableLayout"}]}}]),e}()).\u0275fac=function(e){return new(e||i)(l.ec(c.a),l.ec(u.k),l.ec(s.a))},i.\u0275prov=l.Qb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),d=n("a9GI"),f=n("+KbT"),m=n("iTQr"),g=n("pSLD"),p=n("+B0n"),v=n("Mluu"),b=n("a9XT"),y=n("GEzB"),T=n("j7f2"),x=n("6ako"),S=n("30jZ"),_=n("ykax"),L=n("3Y4h"),k=((o=function(){function e(t,n,i,a,r,o,s,c,l,u,h,d){_classCallCheck(this,e),this.translate=t,this.motionRepo=n,this.statuteRepo=i,this.changeRecoRepo=a,this.configService=r,this.pdfDocumentService=o,this.htmlToPdfService=s,this.linenumberingService=c,this.commentRepo=l,this.pollKeyVerbose=u,this.parsePollNumber=h,this.motionPollService=d,this.getRecommendationTypeName=S.a}return _createClass(e,[{key:"motionToDocDef",value:function(e,t){var n=t&&t.lnMode?t.lnMode:null,i=t&&t.crMode?t.crMode:null,a=t?t.metaInfo:null,r=t?t.content:null,o=t?t.comments:null,s=this.configService.instant("motions_line_length"),c=this.configService.instant("motions_export_follow_recommendation"),l=[];e.isStatuteAmendment()&&(n=L.d.None,i=L.b.Diff),n||(n=this.configService.instant("motions_default_line_numbering")),i||(i=this.configService.instant("motions_recommendation_text_mode"));var u=this.createTitle(e,i,s),h=!a||a.includes("id");if(l=[u,this.createSubtitle(e,h)],a&&a.length>0||!a){var d=this.createMetaInfoTable(e,s,i,a,c);l.push(d)}if(!r||r.includes("text")){var f=this.createPreamble(e);l.push(f);var m=this.createText(e,s,n,i);l.push(m)}if(!r||r.includes("reason")){var g=this.createReason(e,n);l.push(g)}return a&&a.includes("allcomments")&&(o=this.commentRepo.getViewModelList().map((function(e){return e.id}))),o&&l.push(this.createComments(e,o)),l}},{key:"createTitle",value:function(e,t,n){var i=this.getUnifiedChanges(e,n).find((function(e){return e.isTitleChange()})),a=this.changeRecoRepo.getTitleWithChanges(e.title,i,t),r=e.identifier?" "+e.identifier:"",o="";return"A4"===this.configService.instant("general_export_pdf_pagesize")&&(o+=this.translate.instant("Motion")+" "),{text:o+="".concat(r,": ").concat(a),style:"title"}}},{key:"createSubtitle",value:function(e,t){var n=[];return t&&n.push("".concat(this.translate.instant("Sequential number"),": ").concat(e.id)),e.parent_id&&(t&&n.push(" \u2022 "),n.push("".concat(this.translate.instant("Amendment to")," ").concat(e.parent.identifier||e.parent.title))),{text:n,style:"subtitle"}}},{key:"createMetaInfoTable",value:function(e,t,n,i,a){var r,o,s=this,c=[];if(!i||i.includes("submitters")){var l=e.submittersAsUsers.map((function(e){return e.full_name})).join(", ");c.push([{text:this.translate.instant("Submitters")+":",style:"boldText"},{text:l}])}if(this.configService.instant("motions_min_supporters")&&e.supporters.length>0){var u=e.supporters.map((function(e){return e.full_name})).join(", ");c.push([{text:this.translate.instant("Supporters")+":",style:"boldText"},{text:u}])}(i&&!i.includes("state")||c.push([{text:this.translate.instant("State")+":",style:"boldText"},{text:this.motionRepo.getExtendedStateLabel(e)}]),!e.recommendation||i&&!i.includes("recommendation")||(r=e.isStatuteAmendment()?this.configService.instant("motions_statute_recommendations_by"):this.configService.instant("motions_recommendations_by"),c.push([{text:r+":",style:"boldText"},{text:this.motionRepo.getExtendedRecommendationLabel(e)}])),!e.category||i&&!i.includes("category"))||(o=e.category.parent?"".concat(e.category.parent.toString(),"\n").concat(this.translate.instant("Subcategory"),": ").concat(e.category.toString()):e.category.toString(),c.push([{text:this.translate.instant("Category")+":",style:"boldText"},{text:o}]));if(e.tags.length&&(!i||i.includes("tags"))){var h=e.tags.map((function(e){return e})).join(", ");c.push([{text:this.translate.instant("Tags")+":",style:"boldText"},{text:h}])}if(!e.motion_block||i&&!i.includes("motion_block")||c.push([{text:this.translate.instant("Motion block")+":",style:"boldText"},{text:e.motion_block.title}]),!e.origin||i&&!i.includes("origin")||c.push([{text:this.translate.instant("Origin")+":",style:"boldText"},{text:e.origin}]),e.polls.length&&(!i||i.includes("polls"))){var d=[],f=[],m=[];e.polls.forEach((function(e){e.hasVotes&&s.motionPollService.generateTableData(e).forEach((function(t){var n=s.translate.instant(s.pollKeyVerbose.transform(t.votingOption)),i=t.value[0],a=s.parsePollNumber.transform(i.amount);if(d.push(n+":"),i.showPercent){var r=s.motionPollService.getVoteValueInPercent(i.amount,e);f.push(null!==r?"(".concat(r,")"):"")}else f.push("");m.push(a)}))})),c.push([{text:this.translate.instant("Voting result")+":",style:"boldText"},{columns:[{text:d.join("\n"),width:"auto"},{text:f.join("\n"),width:"auto",alignment:"right"},{text:m.join("\n"),width:"auto",alignment:"right"}],columnGap:7}])}var g=this.getUnifiedChanges(e,t);if(n===L.b.Diff&&g.length>0){var p=[],v=[];g.forEach((function(e){if(e.isTitleChange()){var t=e;p.push(s.translate.instant("Title")+": "),v.push("(".concat(s.translate.instant("Change recommendation"),") - ").concat(s.translate.instant(s.getRecommendationTypeName(t))))}else{var n;if(n=e.getLineFrom()>=e.getLineTo()-1?e.getLineFrom():e.getLineFrom()+" - "+(e.getLineTo()-1),e.getChangeType()===y.a.TYPE_CHANGE_RECOMMENDATION){var i=e;p.push("".concat(s.translate.instant("Line")," ").concat(n,": ")),v.push("(".concat(s.translate.instant("Change recommendation"),") - ").concat(s.translate.instant(s.getRecommendationTypeName(i))))}else if(e.getChangeType()===y.a.TYPE_AMENDMENT){var a=e,r="(".concat(s.translate.instant("Amendment")," ").concat(a.getIdentifier(),") -");a.isRejected()?r+=" "+s.translate.instant("Rejected"):a.isAccepted()&&(r+=" "+s.translate.instant(a.stateName),p.push("".concat(s.translate.instant("Line")," ").concat(n,": ")),v.push(r))}}})),v.length>0&&c.push([{text:this.translate.instant("Summary of changes:"),style:"boldText"},{columns:[{text:p.join("\n"),width:"auto"},{text:v.join("\n"),width:"auto"}],columnGap:7}])}if(a&&c.push([{text:this.translate.instant("Decision")+":",style:"boldText"},{margin:[5,2,0,2],columns:[{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("As recommendation")},{width:20,text:""},{width:8,canvas:this.pdfDocumentService.drawCircle(6.5,4)},{width:"auto",text:this.translate.instant("Divergent:")}]}]),c.length>0)return{table:{widths:["35%","65%"],body:c},margin:[0,0,0,20],layout:"metaboxLayout"}}},{key:"createPreamble",value:function(e){var t=this.configService.instant("motions_preamble");return{text:""+this.translate.instant(t),margin:[0,10,0,10]}}},{key:"createText",value:function(e,t,n,i){var a="";if(e.isParagraphBasedAmendment()){var r,o=this.changeRecoRepo.getChangeRecoOfMotion(e.id),s=_createForOfIteratorHelper(this.motionRepo.getAmendmentParagraphLines(e,t,i,o,!1));try{for(s.s();!(r=s.n()).done;){var c=r.value;a+="<h3>"+this.motionRepo.getAmendmentParagraphLinesTitle(c)+"</h3>",a+='<div class="paragraphcontext">'.concat(c.textPre,"</div>"),a+=c.text,a+='<div class="paragraphcontext">'.concat(c.textPost,"</div>")}}catch(g){s.e(g)}finally{s.f()}}else if(e.isStatuteAmendment()){var l=this.statuteRepo.getViewModelList();a=this.motionRepo.formatStatuteAmendment(l,e,t)}else{var u=this.getUnifiedChanges(e,t),h=u.filter((function(e){return!e.isTitleChange()})),d=u.find((function(e){return e.isTitleChange()}));if(i===L.b.Diff&&d){var f=this.changeRecoRepo.getTitleChangesAsDiff(e.title,d);a+="<span><strong>"+this.translate.instant("Changed title")+":</strong><br>"+f+"</span><br>"}var m=this.motionRepo.formatMotion(e.id,i,h,t);a+=this.linenumberingService.splitInlineElementsAtLineBreaks(m)}return this.htmlToPdfService.convertHtml(a,n)}},{key:"getUnifiedChanges",value:function(e,t){var n=this,i=this.changeRecoRepo.getChangeRecoOfMotion(e.id);return i&&i.length?i.concat(this.motionRepo.getAmendmentsInstantly(e.id).flatMap((function(e){var i=n.changeRecoRepo.getChangeRecoOfMotion(e.id).filter((function(e){return e.showInFinalView()}));if(i&&i.length)return n.motionRepo.getAmendmentAmendedParagraphs(e,t,i)}))).sort((function(e,t){return e.getLineFrom()-t.getLineFrom()})):[]}},{key:"createReason",value:function(e,t){if(e.reason){var n=[];return n.push({text:this.translate.instant("Reason"),style:"heading3",margin:[0,25,0,10]}),n.push(this.htmlToPdfService.addPlainText(e.reason)),n}return{}}},{key:"callListToDoc",value:function(e){var t=this;e.sort((function(e,t){return e.weight-t.weight}));var n={text:this.translate.instant("Call list"),style:"title"},i=[[{text:this.translate.instant("Called"),style:"tableHeader"},{text:this.translate.instant("Called with"),style:"tableHeader"},{text:this.translate.instant("Submitters"),style:"tableHeader"},{text:this.translate.instant("Title"),style:"tableHeader"},{text:this.translate.instant("Recommendation"),style:"tableHeader"},{text:this.translate.instant("Notes"),style:"tableHeader"}]],a=[],r="";return e.forEach((function(e){if(!e.sort_parent_id){var n=e.tags?e.tags.map((function(e){return e.name})).join(", "):"";n!==r&&(a.push([{text:n,colSpan:6,style:"heading3",margin:[0,10,0,10]},"","","","",""]),r=n)}a.push(t.createCallListRow(e))})),[n,{table:{widths:["auto","auto","auto","*","auto","auto"],headerRows:1,dontBreakRows:!0,body:i.concat(a)},layout:"switchColorTableLayout"}]}},{key:"createCallListRow",value:function(e){return[{text:e.sort_parent_id?"":e.identifierOrTitle},{text:e.sort_parent_id?e.identifierOrTitle:""},{text:e.submitters.length?e.submittersAsUsers.map((function(e){return e.short_name})).join(", "):""},{text:e.title},{text:e.recommendation?this.motionRepo.getExtendedRecommendationLabel(e):""},{text:""}]}},{key:"textToDocDef",value:function(e,t,n){var i=this.configService.instant("motions_line_length"),a=this.configService.instant("motions_recommendation_text_mode"),r=this.createTitle(t,a,i),o=this.createSubtitle(t),s=this.createMetaInfoTable(t,i,a,["submitters","state","category"]),c=this.htmlToPdfService.convertHtml(e,L.d.None);return[r,o,s,{text:this.translate.instant(n),style:"heading2"},c]}},{key:"createComments",value:function(e,t){var n,i=[],a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var r=n.value,o="",s="";if(r===L.f)o=this.translate.instant("Personal note"),s=e&&e.personalNote&&e.personalNote.note;else{var c=this.commentRepo.getViewModel(r),l=e.getCommentForSection(c);o=c.name,s=l&&l.comment}o&&s&&(i.push({text:o,style:"heading3",margin:[0,25,0,10]}),i.push(this.htmlToPdfService.addPlainText(s)))}}catch(u){a.e(u)}finally{a.f()}return i}}]),e}()).\u0275fac=function(e){return new(e||o)(l.ec(u.k),l.ec(c.a),l.ec(v.a),l.ec(g.a),l.ec(f.a),l.ec(d.b),l.ec(s.a),l.ec(b.a),l.ec(p.a),l.ec(x.a),l.ec(T.a),l.ec(_.a))},o.\u0275prov=l.Qb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),w=((r=function(){function e(t,n,i,a,r,o){_classCallCheck(this,e),this.translate=t,this.configService=n,this.motionPdfService=i,this.pdfService=a,this.motionRepo=r,this.categoryRepo=o,this.categoryObserver=this.categoryRepo.getViewModelListBehaviorSubject()}return _createClass(e,[{key:"motionListToDocDef",value:function(e,t){for(var n=[],i=[],a=t.pdfOptions.includes("toc"),r=t.pdfOptions.includes("addBreaks"),o=0;o<e.length;++o)try{var s=this.motionPdfService.motionToDocDef(e[o],t);s[0].id=""+e[o].id,i.push(s),o<e.length-1&&r?i.push(this.pdfService.getPageBreak()):o<e.length-1&&!r&&i.push(this.pdfService.getSpacer())}catch(l){var c="".concat(this.translate.instant("Error during PDF creation of motion:")," ").concat(e[o].identifierOrTitle);throw console.error(c+"\nDebugInfo:\n",l),new d.c(c)}return e.length>1&&(!t.pdfOptions||a)&&n.push(this.pdfService.createTitle("motions_export_title"),this.pdfService.createPreamble("motions_export_preamble"),this.createToc(e)),n=n.concat(i)}},{key:"createToc",value:function(e,t){var n=this,i=[],a=this.categoryObserver.value,r={text:this.translate.instant("Table of contents"),style:"heading2"},o=this.configService.instant("motions_export_submitter_recommendation"),s=o?this.getTocHeaderDefinition():void 0,c=o?d.a.LIGHT_HORIZONTAL_LINES:d.a.DEFAULT;if(a&&a.length){var l,u=[],h=_createForOfIteratorHelper(a.sort((function(e,t){return e.weight-t.weight})));try{var f=function(){var t=l.value,i=e.filter((function(e){return t===e.category}));if(i&&i.length){u.length&&u.push(n.pdfService.getPageBreak()),u.push({table:{body:[[{text:t.nameWithParentAbove,style:t.parent?"tocSubcategoryTitle":"tocCategoryTitle"}]]},layout:o?"lightHorizontalLines":"noBorders"});var a,r=[],h=_createForOfIteratorHelper(i);try{for(h.s();!(a=h.n()).done;){var f=a.value;r.push(o?n.appendSubmittersAndRecommendation(f,d.d.CATEGORY_SECTION):n.pdfService.createTocLine(""+(f.identifier?f.identifier:""),f.title,""+f.id,d.d.CATEGORY_SECTION))}}catch(m){h.e(m)}finally{h.f()}u.push(n.pdfService.createTocTableDef(r,d.d.CATEGORY_SECTION,c,s?JSON.parse(JSON.stringify(s)):null))}};for(h.s();!(l=h.n()).done;)f()}catch(y){h.e(y)}finally{h.f()}var m=e.filter((function(e){return!e.category})).map((function(e){return n.pdfService.createTocLine(""+(e.identifier?e.identifier:""),e.title,""+e.id)}));m.length>0&&(u.push(this.pdfService.getPageBreak()),u.push(this.pdfService.createTocTableDef(m,d.d.CATEGORY_SECTION))),i.push(u)}else{var g,p=[],v=_createForOfIteratorHelper(e);try{for(v.s();!(g=v.n()).done;){var b=g.value;p.push(o?this.appendSubmittersAndRecommendation(b):this.pdfService.createTocLine(""+(b.identifier?b.identifier:""),b.title,""+b.id))}}catch(y){v.e(y)}finally{v.f()}i.push(this.pdfService.createTocTableDef(p,d.d.CATEGORY_SECTION,c,s))}return[r,i,this.pdfService.getPageBreak()]}},{key:"getTocHeaderDefinition",value:function(){return[{text:this.translate.instant("Identifier"),style:"tocHeaderRow"},{style:"tocHeaderRow",text:["".concat(this.translate.instant("Title")," \xb7 ").concat(this.translate.instant("Submitters")," \xb7 "),{text:""+this.translate.instant("Recommendation"),italics:!0}]},{text:this.translate.instant("Page"),style:"tocHeaderRow",alignment:"right"}]}},{key:"appendSubmittersAndRecommendation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.d.DEFAULT,n="",i="";i=e.state.isFinalState?this.motionRepo.getExtendedStateLabel(e):this.motionRepo.getExtendedRecommendationLabel(e);for(var a=0;a<e.submitters.length;++a)n+=a!==e.submitters.length-1?e.submitters[a].getTitle()+", ":e.submitters[a].getTitle();return this.pdfService.createTocLine(""+(e.identifier?e.identifier:""),e.title,""+e.id,t,this.pdfService.createTocLineInline(n),this.pdfService.createTocLineInline(i,!0))}}]),e}()).\u0275fac=function(e){return new(e||r)(l.ec(u.k),l.ec(f.a),l.ec(k),l.ec(d.b),l.ec(c.a),l.ec(m.a))},r.\u0275prov=l.Qb({token:r,factory:r.\u0275fac,providedIn:"root"}),r),N=((a=function(){function e(t,n,i,a,r,o){_classCallCheck(this,e),this.translate=t,this.configService=n,this.motionPdfService=i,this.amendmentListPdfService=a,this.pdfCatalogService=r,this.pdfDocumentService=o}return _createClass(e,[{key:"exportSingleMotion",value:function(e,t){var n=this.motionPdfService.motionToDocDef(e,t),i="".concat(this.translate.instant("Motion")," ").concat(e.identifierOrTitle);this.pdfDocumentService.download(n,i,{title:i})}},{key:"exportMotionCatalog",value:function(e,t){var n=this.pdfCatalogService.motionListToDocDef(e,t),i=this.configService.instant("motions_export_title"),a=this.translate.instant(i);this.pdfDocumentService.download(n,a,{title:a},t)}},{key:"exportPdfCallList",value:function(e){var t=this.motionPdfService.callListToDoc(e),n=this.translate.instant("Call list");this.pdfDocumentService.downloadLandscape(t,n,{title:n})}},{key:"exportPersonalNote",value:function(e,t){var n=this.motionPdfService.textToDocDef(e.note,t,"Personal note"),i="".concat(t.identifierOrTitle," - ").concat(this.translate.instant("Personal note"));this.pdfDocumentService.download(n,i,{title:i})}},{key:"exportComment",value:function(e,t){var n=t.getCommentForSection(e);if(n&&n.comment){var i=this.motionPdfService.textToDocDef(n.comment,t,e.name),a="".concat(t.identifierOrTitle," - ").concat(e.name);this.pdfDocumentService.download(i,a,{title:a})}}},{key:"exportAmendmentList",value:function(e,t){var n;n=t?"".concat(this.translate.instant("Amendments to")," ").concat(t.getListTitle()):""+this.translate.instant("Amendments");var i=this.amendmentListPdfService.overviewToDocDef(n,e);this.pdfDocumentService.downloadLandscape(i,n,{title:n})}}]),e}()).\u0275fac=function(e){return new(e||a)(l.ec(u.k),l.ec(f.a),l.ec(k),l.ec(h),l.ec(w),l.ec(d.b))},a.\u0275prov=l.Qb({token:a,factory:a.\u0275fac,providedIn:"root"}),a)}}]);