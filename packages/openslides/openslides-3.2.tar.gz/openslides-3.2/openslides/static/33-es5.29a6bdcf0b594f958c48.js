function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=_superPropBase(t,e);if(a){var c=Object.getOwnPropertyDescriptor(a,e);return c.get?c.get.call(n):c.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var n,a=_getPrototypeOf(t);if(e){var c=_getPrototypeOf(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[33,36],{F48D:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n("mrSG"),c=n("LBBb"),o=n("fXoL"),i=n("0IaG"),r=function(){var t=function(){function t(e){_classCallCheck(this,t),this.dialog=e}return _createClass(t,[{key:"open",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.dialog.open(c.a,{width:"250px",data:{title:t,content:e}}).afterClosed().toPromise());case 1:case"end":return n.stop()}}),n,this)})))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(o.ec(i.b))},t.\u0275prov=o.Qb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},LBBb:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var a=n("0IaG"),c=n("fXoL"),o=n("ofXK"),i=n("bTqV"),r=n("sYmb");function l(t,e){if(1&t&&(c.ac(0,"div"),c.ac(1,"h2",1),c.Tc(2),c.Zb(),c.Vb(3,"mat-dialog-content",2),c.ac(4,"mat-dialog-actions"),c.ac(5,"button",3),c.Tc(6),c.nc(7,"translate"),c.Zb(),c.ac(8,"button",4),c.Tc(9),c.nc(10,"translate"),c.Zb(),c.Zb(),c.Zb()),2&t){var n=c.mc();c.Hb(2),c.Uc(n.data.title),c.Hb(1),c.uc("innerHTML",n.data.content,c.Kc),c.Hb(2),c.uc("mat-dialog-close",!0),c.Hb(1),c.Uc(c.oc(7,6,"Yes")),c.Hb(2),c.uc("mat-dialog-close",!1),c.Hb(1),c.Uc(c.oc(10,8,"Cancel"))}}var s=function(){var t=function t(e,n){_classCallCheck(this,t),this.dialogRef=e,this.data=n};return t.\u0275fac=function(e){return new(e||t)(c.Ub(a.h),c.Ub(a.a))},t.\u0275cmp=c.Ob({type:t,selectors:[["os-prompt-dialog"]],decls:1,vars:1,consts:[[4,"ngIf"],["mat-dialog-title",""],[3,"innerHTML"],["mat-button","","color","warn",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,e){1&t&&c.Rc(0,l,11,10,"div",0),2&t&&c.uc("ngIf",e.data)},directives:[o.t,a.i,a.f,a.c,i.b,a.d],pipes:[r.j],encapsulation:2}),t}()},moyA:function(t,e,n){"use strict";n.r(e),n.d(e,"MotionWorkflowModule",(function(){return Ut}));var a=n("ofXK"),c=n("PCNd"),o=n("tyNb"),i=n("+0xr"),r=n("lJxs"),l=n("ZvXm"),s=n("s3dr"),u=n("F48D"),f=n("gtli"),m=n("Izkr"),b=n("mV3u"),d=n("fXoL"),p=n("jhN1"),g=n("sYmb"),h=n("dNgK"),v=n("0IaG"),w=n("mksl"),_=n("bTqV"),k=n("NFeN"),y=n("STbY"),C=n("bSwM"),M=n("A5z7"),O=n("kmnG"),R=n("qFsG"),Z=n("3Pt+"),P=n("IZUe"),T=["workflowDialog"];function H(t,e){if(1&t&&(d.ac(0,"h2"),d.Tc(1),d.nc(2,"translate"),d.Zb()),2&t){var n=d.mc();d.Hb(1),d.Vc(" ",d.oc(2,1,n.workflow.name)," ")}}function S(t,e){1&t&&(d.ac(0,"th",20),d.Tc(1),d.nc(2,"translate"),d.Zb()),2&t&&(d.Hb(1),d.Uc(d.oc(2,1,"Permissions")))}function D(t,e){if(1&t&&(d.ac(0,"td",21),d.ac(1,"div",22),d.Tc(2),d.nc(3,"translate"),d.Zb(),d.Zb()),2&t){var n=e.$implicit;d.Hb(2),d.Vc(" ",d.oc(3,1,n.name)," ")}}function I(t,e){if(1&t){var n=d.bc();d.ac(0,"th",25),d.ic("click",(function(){d.Jc(n);var t=d.mc().$implicit;return d.mc(2).onClickStateName(t)})),d.ac(1,"div",26),d.ac(2,"div",27),d.Tc(3),d.nc(4,"translate"),d.Zb(),d.Zb(),d.Zb()}if(2&t){var a=d.mc().$implicit;d.Hb(3),d.Vc(" ",d.oc(4,1,a.name)," ")}}function x(t,e){if(1&t){var n=d.bc();d.ac(0,"div",27),d.ac(1,"mat-checkbox",29),d.ic("change",(function(t){d.Jc(n);var e=d.mc().$implicit,a=d.mc().$implicit;return d.mc(2).onToggleStatePerm(a,e.selector,t)})),d.Zb(),d.Zb()}if(2&t){var a=d.mc().$implicit,c=d.mc().$implicit;d.Hb(1),d.uc("checked",c[a.selector])}}function U(t,e){if(1&t){var n=d.bc();d.ac(0,"div"),d.ac(1,"div",27),d.Tc(2),d.nc(3,"translate"),d.Zb(),d.ac(4,"div",30),d.ic("click",(function(){d.Jc(n);var t=d.mc().$implicit,e=d.mc().$implicit;return d.mc(2).onClickInputPerm(t,e)})),d.Zb(),d.Zb()}if(2&t){var a=d.mc().$implicit,c=d.mc().$implicit;d.Hb(2),d.Vc(" ",d.oc(3,1,c[a.selector])||"\u2013"," ")}}var A=function(t){return{state:t}};function E(t,e){if(1&t&&(d.ac(0,"div",27),d.ac(1,"mat-basic-chip",31),d.Tc(2),d.nc(3,"translate"),d.Zb(),d.Zb()),2&t){var n=d.mc().$implicit,a=d.mc().$implicit;d.mc(2);var c=d.Fc(11);d.Hb(1),d.uc("matMenuTriggerFor",c)("matMenuTriggerData",d.Ac(7,A,a))("disableRipple",!0)("ngClass",a[n.selector]),d.Hb(1),d.Vc(" ",d.oc(3,5,a[n.selector])," ")}}function F(t,e){1&t&&(d.ac(0,"div"),d.Tc(1," - "),d.Zb())}function $(t,e){1&t&&(d.ac(0,"span"),d.Tc(1,",\xa0"),d.Zb())}function j(t,e){if(1&t&&(d.ac(0,"div"),d.Tc(1),d.nc(2,"translate"),d.Rc(3,$,2,0,"span",2),d.Zb()),2&t){var n=e.$implicit,a=e.last;d.Hb(1),d.Vc(" ",d.oc(2,2,n.name),""),d.Hb(2),d.uc("ngIf",!a)}}function N(t,e){if(1&t&&(d.ac(0,"div"),d.Rc(1,j,4,4,"div",33),d.Zb()),2&t){var n=d.mc(3).$implicit;d.Hb(1),d.uc("ngForOf",n.next_states)}}function L(t,e){if(1&t&&(d.ac(0,"div"),d.ac(1,"div",27),d.Rc(2,F,2,0,"div",2),d.Rc(3,N,2,1,"div",2),d.Zb(),d.Vb(4,"div",32),d.Zb()),2&t){var n=d.mc(2).$implicit;d.mc(2);var a=d.Fc(14);d.Hb(2),d.uc("ngIf",!n.next_states.length),d.Hb(1),d.uc("ngIf",n.next_states.length),d.Hb(1),d.uc("matMenuTriggerFor",a)("matMenuTriggerData",d.Ac(4,A,n))}}function B(t,e){if(1&t&&(d.ac(0,"div"),d.ac(1,"div",27),d.Tc(2),d.nc(3,"translate"),d.Zb(),d.Vb(4,"div",32),d.Zb()),2&t){var n=d.mc(2).$implicit,a=d.mc(2),c=d.Fc(20);d.Hb(2),d.Vc(" ",d.oc(3,3,a.getMergeAmendmentLabel(n.merge_amendment_into_final))," "),d.Hb(2),d.uc("matMenuTriggerFor",c)("matMenuTriggerData",d.Ac(5,A,n))}}function V(t,e){1&t&&(d.ac(0,"div"),d.Tc(1," - "),d.Zb())}function W(t,e){1&t&&(d.ac(0,"span"),d.Tc(1,",\xa0"),d.Zb())}function J(t,e){if(1&t&&(d.ac(0,"div"),d.Tc(1),d.nc(2,"translate"),d.Rc(3,W,2,0,"span",2),d.Zb()),2&t){var n=e.$implicit,a=e.last,c=d.mc(6);d.Hb(1),d.Vc(" ",d.oc(2,2,c.getRestrictionLabel(n))," "),d.Hb(2),d.uc("ngIf",!a)}}function z(t,e){if(1&t&&(d.ac(0,"div"),d.Rc(1,J,4,4,"div",33),d.Zb()),2&t){var n=d.mc(3).$implicit;d.Hb(1),d.uc("ngForOf",n.restriction)}}function X(t,e){if(1&t&&(d.ac(0,"div"),d.ac(1,"div",27),d.Rc(2,V,2,0,"div",2),d.Rc(3,z,2,1,"div",2),d.Zb(),d.Vb(4,"div",32),d.Zb()),2&t){var n=d.mc(2).$implicit;d.mc(2);var a=d.Fc(17);d.Hb(2),d.uc("ngIf",!n.restriction.length),d.Hb(1),d.uc("ngIf",n.restriction.length),d.Hb(1),d.uc("matMenuTriggerFor",a)("matMenuTriggerData",d.Ac(4,A,n))}}function Y(t,e){if(1&t&&(d.ac(0,"td",21),d.Rc(1,x,2,1,"div",28),d.Rc(2,U,5,3,"div",2),d.Rc(3,E,4,9,"div",28),d.Rc(4,L,5,6,"div",2),d.Rc(5,B,5,7,"div",2),d.Rc(6,X,5,6,"div",2),d.Zb()),2&t){var n=e.$implicit;d.Hb(1),d.uc("ngIf","check"===n.type),d.Hb(1),d.uc("ngIf","input"===n.type),d.Hb(1),d.uc("ngIf","color"===n.type),d.Hb(1),d.uc("ngIf","state"===n.type),d.Hb(1),d.uc("ngIf","amendment"===n.type),d.Hb(1),d.uc("ngIf","restriction"===n.type)}}function G(t,e){if(1&t&&(d.Yb(0,23),d.Rc(1,I,5,3,"th",24),d.Rc(2,Y,7,6,"td",16),d.Xb()),2&t){var n=e.$implicit,a=d.mc(2);d.uc("matColumnDef",a.getColumnDef(n))}}function q(t,e){1&t&&d.Vb(0,"tr",34)}function K(t,e){1&t&&d.Vb(0,"tr",35)}function Q(t,e){if(1&t&&(d.ac(0,"div"),d.ac(1,"div",11),d.ac(2,"strong"),d.ac(3,"span"),d.Tc(4),d.nc(5,"translate"),d.Zb(),d.Tc(6,": "),d.ac(7,"span"),d.Tc(8),d.nc(9,"translate"),d.Zb(),d.Zb(),d.Zb(),d.ac(10,"div",12),d.ac(11,"table",13),d.Yb(12,14),d.Rc(13,S,3,3,"th",15),d.Rc(14,D,4,3,"td",16),d.Xb(),d.Rc(15,G,3,1,"ng-container",17),d.Rc(16,q,1,0,"tr",18),d.Rc(17,K,1,0,"tr",19),d.Zb(),d.Zb(),d.Zb()),2&t){var n=d.mc();d.Hb(4),d.Uc(d.oc(5,7,"First state")),d.Hb(4),d.Uc(d.oc(9,9,n.workflow.first_state.name)),d.Hb(3),d.uc("dataSource",n.getTableDataSource()),d.Hb(4),d.uc("ngForOf",n.workflow.states)("ngForTrackBy",n.trackByIndex),d.Hb(1),d.uc("matHeaderRowDef",n.headerRowDef),d.Hb(1),d.uc("matRowDefColumns",n.headerRowDef)}}var tt=function(){return{action:"delete"}};function et(t,e){1&t&&(d.ac(0,"button",43),d.ac(1,"span"),d.Tc(2),d.nc(3,"translate"),d.Zb(),d.Zb()),2&t&&(d.uc("mat-dialog-close",d.zc(4,tt)),d.Hb(2),d.Uc(d.oc(3,2,"Delete")))}var nt=function(t){return{action:"update",value:t}};function at(t,e){if(1&t){var n=d.bc();d.ac(0,"h1",36),d.ac(1,"span"),d.Tc(2),d.nc(3,"translate"),d.Zb(),d.Zb(),d.ac(4,"div",37),d.ac(5,"p"),d.Tc(6),d.nc(7,"translate"),d.Zb(),d.ac(8,"mat-form-field"),d.ac(9,"input",38),d.ic("ngModelChange",(function(t){return d.Jc(n),d.mc().dialogData.value=t})),d.Zb(),d.Zb(),d.Zb(),d.ac(10,"div",39),d.ac(11,"button",40),d.ac(12,"span"),d.Tc(13),d.nc(14,"translate"),d.Zb(),d.Zb(),d.ac(15,"button",41),d.ac(16,"span"),d.Tc(17),d.nc(18,"translate"),d.Zb(),d.Zb(),d.Rc(19,et,4,5,"button",42),d.Zb()}if(2&t){var a=d.mc();d.Hb(2),d.Uc(d.oc(3,9,a.dialogData.title)),d.Hb(4),d.Uc(d.oc(7,11,a.dialogData.description)),d.Hb(3),d.uc("ngModel",a.dialogData.value),d.Hb(2),d.uc("disabled",""===a.dialogData.value&&!a.dialogData.allowEmpty)("mat-dialog-close",d.Ac(17,nt,a.dialogData.value)),d.Hb(2),d.Uc(d.oc(14,13,"Save")),d.Hb(2),d.uc("mat-dialog-close",null),d.Hb(2),d.Uc(d.oc(18,15,"Cancel")),d.Hb(2),d.uc("ngIf",a.dialogData.deletable)}}function ct(t,e){1&t&&(d.ac(0,"mat-icon"),d.Tc(1,"check"),d.Zb())}function ot(t,e){if(1&t){var n=d.bc();d.ac(0,"button",45),d.ic("click",(function(){d.Jc(n);var t=e.$implicit,a=d.mc().state;return d.mc().onSelectColor(a,t)})),d.Rc(1,ct,2,0,"mat-icon",2),d.ac(2,"span"),d.Tc(3),d.nc(4,"translate"),d.Zb(),d.Zb()}if(2&t){var a=e.$implicit,c=d.mc().state;d.Hb(1),d.uc("ngIf",a===c.css_class),d.Hb(2),d.Uc(d.oc(4,2,a))}}function it(t,e){if(1&t&&d.Rc(0,ot,5,4,"button",44),2&t){var n=d.mc();d.uc("ngForOf",n.labelColors)}}function rt(t,e){1&t&&(d.ac(0,"mat-icon"),d.Tc(1,"check"),d.Zb())}function lt(t,e){if(1&t){var n=d.bc();d.ac(0,"button",45),d.ic("click",(function(){d.Jc(n);var t=d.mc().$implicit,e=d.mc().state;return d.mc().onSetNextState(t,e)})),d.Rc(1,rt,2,0,"mat-icon",2),d.ac(2,"span"),d.Tc(3),d.nc(4,"translate"),d.Zb(),d.Zb()}if(2&t){var a=d.mc().$implicit,c=d.mc().state;d.Hb(1),d.uc("ngIf",c.next_states_id.includes(a.id)),d.Hb(2),d.Uc(d.oc(4,2,a.name))}}function st(t,e){if(1&t&&(d.ac(0,"div"),d.Rc(1,lt,5,4,"button",46),d.Zb()),2&t){var n=e.$implicit,a=d.mc().state;d.Hb(1),d.uc("ngIf",n.name!==a.name)}}function ut(t,e){if(1&t&&d.Rc(0,st,2,1,"div",33),2&t){var n=d.mc();d.uc("ngForOf",n.workflow.states)}}function ft(t,e){1&t&&(d.ac(0,"mat-icon"),d.Tc(1,"check"),d.Zb())}function mt(t,e){if(1&t){var n=d.bc();d.ac(0,"button",45),d.ic("click",(function(){d.Jc(n);var t=e.$implicit,a=d.mc().state;return d.mc().onSetRestriction(t.key,a)})),d.Rc(1,ft,2,0,"mat-icon",2),d.ac(2,"span"),d.Tc(3),d.nc(4,"translate"),d.Zb(),d.Zb()}if(2&t){var a=e.$implicit,c=d.mc().state;d.Hb(1),d.uc("ngIf",c.restriction.includes(a.key)),d.Hb(2),d.Uc(d.oc(4,2,a.label))}}function bt(t,e){if(1&t&&d.Rc(0,mt,5,4,"button",44),2&t){var n=d.mc();d.uc("ngForOf",n.restrictions)}}function dt(t,e){1&t&&(d.ac(0,"mat-icon"),d.Tc(1,"check"),d.Zb())}function pt(t,e){if(1&t){var n=d.bc();d.ac(0,"div"),d.ac(1,"button",45),d.ic("click",(function(){d.Jc(n);var t=e.$implicit,a=d.mc().state;return d.mc().setMergeAmendment(t.merge,a)})),d.Rc(2,dt,2,0,"mat-icon",2),d.ac(3,"span"),d.Tc(4),d.nc(5,"translate"),d.Zb(),d.Zb(),d.Zb()}if(2&t){var a=e.$implicit,c=d.mc().state;d.Hb(2),d.uc("ngIf",a.merge===c.merge_amendment_into_final),d.Hb(2),d.Uc(d.oc(5,2,a.label))}}function gt(t,e){if(1&t&&d.Rc(0,pt,6,4,"div",33),2&t){var n=d.mc();d.uc("ngForOf",n.amendmentIntoFinal)}}var ht,vt=((ht=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,c,o,i,r,l,s,u){var m;return _classCallCheck(this,n),(m=e.call(this,t,a,c)).translate=a,m.promptService=o,m.dialog=i,m.workflowRepo=r,m.stateRepo=l,m.route=s,m.cd=u,m.headerRowDef=[],m.labelColors=["grey","red","green","lightblue","yellow"],m.statePermissionsList=[{name:"Recommendation label",selector:"recommendation_label",type:"input"},{name:"Allow support",selector:"allow_support",type:"check"},{name:"Allow create poll",selector:"allow_create_poll",type:"check"},{name:"Allow submitter edit",selector:"allow_submitter_edit",type:"check"},{name:"Do not set identifier",selector:"dont_set_identifier",type:"check"},{name:"Show state extension field",selector:"show_state_extension_field",type:"check"},{name:"Show recommendation extension field",selector:"show_recommendation_extension_field",type:"check"},{name:"Show amendment in parent motion",selector:"merge_amendment_into_final",type:"amendment"},{name:"Restrictions",selector:"restriction",type:"restriction"},{name:"Label color",selector:"css_class",type:"color"},{name:"Next states",selector:"next_states_id",type:"state"}],m.restrictions=[{key:f.b.motionsCanManage,label:"Can manage motions"},{key:f.b.motionsCanSeeInternal,label:"Can see motions in internal state"},{key:f.b.motionsCanManageMetadata,label:"Can manage motion metadata"},{key:f.b.motionsIsSubmitter,label:"Submitters"}],m.amendmentIntoFinal=[{merge:f.a.NO,label:"No"},{merge:f.a.UNDEFINED,label:"-"},{merge:f.a.YES,label:"Yes"}],m}return _createClass(n,[{key:"ngOnInit",value:function(){var t=this,e=parseInt(this.route.snapshot.paramMap.get("id"),10);this.subscriptions.push(this.workflowRepo.getViewModelObservable(e).subscribe((function(e){e&&(t.workflow=e,t.updateRowDef(),t.cd.markForCheck())})),this.stateRepo.getViewModelListObservable().pipe(Object(r.a)((function(e){return e.filter((function(e){return t.workflow.states_id.includes(e.id)}))}))).subscribe((function(e){e&&t.cd.markForCheck()})))}},{key:"onClickStateName",value:function(t){var e=this;this.openEditDialog(t.name,"Rename state","",!0).subscribe((function(n){if(n)if(e.cd.detectChanges(),"update"===n.action)e.stateRepo.update({name:n.value},t).then((function(){}),e.raiseError);else if("delete"===n.action){var a=e.translate.instant("Delete")+" ".concat(t.name,"?");e.promptService.open("Are you sure",a).then((function(n){n&&e.stateRepo.delete(t).then((function(){}),e.raiseError)}))}}))}},{key:"onNewStateButton",value:function(){var t=this;this.openEditDialog("",this.translate.instant("New state"),this.translate.instant("Name")).subscribe((function(e){if(e&&"update"===e.action){var n=new f.c({name:e.value,workflow_id:t.workflow.id});t.stateRepo.create(n).then((function(){}),t.raiseError)}}))}},{key:"onEditWorkflowButton",value:function(){var t=this;this.openEditDialog(this.workflow.name,"Edit name","Please enter a new workflow name:").subscribe((function(e){e&&"update"===e.action&&t.workflowRepo.update({name:e.value},t.workflow).then((function(){}),t.raiseError)}))}},{key:"onClickInputPerm",value:function(t,e){var n=this;this.openEditDialog(e[t.selector],"Edit",t.name,!1,!0).subscribe((function(a){""===a.value&&(a.value=null),a&&"update"===a.action&&n.stateRepo.update(_defineProperty({},t.selector,a.value),e).then((function(){}),n.raiseError)}))}},{key:"onToggleStatePerm",value:function(t,e,n){this.stateRepo.update(_defineProperty({},e,n.checked),t).then((function(){}),this.raiseError)}},{key:"onSelectColor",value:function(t,e){this.stateRepo.update({css_class:e},t).then((function(){}),this.raiseError)}},{key:"onSetNextState",value:function(t,e){var n=e.next_states_id.map((function(t){return t})),a=n.findIndex((function(e){return e===t.id}));a<0?n.push(t.id):n.splice(a,1),this.stateRepo.update({next_states_id:n},e).then((function(){}),this.raiseError)}},{key:"onSetRestriction",value:function(t,e){var n=e.restriction.map((function(t){return t})),a=n.findIndex((function(e){return e===t}));a<0?n.push(t):n.splice(a,1),this.stateRepo.update({restriction:n},e).then((function(){}),this.raiseError)}},{key:"getRestrictionLabel",value:function(t){var e=this.restrictions.find((function(e){return e.key===t}));return e?e.label:""}},{key:"setMergeAmendment",value:function(t,e){this.stateRepo.update({merge_amendment_into_final:t},e).then((function(){}),this.raiseError)}},{key:"openEditDialog",value:function(t,e,n,a,c){return this.dialogData={title:e||"",description:n||"",value:t,deletable:a,allowEmpty:c},this.dialog.open(this.workflowDialog,m.a).afterClosed()}},{key:"getMergeAmendmentLabel",value:function(t){return this.amendmentIntoFinal.find((function(e){return e.merge===t})).label}},{key:"getTableDataSource",value:function(){var t=new i.o;return t.data=this.statePermissionsList,t}},{key:"updateRowDef",value:function(){var t=this;this.headerRowDef=["perm"],this.workflow&&this.workflow.states.forEach((function(e){t.headerRowDef.push(t.getColumnDef(e))}))}},{key:"getColumnDef",value:function(t){return"".concat(t.name).concat(t.id)}},{key:"trackElement",value:function(t){return t}}]),n}(b.a)).\u0275fac=function(t){return new(t||ht)(d.Ub(p.d),d.Ub(g.k),d.Ub(h.a),d.Ub(u.a),d.Ub(v.b),d.Ub(s.a),d.Ub(l.a),d.Ub(o.a),d.Ub(d.h))},ht.\u0275cmp=d.Ob({type:ht,selectors:[["os-workflow-detail"]],viewQuery:function(t,e){var n;1&t&&d.Pc(T,!0),2&t&&d.Ec(n=d.jc())&&(e.workflowDialog=n.first)},features:[d.Eb],decls:22,vars:4,consts:[[3,"nav","hasMainButton","mainEvent"],[1,"title-slot"],[4,"ngIf"],[1,"extra-controls-slot"],["mat-icon-button","",3,"click"],["workflowDialog",""],["matMenuContent",""],["colorMenu","matMenu"],["nextStatesMenu","matMenu"],["restrictionMenu","matMenu"],["mergeAmendmentMenu","matMenu"],[1,"title-line"],[1,"scrollable-matrix"],["mat-table","",3,"dataSource"],["matColumnDef","perm","sticky",""],["mat-header-cell","","class","group-head-table-cell",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf","ngForTrackBy"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"group-head-table-cell"],["mat-cell",""],[1,"permission-name"],[3,"matColumnDef"],["mat-header-cell","",3,"click",4,"matHeaderCellDef"],["mat-header-cell","",3,"click"],[1,"clickable-cell","stretch-to-fill-parent"],[1,"inner-table"],["class","inner-table",4,"ngIf"],[3,"checked","change"],[1,"clickable-cell","stretch-to-fill-parent",3,"click"],[3,"matMenuTriggerFor","matMenuTriggerData","disableRipple","ngClass"],[1,"clickable-cell","stretch-to-fill-parent",3,"matMenuTriggerFor","matMenuTriggerData"],[4,"ngFor","ngForOf"],["mat-header-row",""],["mat-row",""],["mat-dialog-title",""],["mat-dialog-content","",1,"os-form-card-mobile"],["matInput","","osAutofocus","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["type","submit","mat-button","","color","accent",3,"disabled","mat-dialog-close"],["type","button","mat-button","",3,"mat-dialog-close"],["type","button","mat-button","","color","warn",3,"mat-dialog-close",4,"ngIf"],["type","button","mat-button","","color","warn",3,"mat-dialog-close"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"]],template:function(t,e){1&t&&(d.ac(0,"os-head-bar",0),d.ic("mainEvent",(function(){return e.onNewStateButton()})),d.ac(1,"div",1),d.Rc(2,H,3,3,"h2",2),d.Zb(),d.ac(3,"div",3),d.ac(4,"button",4),d.ic("click",(function(){return e.onEditWorkflowButton()})),d.ac(5,"mat-icon"),d.Tc(6,"edit"),d.Zb(),d.Zb(),d.Zb(),d.Zb(),d.Rc(7,Q,18,11,"div",2),d.Rc(8,at,20,19,"ng-template",null,5,d.Sc),d.ac(10,"mat-menu",6,7),d.Rc(12,it,1,1,"ng-template",6),d.Zb(),d.ac(13,"mat-menu",6,8),d.Rc(15,ut,1,1,"ng-template",6),d.Zb(),d.ac(16,"mat-menu",6,9),d.Rc(18,bt,1,1,"ng-template",6),d.Zb(),d.ac(19,"mat-menu",6,10),d.Rc(21,gt,1,1,"ng-template",6),d.Zb()),2&t&&(d.uc("nav",!1)("hasMainButton",!0),d.Hb(2),d.uc("ngIf",e.workflow),d.Hb(5),d.uc("ngIf",e.workflow))},directives:[w.a,a.t,_.b,k.a,y.f,y.b,i.n,i.c,i.i,i.b,a.s,i.k,i.m,i.h,i.a,C.a,M.a,y.e,a.q,i.j,i.l,v.i,v.f,O.c,R.b,Z.c,P.a,Z.s,Z.v,v.c,v.d,y.c],pipes:[g.j],styles:[".title-line[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.title-line[_ngcontent-%COMP%]   .icon-prefix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;font-size:16px;height:16px;width:16px}.title-line[_ngcontent-%COMP%]   .favorite-star[_ngcontent-%COMP%]{padding-right:3px}.mat-table[_ngcontent-%COMP%]{width:100%}.mat-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{display:none}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]{position:absolute!important;top:0;right:0;bottom:0;left:0;opacity:.1;z-index:1}.mat-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]   .mat-column-anchor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;height:100%;width:100%}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{position:relative}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]{position:absolute;display:inherit;height:100%;width:100%;line-height:0}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]   .fill[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:auto}.mat-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{z-index:2}.mat-table[_ngcontent-%COMP%]   .mat-table-sticky[_ngcontent-%COMP%]{z-index:3!important}.title-line[_ngcontent-%COMP%]{margin:20px 25px}table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   .mat-header-cell[_ngcontent-%COMP%]{min-width:200px;position:relative}table[_ngcontent-%COMP%]   .clickable-cell[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;cursor:pointer}table[_ngcontent-%COMP%]   .clickable-cell[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.025)}table[_ngcontent-%COMP%]   .inner-table[_ngcontent-%COMP%]{text-align:center;-ms-flex-align:center;align-items:center;margin:auto;overflow:hidden;padding:0 10px}table[_ngcontent-%COMP%]   .mat-column-perm[_ngcontent-%COMP%]{min-width:150px}table[_ngcontent-%COMP%]   .mat-column-perm[_ngcontent-%COMP%]   .permission-name[_ngcontent-%COMP%]{margin-right:10px}.mat-chip[_ngcontent-%COMP%]:hover{cursor:pointer}.scrollable-matrix[_ngcontent-%COMP%]{overflow-y:scroll;overflow-x:auto;height:calc(100vh - 128px)}"],changeDetection:0}),ht),wt=n("mrSG"),_t=n("AqIO"),kt=n("hsNs"),yt=n("wL0i"),Ct=n("0Obk"),Mt=n("dRZP");function Ot(t,e){if(1&t&&d.Vb(0,"a",7),2&t){var n=d.mc().row;d.uc("routerLink",n.id)}}function Rt(t,e){if(1&t&&(d.ac(0,"div",5),d.Rc(1,Ot,1,1,"a",6),d.ac(2,"div"),d.Tc(3),d.nc(4,"translate"),d.Zb(),d.Zb()),2&t){var n=e.value,a=d.mc();d.Hb(1),d.uc("ngIf",!a.isMultiSelect),d.Hb(2),d.Uc(d.oc(4,2,n))}}function Zt(t,e){if(1&t){var n=d.bc();d.ac(0,"div",5),d.ac(1,"button",8),d.ic("click",(function(){d.Jc(n);var t=e.row;return d.mc().onDeleteWorkflow(t)})),d.ac(2,"mat-icon",9),d.Tc(3,"delete"),d.Zb(),d.Zb(),d.Zb()}}function Pt(t,e){if(1&t){var n=d.bc();d.ac(0,"h1",10),d.ac(1,"span"),d.Tc(2),d.nc(3,"translate"),d.Zb(),d.Zb(),d.ac(4,"div",11),d.ac(5,"p"),d.Tc(6),d.nc(7,"translate"),d.Zb(),d.ac(8,"mat-form-field"),d.ac(9,"input",12),d.ic("ngModelChange",(function(t){return d.Jc(n),d.mc().newWorkflowTitle=t})),d.Zb(),d.Zb(),d.Zb(),d.ac(10,"div",13),d.ac(11,"button",14),d.ac(12,"span"),d.Tc(13),d.nc(14,"translate"),d.Zb(),d.Zb(),d.ac(15,"button",15),d.ac(16,"span"),d.Tc(17),d.nc(18,"translate"),d.Zb(),d.Zb(),d.Zb()}if(2&t){var a=d.mc();d.Hb(2),d.Uc(d.oc(3,8,"New workflow")),d.Hb(4),d.Uc(d.oc(7,10,"Please enter a name for the new workflow:")),d.Hb(3),d.uc("ngModel",a.newWorkflowTitle),d.Hb(2),d.uc("disabled",""===a.newWorkflowTitle)("mat-dialog-close",a.newWorkflowTitle),d.Hb(2),d.Uc(d.oc(14,12,"Save")),d.Hb(2),d.uc("mat-dialog-close",null),d.Hb(2),d.Uc(d.oc(18,14,"Cancel"))}}var Tt,Ht,St,Dt=function(){return["menu"]},It=[{path:"",component:(Tt=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,c,o,i,r,l){var s;return _classCallCheck(this,n),(s=e.call(this,t,a,c,o)).translate=a,s.dialog=i,s.workflowRepo=r,s.promptService=l,s.tableColumnDefinition=[{prop:"name",width:"auto"},{prop:"delete"}],s.filterProps=["name","states"],s}return _createClass(n,[{key:"ngOnInit",value:function(){_get(_getPrototypeOf(n.prototype),"setTitle",this).call(this,"Workflows")}},{key:"onNewButton",value:function(t){var e=this;this.newWorkflowTitle="",this.dialog.open(t,m.a).afterClosed().subscribe((function(t){t&&e.workflowRepo.create(new kt.a({name:t})).then((function(){}),e.raiseError)}))}},{key:"onDeleteWorkflow",value:function(t){return Object(wt.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.translate.instant("Are you sure you want to delete this workflow?"),a=t.getTitle(),e.next=3,this.promptService.open(n,a);case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.workflowRepo.delete(t).then((function(){}),this.raiseError);case 6:case"end":return e.stop()}}),e,this)})))}}]),n}(yt.a),Tt.\u0275fac=function(t){return new(t||Tt)(d.Ub(p.d),d.Ub(g.k),d.Ub(h.a),d.Ub(_t.a),d.Ub(v.b),d.Ub(s.a),d.Ub(u.a))},Tt.\u0275cmp=d.Ob({type:Tt,selectors:[["os-workflow-list"]],features:[d.Eb],decls:10,vars:14,consts:[["prevUrl","../..",3,"nav","hasMainButton","mainEvent"],[1,"title-slot"],["listStorageKey","workflow",3,"listObservableProvider","columns","allowProjector","hiddenInMobile","showListOfSpeakers","filterProps","dataSourceChange"],["class","cell-slot fill",4,"pblNgridCellDef"],["newWorkflowDialog",""],[1,"cell-slot","fill"],["class","detail-link",3,"routerLink",4,"ngIf"],[1,"detail-link",3,"routerLink"],["type","button","mat-icon-button","",3,"click"],["color","warn"],["mat-dialog-title",""],["mat-dialog-content",""],["matInput","","osAutofocus","","required","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["type","submit","mat-button","","color","accent",3,"disabled","mat-dialog-close"],["type","button","mat-button","",3,"mat-dialog-close"]],template:function(t,e){if(1&t){var n=d.bc();d.ac(0,"os-head-bar",0),d.ic("mainEvent",(function(){d.Jc(n);var t=d.Fc(9);return e.onNewButton(t)})),d.ac(1,"div",1),d.ac(2,"h2"),d.Tc(3),d.nc(4,"translate"),d.Zb(),d.Zb(),d.Zb(),d.ac(5,"os-list-view-table",2),d.ic("dataSourceChange",(function(t){return e.onDataSourceChange(t)})),d.Rc(6,Rt,5,4,"div",3),d.Rc(7,Zt,4,0,"div",3),d.Zb(),d.Rc(8,Pt,19,16,"ng-template",null,4,d.Sc)}2&t&&(d.uc("nav",!1)("hasMainButton",!0),d.Hb(3),d.Uc(d.oc(4,11,"Workflows")),d.Hb(2),d.uc("listObservableProvider",e.workflowRepo)("columns",e.tableColumnDefinition)("allowProjector",!1)("hiddenInMobile",d.zc(13,Dt))("showListOfSpeakers",!1)("filterProps",e.filterProps),d.Hb(1),d.uc("pblNgridCellDef","name"),d.Hb(1),d.uc("pblNgridCellDef","delete"))},directives:[w.a,Ct.a,Mt.c,a.t,o.i,_.b,k.a,v.i,v.f,O.c,R.b,Z.c,P.a,Z.D,Z.s,Z.v,v.c,v.d],pipes:[g.j],styles:[""]}),Tt),pathMatch:"full"},{path:":id",component:vt}],xt=((St=function t(){_classCallCheck(this,t)}).\u0275mod=d.Sb({type:St}),St.\u0275inj=d.Rb({factory:function(t){return new(t||St)},imports:[[o.j.forChild(It)],o.j]}),St),Ut=((Ht=function t(){_classCallCheck(this,t)}).\u0275mod=d.Sb({type:Ht}),Ht.\u0275inj=d.Rb({factory:function(t){return new(t||Ht)},imports:[[a.c,xt,c.a]]}),Ht)},wL0i:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var a=function(t){_inherits(n,t);var e=_createSuper(n);function n(t,a,c,o){var i;return _classCallCheck(this,n),(i=e.call(this,t,a,c)).storage=o,i.canMultiSelect=!1,i._multiSelectMode=!1,i.singleButtonWidth="40px",i.badgeButtonWidth="45px",i.selectedRows=[],i}return _createClass(n,[{key:"onDataSourceChange",value:function(t){this.dataSource=t}},{key:"toggleMultiSelect",value:function(){!this.canMultiSelect||this.isMultiSelect?(this._multiSelectMode=!1,this.deselectAll()):this._multiSelectMode=!0}},{key:"selectAll",value:function(){var t;(t=this.dataSource.selection).select.apply(t,_toConsumableArray(this.dataSource.filteredData))}},{key:"deselectAll",value:function(){this.dataSource&&this.dataSource.selection.clear()}},{key:"isMultiSelect",get:function(){return this._multiSelectMode}}]),n}(n("mV3u").a)}}]);