!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):"object"==typeof exports?exports.dazzler_renderer=t(require("react"),require("react-dom")):e.dazzler_renderer=t(e.React,e.ReactDOM)}(window,(function(e,t){return function(e){function t(t){for(var r,i,c=t[0],s=t[1],u=t[2],f=0,l=[];f<c.length;f++)i=c[f],o[i]&&l.push(o[i][0]),o[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(p&&p(t);l.length;)l.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==o[s]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={6:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.webpackJsonpdazzler_name_=window.webpackJsonpdazzler_name_||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var p=s;return a.push([419,0]),n()}({1:function(t,n){t.exports=e},225:function(e,n){e.exports=t},419:function(e,t,n){e.exports=n(618)},618:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),a=n(225),i=n.n(a),c=n(0),s=n.n(c);function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=/json/i,l={method:"GET",headers:{},payload:"",json:!0},d={"Content-Type":"application/json"};function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;return new Promise((function(n,r){var o=u({},l,t),a=o.method,i=o.headers,c=o.payload,s=o.json,p=new XMLHttpRequest;p.open(a,e);var y=s?u({},d,i):i;Object.keys(y).forEach((function(e){return p.setRequestHeader(e,y[e])})),p.onreadystatechange=function(){if(p.readyState===XMLHttpRequest.DONE)if(200===p.status){var t=p.response;f.test(p.getResponseHeader("Content-Type"))&&(t=JSON.parse(p.responseText)),n(t)}else r({error:"RequestError",message:"XHR ".concat(e," FAILED - STATUS: ").concat(p.status," MESSAGE: ").concat(p.statusText),status:p.status,xhr:p})},p.onerror=function(e){return r(e)},p.send(s?JSON.stringify(c):c)}))}var b=n(148),h=n(229),g=n(629),m=n(26),v=n(627),O=n(628),w=n(7);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){S(e,t,n[t])}))}return e}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var R=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(o=A(t).call(this,e))||"object"!==j(o)&&"function"!=typeof o?E(r):o).state={aspects:e.aspects||{},ready:!1,initial:!1},n.setAspects=n.setAspects.bind(E(n)),n.getAspect=n.getAspect.bind(E(n)),n.updateAspects=n.updateAspects.bind(E(n)),n.matchAspects=n.matchAspects.bind(E(n)),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,e),n=t,(r=[{key:"updateAspects",value:function(e){var t=this;return this.setAspects(e).then((function(){return t.props.updateAspects(t.props.identity,e)}))}},{key:"setAspects",value:function(e){var t=this;return new Promise((function(n){t.setState({aspects:k({},t.state.aspects,e)},n)}))}},{key:"getAspect",value:function(e){return this.state.aspects[e]}},{key:"matchAspects",value:function(e){var t=this;return Object(m.a)(this.state.aspects).filter((function(t){return e.test(t)})).map((function(e){return[e,t.state.aspects[e]]}))}},{key:"componentDidMount",value:function(){var e=this;this.props.connect(this.props.identity,this.setAspects,this.getAspect,this.matchAspects),this.state.initial||this.updateAspects(this.state.aspects).then((function(){return e.setState({ready:!0,initial:!0})}))}},{key:"componentWillUnmount",value:function(){this.props.disconnect(this.props.identity)}},{key:"render",value:function(){var e=this.props,t=e.component,n=e.component_name,r=e.package_name,a=this.state,i=a.aspects;return a.ready?o.a.cloneElement(t,k({},i,{updateAspects:this.updateAspects,identity:this.props.identity,class_name:Object(v.a)(" ",Object(O.a)(["".concat(r.replace("_","-").toLowerCase(),"-").concat(Object(w.camelToSpinal)(n))],i.class_name?i.class_name.split(" "):[]))})):null}}])&&_(n.prototype,r),a&&_(n,a),t}(o.a.Component);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function z(e){return"Object"===Object(b.a)(e)&&e.hasOwnProperty("package")&&e.hasOwnProperty("aspects")&&e.hasOwnProperty("name")&&e.hasOwnProperty("identity")}function T(e,t,n,r){var o={};return Object.entries(e).forEach((function(e){var a=q(e,2),i=a[0],c=a[1];if("Array"===Object(b.a)(c))o[i]=c.map((function(e){if(!z(e))return"Object"===Object(b.a)(e)?T(e,t,n,r):e;var o=T(e.aspects,t,n,r);return o.key||(o.key=e.identity),C(e.name,e.package,e.identity,o,t,n,r)}));else if(z(c)){var s=T(c.aspects,t,n,r);o[i]=C(c.name,c.package,c.identity,s,t,n,r)}else"Object"===Object(b.a)(c)&&(o[i]=T(c,t,n,r))})),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}({},e,o)}function C(e,t,n,r,a,i,c){var s=window[t],u=o.a.createElement(s[e],r);return o.a.createElement(R,{identity:n,updateAspects:a,component:u,connect:i,package_name:t,component_name:e,aspects:r,disconnect:c,key:"wrapper-".concat(n)})}function N(e){return o.a.isValidElement(e)?{identity:e.props.identity,aspects:Object(h.a)(N,Object(g.a)(["identity","updateAspects","_name","_package","aspects","key"],e.props.aspects)),name:e.props.component_name,package:e.props.package_name}:"Array"===Object(b.a)(e)?e.map(N):"Object"===Object(b.a)(e)?Object(h.a)(N,e):e}function M(e){return new Promise((function(t,n){var r,o=e.url,a=e.kind,i=e.meta;if("js"===a)r=w.loadScript;else{if("css"!==a)return"map"===a?t():n({error:"Invalid requirement kind: ".concat(a)});r=w.loadCss}return r(o,i).then(t).catch(n)}))}R.propTypes={identity:s.a.string.isRequired,updateAspects:s.a.func.isRequired,component:s.a.node.isRequired,connect:s.a.func.isRequired,component_name:s.a.string.isRequired,package_name:s.a.string.isRequired,disconnect:s.a.func.isRequired};var J=n(6),D=n(99);function U(e){return function t(n){for(var r,o,a,i=[],c=0,s=n.length;c<s;){if(Object(D.a)(n[c]))for(a=0,o=(r=e?t(n[c]):n[c]).length;a<o;)i[i.length]=r[a],a+=1;else i[i.length]=n[c];c+=1}return i}}var I=Object(J.a)(U(!0)),L=n(5),H=Object(L.a)((function(e,t){var n={};for(var r in t)e(t[r],r,t)&&(n[r]=t[r]);return n})),W=Object(L.a)((function e(t,n){var r,o,a,i=n instanceof Array?[]:{};for(o in n)a=typeof(r=t[o]),i[o]="function"===a?r(n[o]):r&&"object"===a?e(r,n[o]):n[o];return i}));function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Z=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(o=K(t).call(this,e))||"object"!==X(o)&&"function"!=typeof o?Q(r):o).state={layout:!1,ready:!1,page:null,bindings:{},packages:[],requirements:[],reloading:!1,needRefresh:!1},n.pageApi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(){var t=e+arguments[0],n=arguments[1]||{};return n.headers=u({},n.headers),new Promise((function(e){y(t,n).then(e)}))}}(window.location.href),n.boundComponents={},n.ws=null,n.updateAspects=n.updateAspects.bind(Q(n)),n.connect=n.connect.bind(Q(n)),n.disconnect=n.disconnect.bind(Q(n)),n.onMessage=n.onMessage.bind(Q(n)),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,e),n=t,(r=[{key:"updateAspects",value:function(e,t){var n=this;return new Promise((function(r){var o=Object(m.a)(t),a=o.map((function(r){return G({},n.state.bindings["".concat(r,"@").concat(e)],{value:t[r]})})).filter((function(e){return e.trigger}));if(n.state.rebindings.forEach((function(n){n.trigger.identity.test(e)&&(a=Object(O.a)(a,o.filter((function(e){return n.trigger.aspect.test(e)})).map((function(r){return G({},n,{value:t[r],trigger:G({},n.trigger,{identity:e,aspect:r})})})))).push()})),!a)return r(0);a.forEach((function(e){return n.sendBinding(e,e.value)})),r(a.length)}))}},{key:"connect",value:function(e,t,n,r){this.boundComponents[e]={setAspects:t,getAspect:n,matchAspects:r}}},{key:"disconnect",value:function(e){delete this.boundComponents[e]}},{key:"onMessage",value:function(e){var t,n=this,r=JSON.parse(e.data),o=r.identity,a=r.kind,i=r.payload,c=r.storage,s=r.request_id;switch(t="session"===c?window.sessionStorage:window.localStorage,a){case"set-aspect":var u=function(e){return e.setAspects(T(i,n.updateAspects,n.connect,n.disconnect)).then((function(){return n.updateAspects(o,i)}))};if(r.regex){var p=new RegExp(r.identity);Object(m.a)(this.boundComponents).filter((function(e){return p.test(e)})).map((function(e){return n.boundComponents[e]})).forEach(u)}else u(this.boundComponents[o]);break;case"get-aspect":var f=r.aspect,l=this.boundComponents[o];if(!l)return void this.ws.send(JSON.stringify({kind:a,identity:o,aspect:f,request_id:s,error:"Aspect not found ".concat(o,".").concat(f)}));var d=l.getAspect(f);this.ws.send(JSON.stringify({kind:a,identity:o,aspect:f,value:N(d),request_id:s}));break;case"set-storage":t.setItem(o,JSON.stringify(i));break;case"get-storage":this.ws.send(JSON.stringify({kind:a,identity:o,request_id:s,value:JSON.parse(t.getItem(o))}));break;case"reload":var y=r.filenames,b=r.hot,h=r.refresh,g=r.deleted;if(h)return this.ws.close(),this.setState({reloading:!0,needRefresh:!0});if(b)return this.setState({reloading:!0});y.forEach(M),g.forEach((function(e){return Object(w.disableCss)(e.url)}))}}},{key:"sendBinding",value:function(e,t){var n=this,r={trigger:G({},e.trigger,{value:N(t)}),states:e.states.reduce((function(e,t){if(t.regex){var r=new RegExp(t.identity),o=new RegExp(t.aspect);return Object(O.a)(e,I(Object(m.a)(n.boundComponents).map((function(e){var a=[];return r.test(e)&&(a=n.boundComponents[e].matchAspects(o).map((function(n){var r=B(n,2),o=r[0],a=r[1];return G({},t,{identity:e,aspect:o,value:N(a)})}))),a}))))}return e.push(G({},t,{value:n.boundComponents[t.identity]&&N(n.boundComponents[t.identity].getAspect(t.aspect))})),e}),[]),kind:"binding",page:this.state.page,key:e.key};this.ws.send(JSON.stringify(r))}},{key:"_connectWS",value:function(){var e=this,t=0,n=!1;!function r(){var o="ws".concat(window.location.href.startsWith("https")?"s":"","://").concat(e.props.baseUrl&&e.props.baseUrl||window.location.host,"/").concat(e.state.page,"/ws");e.ws=new WebSocket(o),e.ws.addEventListener("message",e.onMessage),e.ws.onopen=function(){e.state.reloading?(n=!0,e.ws.close(),e.state.needRefresh?window.location.reload():e.props.hotReload()):(e.setState({ready:!0}),t=0)},e.ws.onclose=function(){!n&&t<e.props.retries&&setTimeout((function(){t++,r()}),1e3)}}()}},{key:"componentDidMount",value:function(){var e=this;this.pageApi("",{method:"POST"}).then((function(t){var n=function(e){return new RegExp(e)};e.setState({page:t.page,layout:t.layout,bindings:H((function(e){return!e.regex}),t.bindings),rebindings:Object(h.a)((function(e){var r=t.bindings[e];return r.trigger=W({identity:n,aspect:n},r.trigger),r}),Object(m.a)(H((function(e){return e.regex}),t.bindings))),packages:t.packages,requirements:t.requirements},(function(){return(n=t.requirements,r=t.packages,new Promise((function(e,t){var o=[];Object.keys(r).forEach((function(e){var t=r[e];o=o.concat(t.requirements.map(M))})),Promise.all(o).then((function(){var t=0;!function r(){t<n.length?M(n[t]).then((function(){t++,r()})):e()}()})).catch(t)}))).then((function(){Object(m.a)(t.bindings).length||t.reload?e._connectWS():e.setState({ready:!0})}));var n,r}))}))}},{key:"render",value:function(){var e=this.state,t=e.layout,n=e.ready,r=e.reloading;if(!n)return o.a.createElement("div",{className:"dazzler-loading-container"},o.a.createElement("div",{className:"dazzler-spin"}),o.a.createElement("div",{className:"dazzler-loading"},"Loading..."));if(r)return o.a.createElement("div",{className:"dazzler-loading-container"},o.a.createElement("div",{className:"dazzler-spin reload"}),o.a.createElement("div",{className:"dazzler-loading"},"Reloading..."));if(!z(t))throw new Error("Layout is not a component: ".concat(t));return o.a.createElement("div",{className:"dazzler-rendered"},C(t.name,t.package,t.identity,T(t.aspects,this.updateAspects,this.connect,this.disconnect),this.updateAspects,this.connect,this.disconnect))}}])&&V(n.prototype,r),a&&V(n,a),t}(o.a.Component);function $(){return($=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Z.defaultProps={},Z.propTypes={baseUrl:s.a.string.isRequired,ping:s.a.bool,ping_interval:s.a.number,retries:s.a.number,hotReload:s.a.func};var te=function(e){var t=ee(Object(r.useState)(1),2),n=t[0],a=t[1];return window.dazzler_base_url=e.baseUrl,o.a.createElement("div",{className:"dazzler-renderer"},o.a.createElement(Z,$({},e,{key:"upd-".concat(n),hotReload:function(){return a(n+1)}})))};te.propTypes={baseUrl:s.a.string.isRequired,ping:s.a.bool,ping_interval:s.a.number,retries:s.a.number};var ne=te;function re(e,t){var n=e.baseUrl,r=e.ping,a=e.ping_interval,c=e.retries;i.a.render(o.a.createElement(ne,{baseUrl:n,ping:r,ping_interval:a,retries:c}),t)}n.d(t,"render",(function(){return re})),n.d(t,"Renderer",(function(){return ne}))}})}));
//# sourceMappingURL=dazzler_renderer_6ee7514ee44449b3f910.js.map