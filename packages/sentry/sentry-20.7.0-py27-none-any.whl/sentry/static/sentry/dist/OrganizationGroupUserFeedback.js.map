{"version":3,"sources":["webpack:///./app/views/organizationGroupDetails/utils.jsx","webpack:///./app/views/organizationGroupDetails/groupUserFeedback.jsx"],"names":["fetchGroupEventAndMarkSeen","api","orgId","projectId","groupId","eventId","envNames","a","url","query","length","environment","requestPromise","data","bulkUpdate","itemIds","failSilently","hasSeen","fetchGroupUserReports","Client","includeAllArgs","getEventEnvironment","event","tag","tags","find","key","value","GroupUserFeedback","props","fetchData","setState","loading","error","group","id","params","then","jqXHR","reportList","pageLinks","getResponseHeader","state","this","prevProps","isEqual","organization","onRetry","className","map","item","idx","report","slug","issueId","projectIds","project","React","Component","withOrganization"],"mappings":"iPAWO,SAAeA,EAAtB,4C,oCAAO,WACLC,EACAC,EACAC,EACAC,EACAC,EACAC,GANK,mBAAAC,EAAA,6DAQCC,EACQ,WAAZH,GAAoC,WAAZA,EAAxB,kBACeD,EADf,mBACiCC,EADjC,yBAEiBH,EAFjB,YAE0BC,EAF1B,mBAE8CE,EAF9C,KAIII,EAAQ,GACU,IAApBH,EAASI,SACXD,EAAME,YAAcL,GAfjB,kBAmBgBL,EAAIW,eAAeJ,EAAK,CAACC,UAnBzC,cAmBGI,EAnBH,OAoBHZ,EAAIa,WAAW,CACbZ,QACAC,YACAY,QAAS,CAACX,GACVY,cAAc,EACdH,KAAM,CAACI,SAAS,KAzBf,kBA2BIJ,GA3BJ,wG,sBAiCA,SAASK,EAAsBd,EAASK,GAG7C,OAFY,IAAIU,KAELP,eAAJ,kBAA8BR,EAA9B,kBAAuD,CAC5DgB,gBAAgB,EAChBX,UAUG,SAASY,EAAoBC,GAClC,IAAMC,EAAMD,EAAME,KAAKC,MAAK,kBAAmB,gBAAnB,EAAEC,OAE9B,OAAOH,EAAMA,EAAII,MAAQ,O,ggBChDrBC,E,uLAMJ,WAAYC,GAAO,0BACjB,cAAMA,IAmBRC,UAAY,WACV,EAAKC,SAAS,CACZC,SAAS,EACTC,OAAO,IAGTf,YAAsB,EAAKW,MAAMK,MAAMC,GAAI,EAAKN,MAAMO,QACnDC,MAAK,YAAsB,eAApBxB,EAAoB,KAAXyB,GAAW,WAC1B,EAAKP,SAAS,CACZE,OAAO,EACPD,SAAS,EACTO,WAAY1B,EACZ2B,UAAWF,EAAMG,kBAAkB,aANzC,OASS,WACL,EAAKV,SAAS,CACZE,OAAO,EACPD,SAAS,QApCf,EAAKU,MAAQ,CACXV,SAAS,EACTC,OAAO,EACPM,WAAY,GACZC,UAAW,IANI,E,wDAWjBG,KAAKb,c,yCAGYc,GACZC,IAAQD,EAAUR,OAAQO,KAAKd,MAAMO,SACxCO,KAAKb,c,+BA2BA,IACAS,EAAcI,KAAKD,MAAnBH,WADA,EAEuBI,KAAKd,MAA5BiB,EAFA,EAEAA,aAAcZ,EAFd,EAEcA,MAErB,OAAIS,KAAKD,MAAMV,QACN,YAAC,UAAD,MACEW,KAAKD,MAAMT,MACb,YAAC,IAAD,CAAcc,QAASJ,KAAKb,YAGjCS,EAAW7B,OAEX,mBAAKsC,UAAU,OACb,mBAAKA,UAAU,YACZT,EAAWU,KAAI,SAACC,EAAMC,GAAP,OACd,YAAC,IAAD,CACEzB,IAAKyB,EACLC,OAAQF,EACRhD,MAAO4C,EAAaO,KACpBC,QAASpB,EAAMC,QAGnB,YAAC,IAAD,CAAYK,UAAWG,KAAKD,MAAMF,cAOxC,YAAC,IAAD,KACE,YAAC,IAAD,CAAmBe,WAAY,CAACrB,EAAMsB,QAAQrB,W,GA/EtBsB,IAAMC,WAAhC9B,E,gCAqFS+B,sBAAiB/B","file":"OrganizationGroupUserFeedback.js","sourcesContent":["import {Client} from 'app/api';\n\n/**\n * Fetches group data and mark as seen\n *\n * @param {String} orgId organization slug\n * @param {String} projectId project slug\n * @param {String} groupId groupId\n * @param {String} eventId eventId or \"latest\" or \"oldest\"\n * @returns {Promise<Object>}\n */\nexport async function fetchGroupEventAndMarkSeen(\n  api,\n  orgId,\n  projectId,\n  groupId,\n  eventId,\n  envNames\n) {\n  const url =\n    eventId === 'latest' || eventId === 'oldest'\n      ? `/issues/${groupId}/events/${eventId}/`\n      : `/projects/${orgId}/${projectId}/events/${eventId}/`;\n\n  const query = {};\n  if (envNames.length !== 0) {\n    query.environment = envNames;\n  }\n\n  try {\n    const data = await api.requestPromise(url, {query});\n    api.bulkUpdate({\n      orgId,\n      projectId,\n      itemIds: [groupId],\n      failSilently: true,\n      data: {hasSeen: true},\n    });\n    return data;\n  } catch (err) {\n    throw err;\n  }\n}\n\nexport function fetchGroupUserReports(groupId, query) {\n  const api = new Client();\n\n  return api.requestPromise(`/issues/${groupId}/user-reports/`, {\n    includeAllArgs: true,\n    query,\n  });\n}\n\n/**\n * Returns the environment name for an event or null\n *\n * @param {Object} event\n * @returns {String|Void}\n */\nexport function getEventEnvironment(event) {\n  const tag = event.tags.find(({key}) => key === 'environment');\n\n  return tag ? tag.value : null;\n}\n","import React from 'react';\nimport isEqual from 'lodash/isEqual';\n\nimport SentryTypes from 'app/sentryTypes';\nimport EventUserFeedback from 'app/components/events/userFeedback';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport {Panel} from 'app/components/panels';\nimport Pagination from 'app/components/pagination';\nimport withOrganization from 'app/utils/withOrganization';\nimport UserFeedbackEmpty from 'app/views/userFeedback/userFeedbackEmpty';\n\nimport {fetchGroupUserReports} from './utils';\n\nclass GroupUserFeedback extends React.Component {\n  static propTypes = {\n    organization: SentryTypes.Organization.isRequired,\n    group: SentryTypes.Group.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n      error: false,\n      reportList: [],\n      pageLinks: '',\n    };\n  }\n\n  componentDidMount() {\n    this.fetchData();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (!isEqual(prevProps.params, this.props.params)) {\n      this.fetchData();\n    }\n  }\n\n  fetchData = () => {\n    this.setState({\n      loading: true,\n      error: false,\n    });\n\n    fetchGroupUserReports(this.props.group.id, this.props.params)\n      .then(([data, _, jqXHR]) => {\n        this.setState({\n          error: false,\n          loading: false,\n          reportList: data,\n          pageLinks: jqXHR.getResponseHeader('Link'),\n        });\n      })\n      .catch(() => {\n        this.setState({\n          error: true,\n          loading: false,\n        });\n      });\n  };\n\n  render() {\n    const {reportList} = this.state;\n    const {organization, group} = this.props;\n\n    if (this.state.loading) {\n      return <LoadingIndicator />;\n    } else if (this.state.error) {\n      return <LoadingError onRetry={this.fetchData} />;\n    }\n\n    if (reportList.length) {\n      return (\n        <div className=\"row\">\n          <div className=\"col-md-9\">\n            {reportList.map((item, idx) => (\n              <EventUserFeedback\n                key={idx}\n                report={item}\n                orgId={organization.slug}\n                issueId={group.id}\n              />\n            ))}\n            <Pagination pageLinks={this.state.pageLinks} />\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <Panel>\n        <UserFeedbackEmpty projectIds={[group.project.id]} />\n      </Panel>\n    );\n  }\n}\n\nexport default withOrganization(GroupUserFeedback);\n"],"sourceRoot":""}