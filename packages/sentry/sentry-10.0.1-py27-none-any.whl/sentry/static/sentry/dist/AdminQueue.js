(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[51],{1609:function(e,t,n){"use strict";var r,a,o=n(2),s=n(44),i=n.n(s),u=n(1),c=n.n(u),l=n(0),h=n.n(l),p=n(35),d=n(289),m=n(47),f=n(28),b=n(4),y=n(5),g=n(105),v=n.n(g),E=n(3),j=n(336),O=n(50),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={query:"",busy:!1},t.immediateQuery=function(e){return Object(o.b)(t,void 0,void 0,(function(){var t,n,r,a,s,i;return Object(o.e)(this,(function(u){switch(u.label){case 0:t=this.props,n=t.location,r=t.api,this.setState({busy:!0}),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,r.requestPromise(""+this.props.url,{includeAllArgs:!0,method:"GET",query:Object(o.a)(Object(o.a)({},n.query),{query:e})})];case 2:return a=o.g.apply(void 0,[u.sent(),3]),s=a[0],i=a[2],this.state.query===e&&this.props.onSuccess(s,i),[3,4];case 3:return u.sent(),this.props.onError(),[3,4];case 4:return this.setState({busy:!1}),[2]}}))}))},t.query=v()(t.immediateQuery,t.props.debounceWait),t.handleChange=function(e){t.query(e),t.setState({query:e})},t.handleInputChange=function(e){return t.handleChange(e.target.value)},t.handleSearch=function(e){var n=t.props,r=n.updateRoute,a=n.onSearchSubmit;if(e.preventDefault(),r){var o=t.props,s=o.router,i=o.location;s.push({pathname:i.pathname,query:{query:t.state.query}})}"function"==typeof a&&a(t.state.query,e)},t}return Object(o.d)(t,e),t.prototype.render=function(){var e=this.props,t=e.placeholder,n=e.children,r=e.className,a=this.state,o=a.busy,s=a.query,i=h.a.createElement(q,{onSubmit:this.handleSearch},h.a.createElement(j.a,{value:s,onChange:this.handleInputChange,className:r,placeholder:t}),o&&h.a.createElement(w,{size:18,hideMessage:!0,mini:!0}));return void 0===n?i:n({defaultSearchBar:i,busy:o,value:s,handleChange:this.handleChange})},t.defaultProps={placeholder:"Search...",debounceWait:200},t}(h.a.Component),w=Object(E.c)(O.default,{target:"e6xwo0"})(r||(r=Object(o.f)(["\n  position: absolute;\n  right: 25px;\n  top: 50%;\n  transform: translateY(-13px);\n"],["\n  position: absolute;\n  right: 25px;\n  top: 50%;\n  transform: translateY(-13px);\n"]))),q=Object(E.c)("form",{target:"e6xwo1"})(a||(a=Object(o.f)(["\n  position: relative;\n"],["\n  position: relative;\n"]))),R=y.withRouter(S),k=n(159),D=n(6),x=n.n(D),C=n(7),P=n.n(C),T=n(9),N=n.n(T),W=n(8),M=n.n(W),L=n(10),_=n.n(L),J=n(251),A=n.n(J),B=n(104),I=n(73),K=function(e){function t(){return x()(this,t),N()(this,M()(t).apply(this,arguments))}return _()(t,e),P()(t,[{key:"componentDidMount",value:function(){var e=this.props.routes,t=this.context,n=t.organization,r=t.project,a=Object(I.a)(e);p.l((function(e){e.setFingerprint(["Permission Denied",a]),e.setExtra("route",a),e.setExtra("orgFeatures",n&&n.features||[]),e.setExtra("orgAccess",n&&n.access||[]),e.setExtra("projectFeatures",r&&r.features||[]),p.c(new Error("".concat("Permission Denied").concat(a?" : ".concat(a):"")))}))}},{key:"render",value:function(){return h.a.createElement(A.a,{title:Object(b.b)("Permission Denied")},h.a.createElement(k.a,{message:Object(b.c)("Your role does not have the necessary permissions to access this resource, please read more about [link:organizational roles]",{link:h.a.createElement(B.a,{href:"https://docs.sentry.io/learn/membership/"})})}))}}]),t}(h.a.Component);K.displayName="PermissionDenied",K.contextTypes={organization:c.a.object,project:c.a.object};var z=Object(y.withRouter)(K),F=n(569);function H(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{return t.apply(void 0,Object(o.i)(n))}catch(t){return console.error(t),setTimeout((function(){throw t})),e.setState({error:t}),null}}}var U=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.reloadOnVisible=!1,r.shouldReloadOnVisible=!1,r.shouldReload=!1,r.shouldRenderBadRequests=!1,r.api=new m.a,r.markShouldMeasure=function(e){var t=void 0===e?{}:e,n=t.remainingRequests,a=t.error;r._measurement.hasMeasured||(r._measurement.finished=0===n,r._measurement.error=a||r._measurement.error)},r.remountComponent=function(){r.shouldReload?r.reloadData():r.setState(r.getDefaultState(),r.fetchData)},r.visibilityReloader=function(){return r.shouldReloadOnVisible&&!r.state.loading&&!document.hidden&&r.reloadData()},r.fetchData=function(e){var t=r.getEndpoints();t.length?(r.api.clear(),r.setState(Object(o.a)({loading:!0,error:!1,remainingRequests:t.length},e)),t.forEach((function(e){var t=Object(o.g)(e,4),n=t[0],a=t[1],s=t[2],i=t[3];i=i||{};var u=r.props.location&&r.props.location.query||{},c=s&&s.query||{};(i.paginate||u.cursor)&&(c=Object(o.a)(Object(o.a)({},u),c)),r.api.request(a,Object(o.a)(Object(o.a)({method:"GET"},s),{query:c,success:function(e,t,a){r.handleRequestSuccess({stateKey:n,data:e,jqXHR:a},!0)},error:function(e){i.allowError&&i.allowError(e)&&(e=null),r.handleError(e,[n,a,s,i])}}))}))):r.setState({loading:!1,error:!1})},r.fetchData=H(r,r.fetchData.bind(r)),r.render=H(r,r.render.bind(r)),r.state=r.getDefaultState(),r._measurement={hasMeasured:!1},t.routes&&t.routes&&f.b.mark("async-component-"+Object(I.a)(t.routes)),r}return Object(o.d)(t,e),t.prototype.componentWillMount=function(){this.api=new m.a,this.fetchData(),this.reloadOnVisible&&document.addEventListener("visibilitychange",this.visibilityReloader)},t.prototype.componentWillReceiveProps=function(e,t){},t.prototype.componentDidUpdate=function(e,t){var n=!!t.router,r=void 0!==e.location,a=r?this.props.location:n?this.context.router.location:null,o=r?e.location:n?t.router.location:null;if(a&&o){if(!this._measurement.hasMeasured&&this._measurement.finished&&this.props.routes){var s=Object(I.a)(this.props.routes);f.b.measure({name:"app.component.async-component",start:"async-component-"+s,data:{route:s,error:this._measurement.error}}),this._measurement.hasMeasured=!0,"function"==typeof this.props.finishProfile&&this.props.finishProfile()}i()(this.props.params,e.params)&&a.search===o.search&&a.state===o.state||this.remountComponent()}},t.prototype.componentWillUnmount=function(){this.api.clear(),document.removeEventListener("visibilitychange",this.visibilityReloader)},t.prototype.getDefaultState=function(){var e=this.getEndpoints(),t={loading:!0,reloading:!1,error:!1,errors:{}};return e.forEach((function(e){var n=Object(o.g)(e,2),r=n[0];n[1];t[r]=null})),t},t.prototype.reloadData=function(){this.fetchData({reloading:!0})},t.prototype.onRequestSuccess=function(e){},t.prototype.onRequestError=function(e,t){},t.prototype.handleRequestSuccess=function(e,t){var n=this,r=e.stateKey,a=e.data,o=e.jqXHR;this.setState((function(e){var s,i=((s={})[r]=a,s[r+"PageLinks"]=o&&o.getResponseHeader("Link"),s);return t&&(i.remainingRequests=e.remainingRequests-1,i.loading=e.remainingRequests>1,i.reloading=e.reloading&&i.loading,n.markShouldMeasure({remainingRequests:i.remainingRequests})),i})),this.onRequestSuccess({stateKey:r,data:a,jqXHR:o})},t.prototype.handleError=function(e,t){var n=this,r=Object(o.g)(t,1)[0];e&&e.responseText&&p.a({message:e.responseText,category:"xhr",level:d.a.Error}),this.setState((function(t){var a,s,i=t.remainingRequests>1,u=((a={})[r]=null,a.errors=Object(o.a)(Object(o.a)({},t.errors),((s={})[r]=e,s)),a.error=t.error||!!e,a.remainingRequests=t.remainingRequests-1,a.loading=i,a.reloading=t.reloading&&i,a);return n.markShouldMeasure({remainingRequests:u.remainingRequests,error:!0}),u})),this.onRequestError(e,t)},t.prototype.getEndpointParams=function(){return console.warn("getEndpointParams is deprecated"),{}},t.prototype.getEndpoint=function(){return console.warn("getEndpoint is deprecated"),null},t.prototype.getEndpoints=function(){var e=this.getEndpoint();return e?[["data",e,this.getEndpointParams()]]:[]},t.prototype.renderSearchInput=function(e){var t=this,n=e.stateKey,r=e.url,a=Object(o.h)(e,["stateKey","url"]),s=Object(o.g)(this.getEndpoints()||[null],1)[0],i=n||s&&s[0],u=r||s&&s[1];return h.a.createElement(R,Object(o.a)({url:u},a,{api:this.api,onSuccess:function(e,n){t.handleRequestSuccess({stateKey:i,data:e,jqXHR:n})},onError:function(){t.renderError(new Error("Error with AsyncComponentSearchInput"))}}))},t.prototype.renderLoading=function(){return h.a.createElement(O.default,null)},t.prototype.renderError=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=this.state.errors,a=Object.values(r).find((function(e){return e&&401===e.status})),o=Object.values(r).find((function(e){return e&&403===e.status})),s=!!Object.values(r).find((function(e){return e&&0!==e.status}))||t;if(a)return h.a.createElement(k.a,{message:Object(b.b)("You are not authorized to access this resource.")});if(o)return h.a.createElement(z,null);if(this.shouldRenderBadRequests){var i=Object.values(r).filter((function(e){return e&&400===e.status&&e.responseJSON&&e.responseJSON.detail})).map((function(e){return e.responseJSON.detail}));if(i.length)return h.a.createElement(k.a,{message:i.join("\n")})}return h.a.createElement(F.a,{error:e,component:this,disableLogSentry:!s,disableReport:n,onRetry:this.remountComponent})},t.prototype.renderComponent=function(){return!this.state.loading||this.shouldReload&&this.state.reloading?this.state.error?this.renderError(new Error("Unable to load all required endpoints")):this.renderBody():this.renderLoading()},t.prototype.renderBody=function(){throw new Error("Not implemented")},t.prototype.render=function(){return this.renderComponent()},t.propTypes={location:c.a.object,router:c.a.object},t.contextTypes={router:c.a.object},t}(h.a.Component);t.a=U},1610:function(e,t,n){"use strict";var r=n(2),a=n(251),o=n.n(a),s=n(0),i=n.n(s),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.d)(t,e),t.prototype.getTitle=function(){return""},t.prototype.render=function(){var e=this.getTitle();return i.a.createElement(o.a,{title:(e?e+" - ":"")+"Sentry"},this.renderComponent())},t}(n(1609).a);t.a=u},1836:function(e,t,n){"use strict";var r=n(45),a=n.n(r),o=n(6),s=n.n(o),i=n(7),u=n.n(i),c=n(9),l=n.n(c),h=n(8),p=n.n(h),d=n(10),m=n.n(d),f=n(0),b=n.n(f),y=n(598),g=n(159),v=n(50),E=n(61),j=function(e){function t(){var e,n;s()(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=l()(this,(e=p()(t)).call.apply(e,[this].concat(a)))).state={error:!1,loading:!0,data:null},n}return m()(t,e),u()(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.loading!==t.loading}},{key:"componentDidUpdate",value:function(e){e.since===this.props.since&&e.stat===this.props.stat&&e.resolution===this.props.resolution||this.fetchData()}},{key:"fetchData",value:function(){var e=this;this.setState({loading:!0}),this.props.api.request("/internal/stats/",{method:"GET",data:{since:this.props.since,resolution:this.props.resolution,key:this.props.stat},success:function(t){return e.setState({data:t,loading:!1,error:!1})},error:function(){return e.setState({error:!0})}})}},{key:"getChartPoints",value:function(){return this.state.data.map((function(e){var t=a()(e,2);return{x:t[0],y:t[1]}}))}},{key:"render",value:function(){return this.state.loading?b.a.createElement(v.default,null):this.state.error?b.a.createElement(g.a,{onRetry:this.fetchData}):b.a.createElement(y.a,{points:this.getChartPoints(),className:"standard-barchart",label:this.props.label,height:this.props.height})}}]),t}(b.a.Component);j.displayName="InternalStatChart",j.defaultProps={height:150},t.a=Object(E.a)(j)},2596:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return q}));var r=n(34),a=n.n(r),o=n(16),s=n.n(o),i=n(6),u=n.n(i),c=n(7),l=n.n(c),h=n(9),p=n.n(h),d=n(8),m=n.n(d),f=n(173),b=n.n(f),y=n(10),g=n.n(y),v=n(0),E=n.n(v),j=n(1610),O=n(1836),S=n(29);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var q=function(e){function t(){var e,n;u()(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=p()(this,(e=m()(t)).call.apply(e,[this].concat(a)))).changeTask=function(e){n.setState({activeTask:e})},n}return g()(t,e),l()(t,[{key:"getDefaultState",value:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(n,!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},b()(m()(t.prototype),"getDefaultState",this).call(this),{timeWindow:"1w",since:(new Date).getTime()/1e3-604800,resolution:"1h",taskName:null})}},{key:"getEndpoints",value:function(){return[["taskList","/internal/queue/tasks/"]]}},{key:"changeWindow",value:function(e){var t;if("1h"===e)t=3600;else if("1d"===e)t=86400;else{if("1w"!==e)throw new Error("Invalid time window");t=604800}this.setState({since:(new Date).getTime()/1e3-t,timeWindow:e})}},{key:"renderBody",value:function(){var e,t=this,n=this.state,r=n.activeTask,o=n.taskList;return E.a.createElement("div",null,E.a.createElement("div",{className:"btn-group pull-right"},["1h","1d","1w"].map((function(e){return E.a.createElement("a",{className:"btn btn-sm ".concat(e===t.state.timeWindow?"btn-primary":"btn-default"),onClick:function(){return t.changeWindow(e)},key:e},e)}))),E.a.createElement("h3",{className:"no-border"},"Queue Overview"),E.a.createElement("div",{className:"box"},E.a.createElement("div",{className:"box-header"},E.a.createElement("h3",null,"Global Throughput")),E.a.createElement(O.a,{since:this.state.since,resolution:this.state.resolution,stat:"jobs.all.started",label:"jobs started"})),E.a.createElement("h3",{className:"no-border"},"Task Details"),E.a.createElement("div",null,E.a.createElement("div",null,E.a.createElement("label",null,"Show details for task:"),E.a.createElement(S.SelectField,{name:"task",onChange:this.changeTask,value:r,allowClear:!0,choices:(e=[""]).concat.apply(e,a()(o)).map((function(e){return[e,e]}))})),r?E.a.createElement("div",null,E.a.createElement("div",{className:"box box-mini",key:"jobs.started"},E.a.createElement("div",{className:"box-header"},"Jobs Started ",E.a.createElement("small",null,r)),E.a.createElement(O.a,{since:this.state.since,resolution:this.state.resolution,stat:"jobs.started.".concat(this.state.activeTask),label:"jobs",height:100})),E.a.createElement("div",{className:"box box-mini",key:"jobs.finished"},E.a.createElement("div",{className:"box-header"},"Jobs Finished ",E.a.createElement("small",null,r)),E.a.createElement(O.a,{since:this.state.since,resolution:this.state.resolution,stat:"jobs.finished.".concat(this.state.activeTask),label:"jobs",height:100}))):null))}}]),t}(j.a)}}]);
//# sourceMappingURL=AdminQueue.js.map