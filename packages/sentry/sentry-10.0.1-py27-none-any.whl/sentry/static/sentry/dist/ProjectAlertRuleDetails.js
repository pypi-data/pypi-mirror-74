(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[128],{2654:function(e,t,n){"use strict";n.r(t);var r=n(6),a=n.n(r),i=n(7),o=n.n(i),l=n(9),c=n.n(l),s=n(8),u=n.n(s),h=n(10),d=n.n(h),p=n(0),m=n.n(p),g=n(53),b=n(1610),f=n(34),v=n.n(f),y=n(16),j=n.n(y),O=n(45),E=n.n(O),x=n(71),w=n.n(x),C=n(5),S=n(22),P=n.n(S),N=n(3),R=n(24),k=n(250),q=n(29),D=n(51),F=n(4),A=n(61),T=n(27),z=n(50),B=n(1632),I=n(137),M=function(e){function t(){return a()(this,t),c()(this,u()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"getChoiceField",value:function(e,t){var n,r=this;return void 0===this.props.data[e]&&t.choices.length?(n=t.initial?t.initial:t.choices[0][0],this.props.handlePropertyChange(e,n)):n=this.props.data[e],m.a.createElement(q.SelectField,{clearable:!1,placeholder:Object(F.b)("Select integration"),noResultsText:Object(F.b)("No integrations available"),name:e,value:n,choices:t.choices,key:e,style:{marginLeft:6,marginRight:6},onChange:function(t){return r.props.handlePropertyChange(e,t)}})}},{key:"getTextField",value:function(e,t){var n=this;return m.a.createElement(q.TextField,{name:e,value:this.props.data[e],placeholder:t.placeholder,key:e,style:{marginBottom:0},onChange:function(t){return n.props.handlePropertyChange(e,t)}})}},{key:"getNumberField",value:function(e,t){var n=this;return m.a.createElement(q.NumberField,{name:e,value:this.props.data[e],placeholder:t.placeholder.toString(),key:e,style:{marginBottom:0},onChange:function(t){return n.props.handlePropertyChange(e,t)}})}},{key:"getField",value:function(e,t){return{choice:this.getChoiceField.bind(this),number:this.getNumberField.bind(this),string:this.getTextField.bind(this)}[t.type](e,t)}},{key:"getComponent",value:function(e){var t=this,n=e.label,r=e.formFields;return n.split(/({\w+})/).map((function(e){if(!/^{\w+}$/.test(e))return e;var n=e.slice(1,-1);return"value"!==n||"is"!==t.props.data.match&&"ns"!==t.props.data.match?r[n]?t.getField(n,r[n]):e:null}))}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.node,r=this.getComponent(n);return m.a.createElement(U,null,m.a.createElement(_,null,m.a.createElement("input",{type:"hidden",name:"id",value:t.id}),r),m.a.createElement(J,null,m.a.createElement(T.a,{onClick:this.props.handleDelete,type:"button",size:"small",icon:"icon-trash"})))}}]),t}(m.a.Component);M.displayName="RuleNode";var L=M,U=Object(N.c)("div",{target:"e1qnqozx0"})("display:flex;align-items:center;padding:0 15px;&:nth-child(odd){background-color:",(function(e){return e.theme.offWhite}),";}"),_=Object(N.c)("div",{target:"e1qnqozx1"})("display:flex;flex-wrap:wrap;flex:1;line-height:40px;margin:5px 12px 5px 0;align-items:center;.control-group{margin:0 6px;}.form-control{padding:3px 12px;}.Select{line-height:26px;min-width:150px;}.Select-placeholder{height:26px;line-height:26px;}.Select-control{height:24px;}.Select--single > .Select-control .Select-value{line-height:25px;}.Select-input{height:24px;input{line-height:20px;padding:2px 0;}}"),J=Object(N.c)("div",{target:"e1qnqozx2"})("margin-left:6px;"),W=function(e){function t(){var e,n;a()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=c()(this,(e=u()(t)).call.apply(e,[this].concat(i)))).getNode=function(e){return n.props.nodes.find((function(t){return t.id===e}))},n}return d()(t,e),o()(t,[{key:"render",value:function(){var e=this;return m.a.createElement("div",{className:this.props.className},m.a.createElement(V,null,this.props.items.map((function(t,n){return m.a.createElement(L,{key:n,node:e.getNode(t.id),handleDelete:function(){return e.props.handleDeleteRow(n)},data:t,handlePropertyChange:e.props.handlePropertyChange(n)})}))),m.a.createElement("fieldset",null,m.a.createElement(I.a,{onChange:function(t){return e.props.handleAddRow(t?t.value:t)},style:{width:"100%"},options:this.props.nodes.filter((function(e){return e.enabled})).map((function(e){return{value:e.id,label:e.label}}))})))}}]),t}(m.a.Component);W.displayName="RuleNodeList";var H=W,V=Object(N.c)("div",{target:"e17yy09u0"})("display:flex;flex-direction:column;margin-bottom:10px;"),$=n(1618),G=n(11),K=n(1755);function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(n,!0).forEach((function(t){j()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=[["5",Object(F.b)("5 minutes")],["10",Object(F.b)("10 minutes")],["30",Object(F.b)("30 minutes")],["60",Object(F.b)("60 minutes")],["180",Object(F.b)("3 hours")],["720",Object(F.b)("12 hours")],["1440",Object(F.b)("24 hours")],["10080",Object(F.b)("one week")],["43200",Object(F.b)("30 days")]],Z=[["all",Object(F.b)("all")],["any",Object(F.b)("any")],["none",Object(F.b)("none")]],ee=Object(N.c)("h6",{target:"elb7f1e0"})("display:flex;align-items:center;"),te=P()({displayName:"RuleEditor",getInitialState:function(){return{rule:null,loading:!1,error:null,environments:[]}},componentDidMount:function(){this.fetchData()},componentDidUpdate:function(){this.state.error&&w()(document.body).scrollTop(w()(this.formNode).offset().top)},fetchData:function(){var e=this,t=this.props,n=t.api,r=t.params,a=r.ruleId,i=r.projectId,o=r.orgId,l={actionMatch:"all",actions:[],conditions:[],name:"",frequency:30,environment:R.e},c=[n.requestPromise("/projects/".concat(o,"/").concat(i,"/environments/")),a?n.requestPromise("/projects/".concat(o,"/").concat(i,"/rules/").concat(a,"/")):Promise.resolve(l)];Promise.all(c).then((function(t){var n=E()(t,2),r=n[0],a=n[1];e.setState({environments:r,rule:a})}))},handleSubmit:function(e){var t=this;e.preventDefault();var n=X({},this.state.rule),r=!n.id,a=this.props,i=a.project,o=a.organization,l="/projects/".concat(o.slug,"/").concat(i.slug,"/rules/");n.id&&(l+=n.id+"/"),n.environment===R.e&&delete n.environment,Object(D.c)(Object(F.b)("Saving...")),this.props.api.request(l,{method:r?"POST":"PUT",data:n,success:function(e){t.setState({error:null,loading:!1,rule:e}),r&&C.browserHistory.replace(Object($.a)("".concat(e.id,"/"),X({},t.props,{stepBack:-1}))),Object(D.d)(r?Object(F.b)("Created alert rule"):Object(F.b)("Updated alert rule"))},error:function(e){t.setState({error:e.responseJSON||{__all__:"Unknown error"},loading:!1}),Object(D.a)(Object(F.b)("An error occurred"))}})},hasError:function(e){var t=this.state.error;return!!t&&!!t[e]},handleEnvironmentChange:function(e){e===R.e?this.handleChange("environment",null):this.handleChange("environment",e)},handleChange:function(e,t){this.setState((function(n){var r=X({},n.rule);return r[e]=t,{rule:r}}))},handlePropertyChange:function(e){var t=this;return function(n){return function(r,a){var i=X({},t.state.rule);i[e][n][r]=a,t.setState({rule:i})}}},handleAddRow:function(e){var t=this;return function(n){t.setState((function(t){return t.rule[e].push({id:n}),{rule:t.rule}}))}},handleDeleteRow:function(e){var t=this;return function(n){t.setState((function(t){return t.rule[e].splice(n,1),{rule:t.rule}}))}},render:function(){var e=this,t=this.props.params.projectId,n=this.state.environments,r=[[R.e,Object(F.b)("All Environments")]].concat(v()(n.map((function(e){return[e.name,Object(K.a)(e)]}))));if(!this.state.rule)return m.a.createElement(z.default,null);var a=this.state,i=a.rule,o=a.loading,l=a.error,c=i.actionMatch,s=i.actions,u=i.conditions,h=i.frequency,d=i.name,p=null===i.environment?R.e:i.environment,g=i.id?Object(F.b)("Edit Alert Rule"):Object(F.b)("New Alert Rule");return m.a.createElement("form",{onSubmit:this.handleSubmit,ref:function(t){return e.formNode=t}},m.a.createElement(B.a,{title:g,objSlug:t}),m.a.createElement(k.a,{className:"rule-detail"},m.a.createElement(k.e,null,g),m.a.createElement(k.c,{disablePadding:!1},l&&m.a.createElement("div",{className:"alert alert-block alert-error"},m.a.createElement("p",null,Object(F.b)("There was an error saving your changes. Make sure all fields are valid and try again."))),m.a.createElement("h6",null,Object(F.b)("Rule name"),":"),m.a.createElement(q.TextField,{name:"name",defaultValue:d,required:!0,placeholder:Object(F.b)("My Rule Name"),onChange:function(t){return e.handleChange("name",t)}}),m.a.createElement("hr",null),m.a.createElement(ee,null,Object(F.b)("Every time %s of these conditions are met:",m.a.createElement(q.SelectField,{clearable:!1,className:this.hasError("actionMatch")?" error":"",style:{marginBottom:0,marginLeft:5,marginRight:5,width:100},name:"actionMatch",value:c,required:!0,choices:Z,onChange:function(t){return e.handleChange("actionMatch",t)}}))),this.hasError("conditions")&&m.a.createElement("p",{className:"error"},this.state.error.conditions[0]),m.a.createElement(H,{nodes:this.props.conditions,items:u||[],className:"rule-condition-list",handlePropertyChange:this.handlePropertyChange("conditions"),handleAddRow:this.handleAddRow("conditions"),handleDeleteRow:this.handleDeleteRow("conditions")}),m.a.createElement("hr",null),m.a.createElement("h6",null,Object(F.b)("In this environment"),":"),m.a.createElement(q.SelectField,{clearable:!1,className:this.hasError("environment")?" error":"",style:{marginBottom:0,marginLeft:5,marginRight:5},name:"environment",value:p,required:!0,choices:r,onChange:function(t){return e.handleEnvironmentChange(t)}}),m.a.createElement("hr",null),m.a.createElement("h6",null,Object(F.b)("Take these actions:")),this.hasError("actions")&&m.a.createElement("p",{className:"error"},this.state.error.actions[0]),m.a.createElement(H,{nodes:this.props.actions,items:s||[],handlePropertyChange:this.handlePropertyChange("actions"),handleAddRow:this.handleAddRow("actions"),handleDeleteRow:this.handleDeleteRow("actions")}),m.a.createElement("hr",null),m.a.createElement(ee,null,Object(F.b)("Perform these actions at most once every %s for an issue.",m.a.createElement(q.SelectField,{clearable:!1,name:"frequency",className:this.hasError("frequency")?" error":"",value:h,style:{marginBottom:0,marginLeft:5,marginRight:5,width:140},required:!0,choices:Y,onChange:function(t){return e.handleChange("frequency",t)}}))),m.a.createElement(ae,null,m.a.createElement(re,{to:Object($.a)("",X({},this.props,{stepBack:-1}))},Object(F.b)("Cancel")),m.a.createElement(T.a,{priority:"primary",disabled:o},Object(F.b)("Save Rule"))))))}}),ne=Object(A.a)(te),re=Object(N.c)(T.a,{target:"elb7f1e1"})("margin-right:",Object(G.a)(1),";"),ae=Object(N.c)("div",{target:"elb7f1e2"})("display:flex;justify-content:flex-end;padding:",Object(G.a)(2),";border-top:1px solid ",(function(e){return e.theme.borderLight}),";margin:0 -",Object(G.a)(2)," -",Object(G.a)(2),";"),ie=function(e){function t(){return a()(this,t),c()(this,u()(t).apply(this,arguments))}return d()(t,e),o()(t,[{key:"getEndpoints",value:function(){var e=this.props.params,t=e.orgId,n=e.projectId;return[["configs","/projects/".concat(t,"/").concat(n,"/rules/configuration/")]]}},{key:"renderBody",value:function(){var e=this.context,t=e.organization,n=e.project,r=this.state.configs,a=r.actions,i=r.conditions;return m.a.createElement(ne,{organization:t,project:n,actions:a,conditions:i,params:this.props.params,routes:this.props.routes})}}]),t}(b.a);ie.contextTypes={organization:g.b.Organization,project:g.b.Project};t.default=ie}}]);
//# sourceMappingURL=ProjectAlertRuleDetails.js.map