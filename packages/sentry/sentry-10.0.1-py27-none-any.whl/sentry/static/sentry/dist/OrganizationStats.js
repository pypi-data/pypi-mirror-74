(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[125],{2611:function(t,e,a){"use strict";a.r(e),a.d(e,"OrganizationStatsContainer",(function(){return k}));var r=a(12),n=a.n(r),s=a(6),o=a.n(s),i=a(7),c=a.n(i),u=a(9),p=a.n(u),l=a(8),d=a.n(l),g=a(10),h=a.n(g),j=a(71),f=a.n(j),v=a(0),q=a.n(v),P=a(251),y=a.n(P),D=a(61),S=a(15),w=a(86),k=function(t){function e(t){var a;o()(this,e),a=p()(this,d()(e).call(this,t));var r=Math.floor((new Date).getTime()/1e3),n=r-604800;return a.state={projectsError:!1,projectsLoading:!1,projectsRequestsPending:0,statsError:!1,statsLoading:!1,statsRequestsPending:0,projectMap:null,rawProjectData:{received:null,rejected:null,blacklisted:null},rawOrgData:{received:null,rejected:null,blacklisted:null},orgStats:null,orgTotal:null,projectTotals:null,querySince:n,queryUntil:r},a}return h()(e,t),c()(e,[{key:"componentWillMount",value:function(){this.fetchData()}},{key:"componentWillReceiveProps",value:function(t){t.location.search!==this.props.location.search&&this.setState({projectsError:!1,projectsRequestsPending:1,projectsLoading:!0})}},{key:"componentDidUpdate",value:function(t){var e=t.params,a=this.props.params;e.orgId!==a.orgId&&this.fetchData(),t.location.search!==this.props.location.search&&(window.scrollTo&&window.scrollTo(0,0),this.fetchProjectData());var r=this.state;r.statsLoading&&!r.statsRequestsPending&&this.processOrgData(),r.projectsLoading&&!r.projectsRequestsPending&&this.processProjectData()}},{key:"fetchProjectData",value:function(){var t=this;this.props.api.request(this.getOrganizationProjectsEndpoint(),{query:this.props.location.query,success:function(e,a,r){var n={};e.forEach((function(t){n[t.id]=t})),t.setState((function(t){return{pageLinks:r.getResponseHeader("Link"),projectMap:n,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})}},{key:"fetchData",value:function(){var t=this;this.setState({statsError:!1,statsLoading:!0,statsRequestsPending:3,projectsError:!1,projectsLoading:!0,projectsRequestsPending:4});var e=this.getOrganizationStatsEndpoint();f.a.each(this.state.rawOrgData,(function(a){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,resolution:"1h",stat:a},success:function(e){t.setState((function(t){var r=t.rawOrgData;return r[a]=e,{rawOrgData:r,statsRequestsPending:t.statsRequestsPending-1}}))},error:function(){t.setState({statsError:!0})}})})),f.a.each(this.state.rawProjectData,(function(a){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,stat:a,group:"project"},success:function(e){t.setState((function(t){var r=t.rawProjectData;return r[a]=e,{rawProjectData:r,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})})),this.fetchProjectData()}},{key:"getOrganizationStatsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/stats/"}},{key:"getOrganizationProjectsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/projects/"}},{key:"processOrgData",value:function(){var t=0,e=0,a=0,r=[],n=[0,0],s=this.state.rawOrgData;f.a.each(s.received,(function(o,i){var c=i[1],u=s.rejected[o][1],p=s.blacklisted[o][1],l=Math.max(0,c-u-p);r.push({x:i[0],y:[l,u,p]}),t+=c,e+=u,a+=p,c>0&&(n[0]+=c,n[1]+=1)})),this.setState({orgStats:r,orgTotal:{received:t,rejected:e,blacklisted:a,accepted:Math.max(0,t-e-a),avgRate:n[1]?parseInt(n[0]/n[1]/60,10):0},statsLoading:!1})}},{key:"processProjectData",value:function(){var t=this.state.rawProjectData,e=[];f.a.each(t.received,(function(a,r){var n=0,s=0,o=0;f.a.each(r,(function(e,r){n+=r[1],s+=t.rejected[a][e][1],o+=t.blacklisted[a][e][1]})),e.push({id:a,received:n,rejected:s,blacklisted:o,accepted:Math.max(0,n-s-o)})})),this.setState({projectTotals:e,projectsLoading:!1})}},{key:"render",value:function(){var t=this.props.organization;return q.a.createElement(y.a,{title:"Stats - ".concat(t.slug," - Sentry")},q.a.createElement(S.a,n()({component:function(){return a.e(197).then(a.bind(null,2543)).then((function(t){return t.default}))},organization:t},this.state)))}}]),e}(q.a.Component);k.displayName="OrganizationStatsContainer",e.default=Object(D.a)(Object(w.a)(k))}}]);
//# sourceMappingURL=OrganizationStats.js.map