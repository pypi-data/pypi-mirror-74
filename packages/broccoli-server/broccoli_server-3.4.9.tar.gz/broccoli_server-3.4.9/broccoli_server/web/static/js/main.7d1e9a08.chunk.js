(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{33:function(e,t,n){e.exports=n.p+"static/media/icon.440ed357.png"},37:function(e,t,n){e.exports=n(87)},87:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(23),c=n.n(o),i=n(92),l=n(4),u=n(5),s=n(6),d=n(7),m=n(2),p=n(89),f=n(94),h=n(91),v=n(90),b=n(33),y=n.n(b),E=n(15),g=n(8);function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var k=function(e){Object(s.a)(n,e);var t=w(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={loading:!0,workers:[]},a.onReplicate=a.onReplicate.bind(Object(g.a)(a)),a.onRemove=a.onRemove.bind(Object(g.a)(a)),a.onUpdateIntervalSeconds=a.onUpdateIntervalSeconds.bind(Object(g.a)(a)),a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getWorkers().then(function(t){var n=t.data;e.setState({loading:!1,workers:n.map(function(e){return Object(E.a)({},e,{state:"Loading...",lastSeen:0,metadata:""})})})})}},{key:"onReplicate",value:function(e,t,n,a,r){this.replicate(t,n,a,r),e.preventDefault()}},{key:"replicate",value:function(e,t,n,a){this.props.redirectTo("/workers/create?module=".concat(e,"&class_name=").concat(t,"&args=").concat(encodeURIComponent(JSON.stringify(n)),"&interval_seconds=").concat(a))}},{key:"onRemove",value:function(e,t){this.remove(t),e.preventDefault()}},{key:"remove",value:function(e){var t=this;window.confirm("Are you sure you want to remove worker ".concat(e))&&this.props.apiClient.removeWorker(e).then(function(){t.setState(Object(E.a)({},t.state,{workers:t.state.workers.filter(function(t){return t.worker_id!==e})})),t.props.showOkMessage("Removed worker ".concat(e))}).catch(function(e){console.error(e.response.data),t.props.showErrorMessage(JSON.stringify(e.response.data))})}},{key:"onUpdateIntervalSeconds",value:function(e,t,n){this.updateIntervalSeconds(t,n),e.preventDefault()}},{key:"updateIntervalSeconds",value:function(e,t){var n=this;this.props.apiClient.updateWorkerIntervalSeconds(e,t).then(function(){n.props.showOkMessage("Updated worker ".concat(e," with interval seconds ").concat(t))}).catch(function(e){console.error(e.response.data),n.props.showErrorMessage(JSON.stringify(e.response.data))})}},{key:"renderWorkersTable",value:function(e){var t=this;return r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"ID"),r.a.createElement("th",null,"Module"),r.a.createElement("th",null,"Class Name"),r.a.createElement("th",null,"Args"),r.a.createElement("th",null,"Interval (seconds)"),r.a.createElement("th",null,"Error Resiliency"),r.a.createElement("th",null,"Executor Slug"),r.a.createElement("th",null,"Operations"))),r.a.createElement("tbody",null,e.map(function(e){var n=e.worker_id,a=e.module,o=e.class_name,c=e.args,i=e.interval_seconds,l=e.error_resiliency,u=e.executor_slug;return r.a.createElement("tr",{key:n},r.a.createElement("td",null,r.a.createElement(p.a,{to:"/worker/".concat(n)},n)),r.a.createElement("td",null,a),r.a.createElement("td",null,o),r.a.createElement("td",null,JSON.stringify(c)),r.a.createElement("td",null,r.a.createElement("input",{type:"number",value:i,onChange:function(e){t.setState({workers:t.state.workers.map(function(t){return t.worker_id!==n?t:Object(E.a)({},t,{interval_seconds:parseInt(e.target.value)})})})}}),r.a.createElement("button",{onClick:function(e){t.onUpdateIntervalSeconds(e,n,i)}},"Update")),r.a.createElement("td",null,-1!==l?l:"N/A"),r.a.createElement("td",null,u),r.a.createElement("td",null,r.a.createElement("button",{onClick:function(e){return t.onReplicate(e,a,o,c,i)}},"Create from"),r.a.createElement("button",{onClick:function(e){return t.onRemove(e,n)}},"x")))})))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("b",null,"View workers"),this.state.loading?r.a.createElement("div",null,"Loading workers..."):this.renderWorkersTable(this.state.workers))}}]),n}(a.Component),j=n(93),O=n(16),S=n.n(O),C=n(34),x=(n(56),n(35)),I=n.n(x),R=function(e){return r.a.createElement(I.a,{isOpen:e.isOpen,ariaHideApp:!1},r.a.createElement(C.a,{value:e.value,onChange:e.onValueChange}),r.a.createElement("button",{onClick:e.onClose},"Close"))},M=function(e){try{return JSON.parse(e)}catch(t){return{}}};function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var A=function(e){Object(s.a)(n,e);var t=P(n);function n(e){var a;Object(l.a)(this,n),a=t.call(this,e);var r=S.a.parse(a.props.location.search);return a.state={module:r.module||"",className:r.class_name||"",args:M(r.args),intervalSeconds:parseInt(r.interval_seconds)||60,modalIsOpen:!1},a.onSubmit=a.onSubmit.bind(Object(g.a)(a)),a}return Object(u.a)(n,[{key:"onSubmit",value:function(e){this.submit(),e.preventDefault()}},{key:"submit",value:function(){var e=this,t=this.state,n=t.module,a=t.className,r=t.args,o=t.intervalSeconds;this.props.apiClient.addWorker(n,a,r,o).then(function(){e.props.redirectTo("/workers/view")}).catch(function(t){console.error(t.response.data),e.props.showErrorMessage(JSON.stringify(t.response.data))})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("b",null,"Create new worker"),r.a.createElement("div",null,"Module:",r.a.createElement("br",null),r.a.createElement("input",{type:"text",size:63,value:this.state.module,onChange:function(t){e.setState({module:t.target.value})}}),r.a.createElement("br",null),"Class name:",r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:this.state.className,onChange:function(t){e.setState({className:t.target.value})}}),r.a.createElement("br",null),"Args:",r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){e.setState({modalIsOpen:!0})}},"Open JSON editor"),r.a.createElement("div",null,JSON.stringify(this.state.args)),"Interval seconds:",r.a.createElement("br",null),r.a.createElement("input",{type:"number",value:this.state.intervalSeconds,onChange:function(t){e.setState({intervalSeconds:parseInt(t.target.value)})}}),r.a.createElement("br",null),r.a.createElement("button",{onClick:this.onSubmit},"Submit")),r.a.createElement(R,{value:this.state.args,onValueChange:function(t){return e.setState({args:t})},onClose:function(){e.setState({modalIsOpen:!1})},isOpen:this.state.modalIsOpen}))}}]),n}(a.Component),D=Object(j.a)(A);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var _=function(e){Object(s.a)(n,e);var t=N(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).state={boards:[],loading:!0},a.onMoveUp=a.onMoveUp.bind(Object(g.a)(a)),a.onMoveDown=a.onMoveDown.bind(Object(g.a)(a)),a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getBoards().then(function(t){e.setState({boards:t.map(function(e){return{boardId:e.board_id,boardQuery:{q:e.board_query.q,limit:e.board_query.limit,sort:e.board_query.sort,projections:e.board_query.projections.map(function(e){return{name:e.name}})}}})})}).catch(function(t){e.props.showErrorMessage("Fail to get boards, message ".concat(t.toString()))}).finally(function(){e.setState({loading:!1})})}},{key:"onMoveUp",value:function(e,t){this.moveUp(t),e.preventDefault()}},{key:"moveUp",value:function(e){var t=this,n=this.state.boards[e].boardId,a=this.state.boards[e-1].boardId;this.props.apiClient.swapBoards(n,a).then(function(){t.props.showOkMessage("Moved up board ".concat(n))}).catch(function(e){t.props.showErrorMessage("Fail to move up board, message ".concat(e.toString()))})}},{key:"onMoveDown",value:function(e,t){this.moveDown(t),e.preventDefault()}},{key:"moveDown",value:function(e){var t=this,n=this.state.boards[e].boardId,a=this.state.boards[e+1].boardId;this.props.apiClient.swapBoards(n,a).then(function(){t.props.showOkMessage("Moved down board ".concat(n))}).catch(function(e){t.props.showErrorMessage("Fail to move down board, message ".concat(e.toString()))})}},{key:"onRemove",value:function(e,t){this.remove(t),e.preventDefault()}},{key:"remove",value:function(e){var t=this,n=this.state.boards[e].boardId;window.confirm('Are you sure you want to remove board "'.concat(n,'?"'))&&this.props.apiClient.removeBoard(n).then(function(){t.props.showOkMessage("Removed board ".concat(n))}).catch(function(e){t.props.showErrorMessage("Fail to remove board, message ".concat(e.toString()))})}},{key:"render",value:function(){var e=this;return this.state.loading?r.a.createElement("div",null,"Loading..."):0===this.state.boards.length?r.a.createElement("div",null,"No boards"):r.a.createElement("div",null,r.a.createElement("b",null,"View mod views"),r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Query"),r.a.createElement("th",null,"Limit"),r.a.createElement("th",null,"Sort"),r.a.createElement("th",null,"Columns"),r.a.createElement("th",null,"Operations"))),r.a.createElement("tbody",null,this.state.boards.map(function(t,n){var a=t.boardId,o=t.boardQuery,c=o.q,i=o.limit,l=o.sort,u=o.projections;return r.a.createElement("tr",{key:a},r.a.createElement("td",null,r.a.createElement(p.a,{to:"/board/".concat(encodeURIComponent(a))},a)),r.a.createElement("td",null,JSON.stringify(c)),r.a.createElement("td",null,i||"N/A"),r.a.createElement("td",null,l?JSON.stringify(l):"N/A"),r.a.createElement("td",null,u.map(function(e){return e.name}).join(", ")),r.a.createElement("td",null,r.a.createElement("button",{onClick:function(){return e.props.redirectTo("/boards/upsert?name=".concat(a))}},"Edit"),0!==n?r.a.createElement("button",{onClick:function(t){e.onMoveUp(t,n)}},"\u2191"):null,n!==e.state.boards.length-1?r.a.createElement("button",{onClick:function(t){e.onMoveDown(t,n)}},"\u2193"):null,r.a.createElement("button",{onClick:function(t){e.onRemove(t,n)}},"x")))}))))}}]),n}(a.Component),q=n(3),U=n.n(q),B=n(10),T=n(20),J=n.n(T),L=function(){function e(){Object(l.a)(this,e),this.TokenLocalStorageKey="accessToken",this.endpoint=void 0,this.axios=void 0,this.isAuth=void 0,this.endpoint="",this.axios=J.a.create(),this.isAuth=!1;var t=localStorage.getItem(this.TokenLocalStorageKey);t&&this.setAuth(t)}return Object(u.a)(e,[{key:"auth",value:function(){var e=Object(B.a)(U.a.mark(function e(t,n){var a=this;return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/auth"),{username:t,password:n}).then(function(e){var t=e.data.access_token;if(!t)throw new Error("No access_token in ".concat(e.data));a.setAuth(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setAuth",value:function(e){localStorage.setItem(this.TokenLocalStorageKey,e),this.isAuth=!0,this.axios=J.a.create({headers:{Authorization:"Bearer "+e}})}},{key:"unsetAuth",value:function(){localStorage.removeItem(this.TokenLocalStorageKey),this.isAuth=!0,this.axios=J.a.create()}},{key:"hasAuth",value:function(){return this.isAuth}},{key:"upsertBoard",value:function(){var e=Object(B.a)(U.a.mark(function e(t,n,a,r,o){var c;return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c={q:n,projections:o},a&&(c.limit=a),r&&(c.sort=r),e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/board/").concat(t),c));case 4:case"end":return e.stop()}},e,this)}));return function(t,n,a,r,o){return e.apply(this,arguments)}}()},{key:"getBoards",value:function(){var e=Object(B.a)(U.a.mark(function e(){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/boards")).then(function(e){return e.data}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getBoard",value:function(){var e=Object(B.a)(U.a.mark(function e(t){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/board/").concat(t)).then(function(e){return e.data}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"swapBoards",value:function(){var e=Object(B.a)(U.a.mark(function e(t,n){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/boards/swap/").concat(t,"/").concat(n)));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeBoard",value:function(){var e=Object(B.a)(U.a.mark(function e(t){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.delete("".concat(this.endpoint,"/apiInternal/board/").concat(t)));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderBoard",value:function(){var e=Object(B.a)(U.a.mark(function e(t){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/renderBoard/").concat(t)).then(function(e){return e.data}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"callbackBoard",value:function(){var e=Object(B.a)(U.a.mark(function e(t,n){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/callbackBoard/").concat(t),n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getWorkers",value:function(){var e=Object(B.a)(U.a.mark(function e(){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker")));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addWorker",value:function(){var e=Object(B.a)(U.a.mark(function e(t,n,a,r){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker"),{module:t,class_name:n,args:a,interval_seconds:r}));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"removeWorker",value:function(){var e=Object(B.a)(U.a.mark(function e(t){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.delete("".concat(this.endpoint,"/apiInternal/worker/").concat(t)));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateWorkerIntervalSeconds",value:function(){var e=Object(B.a)(U.a.mark(function e(t,n){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/intervalSeconds/").concat(n)));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getWorkerMetadata",value:function(){var e=Object(B.a)(U.a.mark(function e(t){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/metadata")));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setWorkerMetadata",value:function(){var e=Object(B.a)(U.a.mark(function e(t,n){return U.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/metadata"),n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function W(e){return e.displayName||e.name||"Component"}function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var Q=function(e){var t=function(t){Object(s.a)(a,t);var n=F(a);function a(e){var t;return Object(l.a)(this,a),(t=n.call(this,e)).apiClient=void 0,t.onSubmit=function(e){t.submit(),e.preventDefault()},t.apiClient=new L,t.state={username:"",password:""},t}return Object(u.a)(a,[{key:"submit",value:function(){var e=this.state,t=e.username,n=e.password;this.apiClient.auth(t,n).then()}},{key:"render",value:function(){var t=this;return this.apiClient.hasAuth()?r.a.createElement(e,Object.assign({apiClient:this.apiClient},this.props)):r.a.createElement("div",null,r.a.createElement("b",null,"Log in"),r.a.createElement("div",null,"Username:",r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:this.state.username,onChange:function(e){t.setState({username:e.target.value})}}),r.a.createElement("br",null),"Password:",r.a.createElement("br",null),r.a.createElement("input",{type:"password",value:this.state.password,onChange:function(e){t.setState({password:e.target.value})}}),r.a.createElement("br",null),r.a.createElement("button",{onClick:this.onSubmit},"Submit")))}}]),a}(r.a.Component);return t.displayName="applyAuth(".concat(W(e),")"),t};function V(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var z=function(e){var t=function(t){Object(s.a)(a,t);var n=V(a);function a(e){var t;return Object(l.a)(this,a),(t=n.call(this,e)).showOkMessage=function(e){t.setState({message:e,messageStatus:"ok"})},t.showErrorMessage=function(e){t.setState({message:e,messageStatus:"error"})},t.state={message:"",messageStatus:""},t}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(e,Object.assign({showOkMessage:this.showOkMessage,showErrorMessage:this.showErrorMessage},this.props)),this.state.message?r.a.createElement("div",{style:{color:"ok"===this.state.messageStatus?"black":"red"}},this.state.message):null)}}]),a}(r.a.Component);return t.displayName="applyMessage(".concat(W(e),")"),t};function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var H=function(e){var t=function(t){Object(s.a)(a,t);var n=K(a);function a(e){var t;return Object(l.a)(this,a),(t=n.call(this,e)).redirectTo=function(e){t.setState({redirectTo:e})},t.state={redirectTo:""},t}return Object(u.a)(a,[{key:"render",value:function(){return this.state.redirectTo?r.a.createElement(h.a,{to:this.state.redirectTo}):r.a.createElement(e,Object.assign({redirectTo:this.redirectTo},this.props))}}]),a}(r.a.Component);return t.displayName="applyRouting(".concat(W(e),")"),t};function $(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var G=function(e){Object(s.a)(n,e);var t=$(n);function n(e){var a;Object(l.a)(this,n),(a=t.call(this,e)).boardId="",a.isNewBoard=!0;var r=S.a.parse(a.props.location.search).name;return"string"===typeof r&&(a.boardId=r,a.isNewBoard=!1),a.state={loading:!a.isNewBoard,name:"",q:{},limit:0,sort:{},projections:[],newProjectionName:"",newProjectionModule:"",newProjectionClassName:"",newProjectionArgs:{},modalIsOpen:!1,modalIsEditing:"query"},a.onSubmit=a.onSubmit.bind(Object(g.a)(a)),a.onAddProjection=a.onAddProjection.bind(Object(g.a)(a)),a.onRemoveProjection=a.onRemoveProjection.bind(Object(g.a)(a)),a.onMoveUpProjection=a.onMoveUpProjection.bind(Object(g.a)(a)),a.onMoveDownProjection=a.onMoveDownProjection.bind(Object(g.a)(a)),a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.isNewBoard||this.props.apiClient.getBoard(this.boardId).then(function(t){e.setState({loading:!1,name:e.boardId,q:t.q,limit:t.limit?t.limit:0,sort:t.sort||{},projections:t.projections.map(function(e){return{name:e.name,module:e.module,className:e.class_name,args:e.args}})})}).catch(function(t){e.props.showErrorMessage(new Error("Fail to load mod view query from board id, error ".concat(t.toString())))})}},{key:"onSubmit",value:function(e){this.submit(),e.preventDefault()}},{key:"submit",value:function(){var e=this,t=this.state,n=t.name,a=t.q,r=t.limit,o=t.sort,c=t.projections;this.props.apiClient.upsertBoard(n,a,0!==r?r:void 0,o!=={}?o:void 0,c.map(function(e){return{name:e.name,module:e.module,class_name:e.className,args:e.args}})).then(function(){e.props.redirectTo("/boards/view")}).catch(function(t){e.props.showErrorMessage(new Error("Fail to submit, error ".concat(t.toString())))})}},{key:"onAddProjection",value:function(e){this.addProjection(),e.preventDefault()}},{key:"addProjection",value:function(){this.setState({projections:this.state.projections.concat([{name:this.state.newProjectionName,module:this.state.newProjectionModule,className:this.state.newProjectionClassName,args:this.state.newProjectionArgs}]),newProjectionName:"",newProjectionModule:"",newProjectionClassName:"",newProjectionArgs:{}})}},{key:"onRemoveProjection",value:function(e,t){this.removeProjection(t),e.preventDefault()}},{key:"removeProjection",value:function(e){this.setState(Object(E.a)({},this.state,{projections:this.state.projections.filter(function(t){return t.name!==e})}))}},{key:"onMoveUpProjection",value:function(e,t){this.moveUpProjection(t),e.preventDefault()}},{key:"moveUpProjection",value:function(e){var t=this.state.projections,n=[t[e],t[e-1]];t[e-1]=n[0],t[e]=n[1],this.setState(Object(E.a)({},this.state,{projections:t}))}},{key:"onMoveDownProjection",value:function(e,t){this.moveDownProjection(t),e.preventDefault()}},{key:"moveDownProjection",value:function(e){var t=this.state.projections,n=[t[e+1],t[e]];t[e]=n[0],t[e+1]=n[1],this.setState(Object(E.a)({},this.state,{projections:t}))}},{key:"render",value:function(){var e=this;return this.state.loading?r.a.createElement("div",null,"Loading..."):r.a.createElement("div",null,r.a.createElement("b",null,"Create new mod view"),r.a.createElement("div",null,"Name:",r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:this.state.name,onChange:function(t){return e.setState({name:t.target.value})}}),r.a.createElement("br",null),"Query:",r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){e.setState({modalIsOpen:!0,modalIsEditing:"query"})}},"Open JSON editor"),r.a.createElement("div",null,JSON.stringify(this.state.q)),"Limit (0 to unset):",r.a.createElement("br",null),r.a.createElement("input",{type:"number",value:this.state.limit,onChange:function(t){return e.setState({limit:parseInt(t.target.value,10)})}}),r.a.createElement("br",null),"Sort:",r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){e.setState({modalIsOpen:!0,modalIsEditing:"sort"})}},"Open JSON editor"),r.a.createElement("div",null,JSON.stringify(this.state.sort)),"Columns:",r.a.createElement("br",null),r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Module"),r.a.createElement("th",null,"Class Name"),r.a.createElement("th",null,"Args"),r.a.createElement("th",null))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("input",{type:"text",value:this.state.newProjectionName,onChange:function(t){return e.setState({newProjectionName:t.target.value})}})),r.a.createElement("td",null,r.a.createElement("input",{type:"text",size:63,value:this.state.newProjectionModule,onChange:function(t){return e.setState({newProjectionModule:t.target.value})}})),r.a.createElement("td",null,r.a.createElement("input",{type:"text",value:this.state.newProjectionClassName,onChange:function(t){return e.setState({newProjectionClassName:t.target.value})}})),r.a.createElement("td",null,r.a.createElement("button",{onClick:function(){e.setState({modalIsOpen:!0,modalIsEditing:"newProjectionArgs"})}},"Open JSON editor"),r.a.createElement("div",null,JSON.stringify(this.state.newProjectionArgs))),r.a.createElement("td",null,r.a.createElement("button",{onClick:function(t){return e.onAddProjection(t)}},"+"))),this.state.projections.map(function(t,n){var a=t.name,o=t.module,c=t.className,i=t.args;return r.a.createElement("tr",{key:a},r.a.createElement("td",null,a),r.a.createElement("td",null,o),r.a.createElement("td",null,c),r.a.createElement("td",null,JSON.stringify(i)),r.a.createElement("td",null,0!==n?r.a.createElement("button",{onClick:function(t){e.onMoveUpProjection(t,n)}},"\u2191"):null,n!==e.state.projections.length-1?r.a.createElement("button",{onClick:function(t){e.onMoveDownProjection(t,n)}},"\u2193"):null,r.a.createElement("button",{onClick:function(t){return e.onRemoveProjection(t,a)}},"-")))}))),r.a.createElement("button",{onClick:this.onSubmit},"Submit")),r.a.createElement(R,{value:"query"===this.state.modalIsEditing?this.state.q:"sort"===this.state.modalIsEditing?this.state.sort:"newProjectionArgs"===this.state.modalIsEditing?this.state.newProjectionArgs:{},onValueChange:function(t){"query"===e.state.modalIsEditing?e.setState({q:t}):"sort"===e.state.modalIsEditing?e.setState({sort:t}):"newProjectionArgs"===e.state.modalIsEditing&&e.setState({newProjectionArgs:t})},onClose:function(){e.setState({modalIsOpen:!1})},isOpen:this.state.modalIsOpen}))}}]),n}(r.a.Component),X=Q(H(z(Object(j.a)(G)))),Y=new Set(["button"]),Z=function(e){var t=e.data,n=e.callbackId,a=e.rawDocument,o=e.apiClient,c=e.reload,i=e.getRawDocument;if(void 0===a&&void 0===i)return r.a.createElement("div",null,"Neither rawDocument nor getRawDocument");var l=t.text,u=t.reload_after_callback;return r.a.createElement("button",{onClick:function(){var e;e=void 0!==i?i():[a],Promise.all(e.map(function(e){return o.callbackBoard(n,e)})).catch(function(e){}).finally(function(){u&&c()})}},l)},ee=function(e){var t=e.data.url;return r.a.createElement("img",{src:t,alt:t,style:{objectFit:"scale-down",width:"100%",height:"100%"}})},te=function(e){var t=e.data;return r.a.createElement("div",null,t.urls.map(function(e){return r.a.createElement(ee,{data:{url:e}})}))},ne=function(e){var t=e.data.text;return function(e){try{new URL(e)}catch(t){return!1}return!0}(t)?r.a.createElement("a",{href:t},t):r.a.createElement("p",null,t)},ae=function(e){var t=e.data.url;return r.a.createElement("video",{controls:!0,style:{objectFit:"scale-down",width:"100%",height:"100%"}},r.a.createElement("source",{src:t,type:"video/mp4"}))},re=function(e){return r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},e.children)},oe=function(e){return r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},e.children)},ce=function(e){var t=void 0!==e.hidden&&e.hidden?"none":"flex";return r.a.createElement("div",{style:{display:t,width:"".concat(e.widthPx,"px"),justifyContent:"center"}},e.text)},ie=function(e){var t=void 0!==e.hidden&&e.hidden?"none":"flex";return r.a.createElement("div",{style:{display:t,width:"".concat(e.widthPx,"px"),height:"400px",justifyContent:"center",alignItems:"center"}},e.children)};function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var ue=function(e){Object(s.a)(n,e);var t=le(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).boardId=void 0,a.loadQuery=function(){a.setState(n.InitialState),a.props.apiClient.renderBoard(a.boardId).then(function(e){a.setState({boardRender:e})}).catch(function(e){a.props.showErrorMessage(new Error("Fail to load mod view, error ".concat(e.toString())))}).finally(function(){a.setState({loading:!1})})},a.renderColumn=function(e,t,n,o,c){var i;return"text"===e?i=ne:"image"===e?i=ee:"image_list"===e?i=te:"button"===e?i=Z:"video"===e&&(i=ae),i?r.a.createElement(i,{data:t,callbackId:o,rawDocument:n,getRawDocument:c,apiClient:a.props.apiClient,reload:a.loadQuery}):r.a.createElement("div",null,"`Unknown column type $",e,"`")},a.getColumnWidthPx=function(e){return"text"===e?400:"image"===e?400:"image_list"===e?400:"button"===e?100:"video"===e?400:100},a.onToggleRowMultiAction=function(e){var t=new Set(a.state.multiActionSelectedIndexes.values());if(t.has(e))t.delete(e);else{t.add(e);var n=a.state.multiActionLastSelectedIndex;if(a.state.holdingShift&&-1!==n&&n<e)for(var r=n;r<e+1;r++)t.add(r);a.setState({multiActionLastSelectedIndex:e})}a.setState({multiActionSelectedIndexes:t})},a.renderRow=function(e,t,n){var o=t.renders;return r.a.createElement(oe,{key:n},r.a.createElement(ie,{hidden:!a.state.multiActionOn,key:"multi-action-selected",widthPx:50},r.a.createElement("input",{type:"checkbox",checked:a.state.multiActionSelectedIndexes.has(n),onChange:function(){a.onToggleRowMultiAction(n)}})),e.map(function(e){var n,c=o[e];return n=c?a.renderColumn(c.type,c.data,t.raw_document,c.callback_id):r.a.createElement("div",null,"N/A"),r.a.createElement(ie,{key:e,widthPx:a.getColumnWidthPx(c.type)},n)}))},a.renderPayload=function(){var e=a.state.boardRender,t=e.payload;if(!t||0===t.length)return r.a.createElement("div",null,"Query is empty");var n=a.state.boardRender.board_query.projections.map(function(e){return e.name});return r.a.createElement("div",null,r.a.createElement("div",null,"Query count: ",e.count_without_limit),r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",id:"toggleMultiAction",onClick:a.onToggleMultiAction}),r.a.createElement("label",{htmlFor:"toggleMultiAction"},"Toggle multi-action")),r.a.createElement("div",{hidden:!a.state.multiActionOn},"Multi-action: selected ",a.state.multiActionSelectedIndexes.size," items",a.renderRangeSelectPrompt(),a.renderMultiActions()),r.a.createElement(re,null,r.a.createElement(oe,null,r.a.createElement(ce,{key:"multi-action-selected",text:"Multi-action selected",hidden:!a.state.multiActionOn,widthPx:50}),n.map(function(e){return r.a.createElement(ce,{key:e,text:e,widthPx:a.getColumnWidthPx(t[0].renders[e].type)})})),t.map(function(e,t){return a.renderRow(n,e,t)})))},a.onToggleMultiAction=function(){a.setState({multiActionOn:!a.state.multiActionOn})},a.renderRangeSelectPrompt=function(){return a.state.holdingShift?r.a.createElement("div",null,"Range selecting"):r.a.createElement("div",null,'Hold "shift" to range select')},a.renderMultiActions=function(){var e=a.state.boardRender,t=e.payload;if(0===t.length)return r.a.createElement("div",null,"No multi-action to render");var n=t[0].renders,o=e.board_query.projections.map(function(e){return e.name}),c=o.map(function(e){return r.a.createElement("th",{key:e},e)}),i=o.map(function(e){var o,c=n[e];return o=c?Y.has(c.type)?a.renderColumn(c.type,c.data,void 0,c.callback_id,function(){return Array.from(a.state.multiActionSelectedIndexes).map(function(e){return t[e].raw_document})}):r.a.createElement("div",null,"Not action-able"):r.a.createElement("div",null,"N/A"),r.a.createElement("td",{key:e},o)});return r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,c)),r.a.createElement("tbody",null,r.a.createElement("tr",null,i)))},a.keyDown=function(e){16===e.keyCode&&a.state.multiActionOn&&a.setState({holdingShift:!0})},a.keyUp=function(e){16===e.keyCode&&a.state.multiActionOn&&a.setState({holdingShift:!1})},a.boardId=decodeURIComponent(a.props.match.params.name),a.state=n.InitialState,a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.loadQuery()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)}},{key:"render",value:function(){if(this.state.loading)return r.a.createElement("div",null,"Loading mod view...");var e=this.state.boardRender;return r.a.createElement("div",null,r.a.createElement("b",null,'Mod view "',this.boardId,'"'),r.a.createElement("div",null,"Query: ",e.board_query.q),r.a.createElement("div",null,"Limit: ",e.board_query.limit?e.board_query.limit:"N/A"),r.a.createElement("div",null,"Sort: ",e.board_query.sort?JSON.stringify(e.board_query.sort):"N/A"),this.renderPayload())}}]),n}(r.a.Component);ue.InitialState={loading:!0,boardRender:{},multiActionOn:!1,multiActionSelectedIndexes:new Set,multiActionLastSelectedIndex:-1,holdingShift:!1};var se=Object(j.a)(ue);function de(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}var me=function(e){Object(s.a)(n,e);var t=de(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).workerId=a.props.match.params.workerId,a.state={loading:!0,metadataStr:"[]"},a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getWorkerMetadata(this.workerId).then(function(t){e.setState({metadataStr:JSON.stringify(t.data)})}).catch(function(t){e.props.showErrorMessage(t.toString())}).finally(function(){e.setState({loading:!1})})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("b",null,"Worker ",this.workerId),r.a.createElement("br",null),"Metadata:",r.a.createElement("br",null),r.a.createElement("textarea",{cols:"30",rows:"5",style:{resize:"none"},value:this.state.metadataStr,onChange:function(t){e.setState({metadataStr:t.target.value})}}),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){e.props.apiClient.setWorkerMetadata(e.workerId,JSON.parse(e.state.metadataStr)).then(function(){e.props.showOkMessage("Metadata for ".concat(e.workerId," set"))}).catch(function(t){e.props.showErrorMessage(t.toString())})}},"Submit"))}}]),n}(a.Component),pe=Object(j.a)(me);function fe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(m.a)(e);if(t){var r=Object(m.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(d.a)(this,n)}}function he(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];for(var r=0,o=n;r<o.length;r++){e=(0,o[r])(e)}return e}var ve=function(e){Object(s.a)(n,e);var t=fe(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).apiClient=new L,a}return Object(u.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("img",{src:y.a,alt:"Broccoli logo",height:"16",width:"16"})," Broccoli"," | ",r.a.createElement(p.a,{to:"/boards/view"},"View mod views")," | ",r.a.createElement(p.a,{to:"/boards/upsert"},"Create new mod view")," | ",r.a.createElement(p.a,{to:"/workers/view"},"View workers")," | ",r.a.createElement(p.a,{to:"/workers/create"},"Create new worker")," | ",r.a.createElement("button",{onClick:function(t){e.apiClient.unsetAuth(),t.preventDefault()}},"Logout")),r.a.createElement(f.a,null,r.a.createElement(h.a,{exact:!0,from:"/",to:"/boards/view"}),r.a.createElement(v.a,{exact:!0,path:"/boards/view",component:function(){var e=he(_,z,H,Q);return r.a.createElement(e,null)}}),r.a.createElement(v.a,{exact:!0,path:"/boards/upsert",component:X}),r.a.createElement(v.a,{exact:!0,path:"/board/:name",component:function(){var e=he(se,z,Q);return r.a.createElement(e,null)}}),r.a.createElement(v.a,{exact:!0,path:"/workers/view",component:function(){var e=he(k,z,H,Q);return r.a.createElement(e,null)}}),r.a.createElement(v.a,{exact:!0,path:"/workers/create",component:function(){var e=he(D,z,H,Q);return r.a.createElement(e,null)}}),r.a.createElement(v.a,{exact:!0,path:"/worker/:workerId",component:function(){var e=he(pe,z,Q);return r.a.createElement(e,null)}})))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(i.a,{basename:"/web"},r.a.createElement(ve,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[37,2,1]]]);
//# sourceMappingURL=main.7d1e9a08.chunk.js.map