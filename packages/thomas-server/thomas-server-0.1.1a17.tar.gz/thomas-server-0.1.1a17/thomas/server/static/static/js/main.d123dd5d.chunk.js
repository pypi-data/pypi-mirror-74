(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{145:function(e,t,n){},146:function(e,t,n){},147:function(e,t,n){},148:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(58),i=n.n(o),s=n(19),c=n(6),u=(n(68),n(10)),l=n(11),h=n(13),d=n(12),p=(n(69),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"About"},"This is the about component.")}}]),n}(r.Component)),f=(n(70),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"Footer"},"Copyright \xa9 2020 Melle Sieswerda. All rights reserved.")}}]),n}(r.Component)),m=(n(71),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(u.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).onChange=function(t){var n=t.target.value;e.props.onNetworkSelected(n)},e}return Object(l.a)(n,[{key:"renderOptions",value:function(){return this.props.networks.map((function(e){return a.a.createElement("option",{key:e.id,value:e.id},e.name)}))}},{key:"render",value:function(){var e=this.props.network_id;return a.a.createElement("div",{className:"Header"},a.a.createElement("div",{className:"top"},a.a.createElement("div",{className:"left"},a.a.createElement("span",{className:"h1"},a.a.createElement(s.b,{to:"/",className:"main"},"Thomas")),"\xa0 A Bayesian Network viewer."),a.a.createElement("div",{className:"right"},a.a.createElement("a",{href:"https://github.com/mellesies/thomas-master",target:"_blank",rel:"noopener noreferrer"},"Github"))),a.a.createElement("select",{onChange:this.onChange,value:e||""},a.a.createElement("option",{disabled:!0,value:""}," -- select Bayesian network -- "),this.renderOptions()))}}]),n}(r.Component)),v=n(62),g=n(36),k=n(18),y=n(9),b=n(60),w=n.n(b),E=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(u.a)(this,n),(r=t.call(this,e)).onDragMove=function(e){var t=e.target.x(),n=e.target.y();r.setPosition(t,n),r.props.onDragMove&&r.props.onDragMove(r.RV,t,n)},r.onDragEnd=function(e){var t=e.target.x(),n=e.target.y();r.props.onDragEnd&&r.props.onDragEnd(r.RV,t,n)},r.onStateToggled=function(e){r.props.onStateToggled&&r.props.onStateToggled(r.RV,e)},r.RV=e.node.RV,r.titleHeight=15,r.stateOffset=8,r.stateHeight=14,r.statePadding=2,r.width=180,r.height=r.computeHeight();var a=e.node.position[0],o=e.node.position[1];return r.setPosition(a,o),r}return Object(l.a)(n,[{key:"createStates",value:function(e,t,n){var r=this,o=this.width,i=o-70-55;return e.states.map((function(e,s){var c=r.titleHeight+r.stateOffset+s*r.stateHeight,u="...",l=0,h="#003366";return n&&n===e&&(h="#00BCCC"),t&&(u=(100*t[e]).toFixed(2)+"%",l=1+i*t[e]),a.a.createElement(y.Group,{key:e,y:c,onDblClick:function(t){return r.onStateToggled(e)}},a.a.createElement(y.Label,null,a.a.createElement(y.Tag,null),a.a.createElement(y.Text,{text:e,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,wrap:"none",ellipsis:"ellipsis",width:70})),a.a.createElement(y.Rect,{x:70,y:1,width:l,height:r.stateHeight-2,fill:h}),a.a.createElement(y.Label,{x:o-55},a.a.createElement(y.Tag,null),a.a.createElement(y.Text,{text:u,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,align:"right",wrap:"none",width:55})))}))}},{key:"computeHeight",value:function(){return this.props.node.states.length*this.stateHeight+2*this.stateOffset+this.titleHeight}},{key:"setPosition",value:function(e,t){var n=this.width,r=this.height;this.x=e,this.y=t,this.center={x:e+n/2,y:t+r/2},this.corners={tl:{x:e,y:t},tr:{x:e+n,y:t},bl:{x:e,y:t+r},br:{x:e+n,y:t+r}}}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.query,r=e.probabilities,o=this.x,i=this.y,s=this.width,c=this.height,u=this.createStates(t,r,n);return a.a.createElement(y.Group,{x:o,y:i,width:s,height:c,onDragMove:this.onDragMove,onDragEnd:this.onDragEnd,draggable:!0},a.a.createElement(y.Rect,{fill:"#efefef",width:s,height:c,cornerRadius:5,shadowBlur:5}),a.a.createElement(y.Label,null,a.a.createElement(y.Tag,null),a.a.createElement(y.Text,{text:t.name,padding:4,fontSize:this.titleHeight,fontStyle:"bold",width:s})),u)}}]),n}(r.Component),O=n(25),_=n(26),S=n.n(_),j=n(61),N=n.n(j),T=new(function(){function e(){Object(u.a)(this,e),this._axios=null,this._user=!1}return Object(l.a)(e,[{key:"init",value:function(e){var t=this;this._config=Object(k.a)({withCredentials:!0},e),this._axios=S.a.create(e),this._axios.interceptors.request.use((function(e){return e.headers.Authorization="Bearer "+localStorage.getItem("access_token"),e})),N()(this._axios,(function(e){return t.refreshAuthLogic(e)})),this.request=this._axios.request}},{key:"refreshAuthLogic",value:function(e){S.a.create(this._conifg).post("/token/refresh").then((function(t){var n,r=t.data.access_token;return n=r,localStorage.setItem("access_token",n),e.response.config.headers.Authorization="Bearer ".concat(r),Promise.resolve()}))}},{key:"_request",value:function(e){return console.log("Api::request()",e),this._axios.request(e).then((function(e){return e.data}))}},{key:"getVersion",value:function(){return this._request({url:"/version",method:"GET"})}},{key:"getSession",value:function(){return this._request({url:"/session",method:"GET",withCredentials:!0})}},{key:"getNetworks",value:function(){return console.log("Api::getNetworks()"),this._request({url:"/network",method:"GET"})}},{key:"getNetwork",value:function(e){return this._request({url:"/network/".concat(e),method:"GET"})}},{key:"saveNetwork",value:function(e,t){return this._request({url:"/network/".concat(e),method:"POST",data:t})}},{key:"queryNetwork",value:function(e,t){var n={id:e,query:Object(k.a)({},t)};return this._request({url:"/network/_query",data:n,method:"POST"})}}]),e}());n(145);function x(e){var t=e.src,n=e.dst;return a.a.createElement(y.Arrow,{x:0,y:0,points:[t.x,t.y,n.x,n.y],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:2})}function C(e){return e.nodes.map((function(e){return e.RV}))}function R(e,t,n,r,a,o,i,s){if(e===n&&t===r||a===i&&o===s)return console.warn("Found line of length 0"),!1;var c=(s-o)*(n-e)-(i-a)*(r-t);if(0===c)return console.warn("Denominator is zero 0"),!1;var u=((i-a)*(t-o)-(s-o)*(e-a))/c,l=((n-e)*(t-o)-(r-t)*(e-a))/c;return!(u<0||u>1||l<0||l>1)&&{x:e+u*(n-e),y:t+u*(r-t)}}function P(e,t){for(var n=!1,r=0,a=[["tl","tr"],["tl","bl"],["tr","br"],["bl","br"]];r<a.length;r++){var o=a[r],i=o[0],s=o[1];if(n=R(e[i].x,e[i].y,e[s].x,e[s].y,t.src.x,t.src.y,t.dst.x,t.dst.y))break}return n||console.warn("Could not determine intersection"),n}var q=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).onNodeMove=function(e,t,n){r.nodeAttrsToState()},r.onNodeMoved=function(e,t,n){var a,o=Object(k.a)({},r.state.network),i=r.props.network_id,s=Object(g.a)(o.nodes);try{for(s.s();!(a=s.n()).done;){var c=a.value;if(c.RV===e){c.position=[t,n];break}}}catch(u){s.e(u)}finally{s.f()}T.saveNetwork(i,o)},r.onStateToggled=function(e,t){var n=Object(k.a)({},r.state.query);n[e]&&n[e]===t?delete n[e]:n[e]=t,r.props.history.push({pathname:"",search:"?"+new URLSearchParams(Object(k.a)({},n)).toString()})},r.state={network:null,first_pass_complete:!1,node_centers:{},node_corners:{},query:{},probabilities:{}},r.myRefs={},r}return Object(l.a)(n,[{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"componentDidMount",value:function(){var e=this;this.unlisten=this.props.history.listen((function(t,n){console.log("on route change"),e.updateFromQueryParameters()})),this.setNetwork()}},{key:"componentDidUpdate",value:function(){var e=this.state,t=e.network,n=e.first_pass_complete;t&&!n&&(this.nodeAttrsToState(),this.updateFromQueryParameters())}},{key:"updateFromQueryParameters",value:function(){for(var e,t,n=w.a.parse(this.props.location.search,{ignoreQueryPrefix:!0}),r=this.state.network,a=(e=r.nodes,t="RV",e.reduce((function(e,n){return Object(k.a)(Object(k.a)({},e),{},Object(O.a)({},n[t],n))}),{})),o={},i=0,s=Object.entries(a);i<s.length;i++){var c=Object(v.a)(s[i],2),u=c[0],l=c[1];n[u]&&l.states.includes(n[u])&&(o[u]=n[u])}this.query(o)}},{key:"setNetwork",value:function(){var e=this,t=this.props.network_id;T.getNetwork(t).then((function(n){var r=n.json;r.id=t,e.setState({network:r})}))}},{key:"query",value:function(e){var t=this,n=this.state.network.id;T.queryNetwork(n,e).then((function(e){t.setState({query:e.query,probabilities:e.probabilities})}))}},{key:"nodeAttrsToState",value:function(){var e,t=C(this.state.network),n={},r={},a=Object(g.a)(t);try{for(a.s();!(e=a.n()).done;){var o=e.value,i=this.myRefs[o].current;n[o]=i.center,r[o]=i.corners}}catch(s){a.e(s)}finally{a.f()}this.setState({first_pass_complete:!0,node_centers:n,node_corners:r})}},{key:"computeEdge",value:function(e,t){var n=this.state,r=n.node_centers,a=n.node_corners,o=r[e],i=r[t],s=a[e],c=a[t];return{src:P(s,{src:o,dst:i}),dst:P(c,{src:o,dst:i})}}},{key:"renderEdges",value:function(){var e=this;return this.state.network.edges.map((function(t){var n=t[0],r=t[1],o=e.computeEdge(n,r),i=o.src,s=o.dst;return a.a.createElement(x,{key:"".concat(n,"_").concat(r),src:i,dst:s})}))}},{key:"renderLoading",value:function(){return a.a.createElement("div",{className:"Network"},a.a.createElement("span",null,"Loading ..."))}},{key:"render",value:function(){var e=this,t=this.state.network;if(!t)return this.renderLoading();var n=this.state,r=n.first_pass_complete,o=n.query,i=n.probabilities,s=this.myRefs,c=C(t),u=t.nodes.reduce((function(e,t){return e[t.RV]=t,e}),{});return a.a.createElement("div",{className:"Network"},a.a.createElement("div",{className:"KonvaContainer"},a.a.createElement(y.Stage,{width:2042,height:1024},a.a.createElement(y.Layer,null,r&&this.renderEdges(),c.map((function(t){return s[t]=a.a.createRef(),a.a.createElement(E,{ref:s[t],key:t,node:u[t],query:o[t],probabilities:i[t],onDragMove:e.onNodeMove,onDragEnd:e.onNodeMoved,onStateToggled:e.onStateToggled})}))))))}}]),n}(r.Component),D=(n(146),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).onNetworkSelected=function(e){r.props.history.push({pathname:"/network/".concat(e),search:""})},r.state={networks:[]},r}return Object(l.a)(n,[{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"componentDidMount",value:function(){var e=this;T.getNetworks().then((function(t){t.length>0&&e.setState({networks:t})})),this.unlisten=this.props.history.listen((function(e,t){console.log("on route change")}))}},{key:"render",value:function(){var e=this.state.networks,t=this.props.match.params.network_id;return a.a.createElement("div",{className:"Main"},a.a.createElement(m,Object.assign({networks:e,network_id:t,onNetworkSelected:this.onNetworkSelected},this.props)),t&&a.a.createElement(q,Object.assign({key:t,network_id:t},this.props)),!t&&a.a.createElement("div",{className:"centered"},a.a.createElement("div",null,a.a.createElement("h2",null,"Select a Bayesian network to continue:")),a.a.createElement("div",null,e.map((function(e){return a.a.createElement(s.b,{key:e.id,to:"/network/"+e.id,className:"block"},e.name)})))))}}]),n}(r.Component)),A=(n(147),function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(c.d,null,a.a.createElement(c.b,{path:"/about"},a.a.createElement(p,null)),a.a.createElement(c.b,{path:["/network/:network_id","/network"],component:D}),a.a.createElement(c.b,{exact:!0,path:"/"},a.a.createElement(c.a,{to:"/network"}))),a.a.createElement(f,null))}}]),n}(r.Component)),L={baseURL:""};Object({NODE_ENV:"production",PUBLIC_URL:"/static",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_BASEURL&&(L.baseURL=Object({NODE_ENV:"production",PUBLIC_URL:"/static",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_BASEURL);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));T.init(L),i.a.render(a.a.createElement(s.a,{basename:"/app"},a.a.createElement(c.d,null,a.a.createElement(c.b,{path:"/",component:A}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},63:function(e,t,n){e.exports=n(148)},68:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){}},[[63,1,2]]]);
//# sourceMappingURL=main.d123dd5d.chunk.js.map