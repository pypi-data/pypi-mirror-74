Metadata-Version: 2.1
Name: ai-transformersx
Version: 0.6.17
Summary: tools for using huggingface/transformers more easily
Home-page: https://github.com/aicanhelp/ai-transformers
Author: modongsong
Author-email: modongsongml@163.com
License: MIT
Project-URL: Bug Reports, https://github.com/aicanhelp/ai-transformersx/issues
Project-URL: Source, https://github.com/aicanhelp/ai-transformers/
Keywords: deeplearning tools development
Platform: UNKNOWN
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: Topic :: Software Development :: Build Tools
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3.5
Classifier: Programming Language :: Python :: 3.6
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Requires-Python: >=3.5, <4
Description-Content-Type: text/markdown
Provides-Extra: dev
Requires-Dist: check-manifest ; extra == 'dev'
Provides-Extra: test
Requires-Dist: coverage ; extra == 'test'
Requires-Dist: pytest ; extra == 'test'

# Transformersx

##ä»‹ç»  
[ðŸ¤— Transformers](https://github.com/huggingface/transformers) æ˜¯ä¸€ä¸ªéžå¸¸å¥½ç”¨çš„ä¸“é—¨é’ˆå¯¹åŸºäºŽPytorchçš„Transformerç›¸å…³NLPæ·±åº¦å­¦ä¹ æ¨¡åž‹çš„å·¥å…·åº“ã€‚
å®ƒç®¡ç†å’Œå½’ç±»äº†å½“å‰å‡ ä¹Žæ‰€æœ‰çš„æœ€å¥½çš„åŸºäºŽçš„Transformerçš„è‡ªç„¶è¯­è¨€æ¨¡åž‹ä»¥åŠå…¬å¼€çš„é¢„è®­ç»ƒæ¨¡åž‹ï¼Œå¹¶éƒ½è½¬æ¢æˆäº†Pytorchã€‚
ï¼ˆ1ï¼‰ä½¿ç”¨å®ƒä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„åšBert/Albert/GPT2/XLNETç­‰å½“å‰æœ€å¥½çš„è‡ªç„¶è¯­è¨€é¢„è®­ç»ƒæ¨¡åž‹è®­ç»ƒä»¥åŠä¸‹æ¸¸ä»»åŠ¡çš„æ¨¡åž‹å¼€å‘å’Œè®­ç»ƒã€‚
ï¼ˆ2ï¼‰ä½¿ç”¨Pytorchå®žçŽ°çš„æ¨¡åž‹æœ‰æ›´æ¸…æ™°çš„ä»£ç æœºæž„ï¼Œå¯¹å­¦ä¹ è€…æ¥è¯´ï¼Œå­¦ä¹ å’Œç†è§£è¿™äº›è‡ªç„¶è¯­è¨€æ›´ä¸ºå®¹æ˜“ã€‚
ï¼ˆ3ï¼‰æä¾›äº†ä¸€ä¸ªåœ°æ–¹æ”¶é›†å’Œå­˜æ”¾å…¬å¼€çš„è‡ªç„¶è¯­è¨€é¢„è®­ç»ƒæ¨¡åž‹ï¼Œä¾›ç ”ç©¶äººå‘˜ä½¿ç”¨ã€‚ç ”ç©¶äººå‘˜ä¹Ÿå¯ä»¥æŠŠè‡ªå·±æ„¿æ„å…¬å¼€çš„é¢„è®­ç»ƒæ¨¡åž‹æ”¾åˆ°Transformerä¸Šä¾›åˆ«äººç ”ç©¶ä½¿ç”¨ã€‚

ä½†æ˜¯Transformersä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼š
ï¼ˆ1ï¼‰æ ¹æ®å½“å‰çš„Transformersçš„å®žçŽ°çœ‹ï¼Œæ‰€æœ‰çš„å…¬å¼€çš„Transformerçš„é¢„è®­ç»ƒæ¨¡åž‹éƒ½æ˜¯å­˜æ”¾åœ¨AWSçš„S3ä¸Šã€‚å¯¹å›½å¤–çš„ç ”ç©¶äººå‘˜é‚£æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä¸­å›½çš„ç ”ç©¶äººå‘˜éœ€è¦ä¸‹è½½è¿™äº›æ¨¡åž‹
å°±æœ‰ç‚¹è´¹å‘¨æŠ˜äº†ã€‚å½“å‰Transformersçš„æ¨¡åž‹ä¸‹è½½æ–¹å¼æœ‰ä¸¤ç§ï¼šï¼ˆ1ï¼‰é€šè¿‡ä»£ç è°ƒç”¨æŒ‡å®šæ¨¡åž‹æ—¶ï¼Œè‡ªåŠ¨åŽ»ç›¸åº”çš„S3ä¸Šä¸‹è½½ã€‚ï¼ˆ2ï¼‰ç›´æŽ¥åˆ°Transformersçš„ç½‘ä¸Šæµé‡ç›¸åº”çš„æ¨¡åž‹æ–‡ä»¶é€šè¿‡æµè§ˆå™¨ä¸‹è½½ã€‚
åæ­£ä¸ç®¡é‚£ç§æ–¹å¼ï¼Œæƒ³é¡ºåˆ©çš„ä¸‹è½½ä¸‹æ¥ï¼Œè‡ªå·±æƒ³åŠžæ³•å§ï½žã€‚ä¸å¤šè¯´ã€‚
ï¼ˆ2ï¼‰å°½ç®¡Transformerså·²ç»æä¾›äº†ä¸€ç§æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹å¼æ¥ä½¿ç”¨å„ç§Transformerç›¸å…³æ¨¡åž‹äº†ã€‚ä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿå¥½ã€‚é¦–å…ˆï¼Œä»Žè®¾è®¡ä¸Šï¼Œå„ç§æ¨¡åž‹çš„å®žçŽ°å¾ˆä¸é”™ï¼Œä½†æ˜¯å› ä¸ºæ¨¡åž‹çš„å®žçŽ°ä¸Žæ¨¡åž‹çš„å­˜å‚¨å’Œä¸‹è½½æ·±åº¦ç»‘å®šã€‚
è¿™ä¸ªè®¾è®¡åº”è¯¥æ˜¯æœ‰é—®é¢˜çš„ã€‚ä»ŽèŒè´£ä¸Šè¯´ï¼Œæ¨¡åž‹çš„å®žçŽ°å’Œæ¨¡åž‹çš„å­˜å‚¨ä¸‹è½½åº”è¯¥åˆ†ç¦»ã€‚
ï¼ˆ3ï¼‰Transformerså¢žåŠ äº†ä¸€ä¸ªTrainerä»¥æ–¹ä¾¿ç ”ç©¶äººå‘˜è®­ç»ƒTransformeræ¨¡åž‹ä½¿ç”¨ã€‚åŒæ ·ï¼Œè¿™ä¸ªTrainerçš„è®¾è®¡å’Œå®žçŽ°æ°´å¹³è·Ÿæ¨¡åž‹çš„è®¾è®¡å’Œå®žçŽ°ä¹Ÿä¸€æ ·æœ‰ä¸å°‘çš„å·®è·ã€‚

## ç›®çš„  
æœ¬é¡¹ç›®çš„ç›®çš„æ˜¯æƒ³é’ˆå¯¹Transformersçš„ä¸€äº›é—®é¢˜ï¼Œå¯¹Transformersåšè¿›ä¸€æ­¥çš„æ‰©å±•ï¼Œè®©ç ”ç©¶äººå‘˜ä½¿ç”¨Transformersæ›´æ–¹ä¾¿ã€‚å½“ç„¶ä¹Ÿæ²¡æœ‰è§£å†³ä¸Šé¢æåˆ°çš„æ‰€æœ‰é—®é¢˜ã€‚
### ï¼ˆ1ï¼‰é¦–å…ˆï¼Œé’ˆå¯¹ä¸‹è½½è¿™ä¸ªé—®é¢˜ã€‚  
æœ¬é¡¹ç›®çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œåœ¨dockerç›®å½•ä¸­æä¾›äº†å‡ ç§ç”¨äºŽTransformersç›¸å…³æ¨¡åž‹çš„è®­ç»ƒå’Œè¿è¡ŒçŽ¯å¢ƒçš„Dockerå®šä¹‰ï¼Œ
åˆ©ç”¨é˜¿é‡Œäº‘çš„Dockeræµ·å¤–æž„å»ºæœºå™¨ï¼Œåœ¨æž„å»ºDockeræ˜¯é¡ºä¾¿æŠŠæŒ‡å®šçš„é¢„è®­ç»ƒæ¨¡åž‹ä¸‹è½½ä¸‹æ¥ã€‚å½“å‰ä¸»è¦æ˜¯ä¸­æ–‡è¯­è¨€æ¨¡åž‹ï¼ŒåŒ…æ‹¬bertã€albertã€robertã€electraã€‚å¯ä»¥ç›´æŽ¥ä»Žé˜¿é‡Œäº‘é•œåƒåº“èŽ·å–ã€‚
ç›¸å…³æ¨¡åž‹æ”¾åœ¨é•œåƒçš„/app/modelsç›®å½•ä¸‹é¢ã€‚
```
docker pull registry.cn-beijing.aliyuncs.com/modoso/transformersx-bert
docker pull registry.cn-beijing.aliyuncs.com/modoso/transformersx-albert
docker pull registry.cn-beijing.aliyuncs.com/modoso/transformersx-robert
docker pull registry.cn-beijing.aliyuncs.com/modoso/transformersx-electra
```
æœ€å¥½ä½¿ç”¨è„šæœ¬download-models.sh ä¸‹è½½å¹¶ä»Žé•œåƒä¸­æŠŠæ¨¡åž‹copyå‡ºæ¥çš„è„šæœ¬ã€‚
```
sh download-models.sh [æŒ‡å®šæ¨¡åž‹å­˜æ”¾ç›®å½•]
```
### ï¼ˆ2ï¼‰ä¸ºäº†æ›´æ–¹ä¾¿çš„ä½¿ç”¨ï¼Œ(å½“ç„¶ï¼Œä½ å¾—å…ˆå‚ç…§ä¸Šé¢çš„æ¨¡åž‹ä¸‹è½½æ–¹å¼ä¸‹è½½dockeré•œåƒæˆ–è€…æ¨¡åž‹)
é¦–å…ˆï¼Œä½ å¯ä»¥ç®€å•çš„åƒexamples.task.sentiment.sentiment_taské‚£æ ·å®žçŽ°æƒ…æ„Ÿè¯†åˆ«ï¼Œåªéœ€è¦å®žçŽ°ä¸€ä¸ªDataProcessorå’Œä¸€ä¸ªTask

```python
from ai_transformersx import DataProcessor,DataArguments,join_path,InputExample,log,TaskArguments
from ai_transformersx.examples import ExampleTaskBase
import pandas as pd
class SentimentDataProcessor(DataProcessor):
    def __init__(self, config: DataArguments):
        self._config = config

    def _get_example(self, file_name, type):
        pd_all = pd.read_csv(join_path(self._config.data_dir, file_name))

        log.info("Read data from {}, length={}".format(join_path(self._config.data_dir, file_name), len(pd_all)))
        examples = []
        for i, d in enumerate(pd_all.values):
            examples.append(InputExample(guid=type + '_' + str(i),
                                         text_a=d[1],
                                         label=str(d[0])))

        return examples

    def get_train_examples(self):
        return self._get_example('train.csv', 'train')

    def get_dev_examples(self):
        return self._get_example('dev.csv', 'dev')

    def get_labels(self):
        return ['0', '1', '2', '3']

    def data_dir(self):
        return self._config.data_dir


class SentimentTask(ExampleTaskBase):
    def __init__(self, taskArgs: TaskArguments = None):
        super().__init__('sentiment', taskArgs)
        self.task_args.model_args.num_labels = 4

    def _data_processor(self):
        return SentimentDataProcessor(self.task_args.data_args)
```
ç„¶åŽï¼Œåƒexamples.task.mainé‚£æ ·å®žçŽ°å¯åŠ¨æ–¹æ³•ï¼š
```python
from ai_transformersx.examples import ExampleManagement
from ai_transformersx.examples.tasks import SentimentTask
task_manager = ExampleManagement()
task_manager.register_tasks([
    ('sentiment', SentimentTask)
])

if __name__ == "__main__":
    task_manager.start_example_task()

```
æŽ¥ç€ï¼Œä½ å°±å¯ä»¥è®­ç»ƒä½ çš„æƒ…æ„Ÿè¯†åˆ«çš„æ¨¡åž‹äº†ã€‚ä½ åº”è¯¥åœ¨ä¸‹è½½çš„é•œåƒæ¨¡åž‹ä¸­è¿›è¡Œã€‚
- æŸ¥çœ‹æ‰€æœ‰sentimentä»»åŠ¡å‚æ•°
```
    python main.py sentiment -h
```
- è®­ç»ƒæ¨¡åž‹ï¼ˆå¯ä»¥å‚è€ƒä¸Šé¢çš„å¸®åŠ©åˆ—è¡¨è®¾ç½®ç›¸å…³çš„å‚æ•°ï¼‰
```
    python main.py sentiment
```

###  (3) å¸¸è§çš„ä¸­æ–‡çš„è‡ªç„¶è¯­è¨€ä»»åŠ¡çš„ä¾‹å­

## TODO:  
- ä½¿ç”¨ pytorchlightningå’Œfastaiæ¥å®žçŽ°trainer
- å¢žåŠ æ›´å¤šçš„è‡ªç„¶è¯­è¨€ä»»åŠ¡çš„ä¾‹å­





